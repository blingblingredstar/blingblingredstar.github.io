<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Building BlocksIntroductionThe goal: To learn how to solve big async problems just by thinking differently about events目标:通过对事件的不同思考来学习如何解决大型异步问题 Async seems hard Race Conditions竞态条件 Memory Leaks内存泄漏">
<meta name="keywords" content="FrontEndMasters,JavaScript,rxjs,Asynchronous Programming,Functional Programming">
<meta property="og:type" content="article">
<meta property="og:title" content="Asynchornous Programming in JavaScript(with RX.js Observables)">
<meta property="og:url" content="http://yoursite.com/2019/07/06/Asynchornous-Programming-in-JavaScript-with-RX-js-Observables/index.html">
<meta property="og:site_name" content="刘勇的博客">
<meta property="og:description" content="Building BlocksIntroductionThe goal: To learn how to solve big async problems just by thinking differently about events目标:通过对事件的不同思考来学习如何解决大型异步问题 Async seems hard Race Conditions竞态条件 Memory Leaks内存泄漏">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-06T09:00:23.483Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Asynchornous Programming in JavaScript(with RX.js Observables)">
<meta name="twitter:description" content="Building BlocksIntroductionThe goal: To learn how to solve big async problems just by thinking differently about events目标:通过对事件的不同思考来学习如何解决大型异步问题 Async seems hard Race Conditions竞态条件 Memory Leaks内存泄漏">






  <link rel="canonical" href="http://yoursite.com/2019/07/06/Asynchornous-Programming-in-JavaScript-with-RX-js-Observables/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Asynchornous Programming in JavaScript(with RX.js Observables) | 刘勇的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘勇的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/06/Asynchornous-Programming-in-JavaScript-with-RX-js-Observables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘勇">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://img.zcool.cn/community/04c6fd55fa1a4a000001b19c79e625.jpg@160w_160h_1c_1e_1o_100sh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘勇的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Asynchornous Programming in JavaScript(with RX.js Observables)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-06 16:58:35 / 修改时间：17:00:23" itemprop="dateCreated datePublished" datetime="2019-07-06T16:58:35+08:00">2019-07-06</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Building-Blocks"><a href="#Building-Blocks" class="headerlink" title="Building Blocks"></a>Building Blocks</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>The goal: To learn how to solve big async problems just by thinking differently about events<br>目标:通过对事件的不同思考来学习如何解决大型异步问题</p>
<h4 id="Async-seems-hard"><a href="#Async-seems-hard" class="headerlink" title="Async seems hard"></a>Async seems hard</h4><ul>
<li>Race Conditions<br>竞态条件</li>
<li>Memory Leaks<br>内存泄漏</li>
<li>Complex State Machines<br>复杂状态</li>
<li>Uncaught Async Errors<br>无法捕获异步错误<a id="more"></a>
<h4 id="Playing-a-Movie-Asynchronously"><a href="#Playing-a-Movie-Asynchronously" class="headerlink" title="Playing a Movie Asynchronously"></a>Playing a Movie Asynchronously</h4></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params">movieId, cancelButton, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieTicket,</span><br><span class="line">      playError,</span><br><span class="line">      tryFinish = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (playError) &#123;</span><br><span class="line">          callback(<span class="literal">null</span>, playError)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (movieTicket &amp;&amp; palyer.initialized) &#123;</span><br><span class="line">          callback(<span class="literal">null</span>, ticket)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  cancelButton.addEventListener(<span class="string">'click'</span>, () =&gt; &#123; playError = <span class="string">'callcelled'</span> &#125;) <span class="comment">// 这里只绑定了取消事件，执行后并没有取消绑定事件，下次开始播放时会绑定另一个取消事件，引发内存泄漏</span></span><br><span class="line">  <span class="keyword">if</span> (!player.initialized) &#123;</span><br><span class="line">    player.init(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      playError = error</span><br><span class="line">      tryFinish()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  authorizeMovie(<span class="function">(<span class="params">error, ticket</span>) =&gt;</span> &#123;</span><br><span class="line">    playError = error</span><br><span class="line">    movieTicket = ticket</span><br><span class="line">    tryFinish()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Today is going to show how to write complex async programs using just a fex <strong>flexible</strong> functions.<br>今天将展示如何使用<strong>灵活的</strong>函数编写复杂的异步程序。</p>
<h3 id="JavaScript-Tutorial"><a href="#JavaScript-Tutorial" class="headerlink" title="JavaScript Tutorial"></a>JavaScript Tutorial</h3><h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add1</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add1 = <span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addTwo</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addTwo = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br></pre></td></tr></table></figure>
<h4 id="ForEach"><a href="#ForEach" class="headerlink" title="ForEach"></a>ForEach</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item))</span><br></pre></td></tr></table></figure>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].filter(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="concatAll"><a href="#concatAll" class="headerlink" title="concatAll"></a>concatAll</h4><p>not in JavaScript, it takes a multidimensional array and flattens it by on dimension<br>不是在JavaScript中，它接受一个多维数组并按维将其压扁</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [], [<span class="number">4</span>]].concatAll() <span class="comment">// [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<p>新增的<code>Array.prototype.flat()</code>，<code>Array.prototype.flatMap()</code>功能类似。</p>
<h3 id="Creating-Collections"><a href="#Creating-Collections" class="headerlink" title="Creating Collections"></a>Creating Collections</h3><h4 id="Top-rated-Movies-Collection"><a href="#Top-rated-Movies-Collection" class="headerlink" title="Top-rated Movies Collection"></a>Top-rated Movies Collection</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getTopRatedFilms = <span class="function"><span class="params">user</span> =&gt;</span></span><br><span class="line">  user.videoLists</span><br><span class="line">    .map(<span class="function"><span class="params">videoList</span> =&gt;</span></span><br><span class="line">        videoList.videos</span><br><span class="line">          .filter(<span class="function"><span class="params">video</span> =&gt;</span> video.rating === <span class="number">5.0</span>)</span><br><span class="line">      )</span><br><span class="line">    .concatAll()</span><br><span class="line"></span><br><span class="line">getTopRatedFilms(user)</span><br><span class="line">  .forEach(<span class="function"><span class="params">film</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(film) &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Mouse-Drags-Collection"><a href="#Mouse-Drags-Collection" class="headerlink" title="Mouse Drags Collection"></a>Mouse Drags Collection</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getElementDrags = <span class="function"><span class="params">ele</span> =&gt;</span></span><br><span class="line">      ele.mouseDowns</span><br><span class="line">        .map(<span class="function"><span class="params">mouseDown</span> =&gt;</span></span><br><span class="line">          <span class="built_in">document</span>.mouseMoves</span><br><span class="line">            .takeUntil(<span class="built_in">document</span>.mouseUps)</span><br><span class="line">          )</span><br><span class="line">        .concatAll()</span><br><span class="line"></span><br><span class="line">getElementDrags(image)</span><br><span class="line">          .forEach(<span class="function"><span class="params">pos</span> =&gt;</span> image.position = pos)</span><br></pre></td></tr></table></figure>
<h3 id="Iterators-amp-Observers"><a href="#Iterators-amp-Observers" class="headerlink" title="Iterators &amp; Observers"></a>Iterators &amp; Observers</h3><p>Events and Arrays are both <strong>collections</strong>.<br>事件和数组都是<strong>集合</strong>。</p>
<p>So why don’t we program them the same way?</p>
<p>Iterator and Observer是两种存在已久的设计模式</p>
<h4 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iterator = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>][<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>Map</strong>, <strong>Filter</strong>, and <strong>ConcatAll</strong> can be implemented using an Iterator.</p>
<p>在迭代器模式中，iterator是consumer，决定了什么时候获取数据</p>
<h4 id="Observer-Pattern"><a href="#Observer-Pattern" class="headerlink" title="Observer Pattern"></a>Observer Pattern</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(</span><br><span class="line">  <span class="string">'mousemove'</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>在观察者模式中，producer决定何时将数据推入集合</p>
<h4 id="The-Iterator-and-Observer-Pattern-are-Symmetrical"><a href="#The-Iterator-and-Observer-Pattern-are-Symmetrical" class="headerlink" title="The Iterator and Observer Pattern are Symmetrical"></a>The Iterator and Observer Pattern are Symmetrical</h4><p>In Observer pattern producer iterate you<br>在Observer模式生成器中迭代</p>
<p>As a result, they gave Iterator and Observer different semantics</p>
<p>So many push APIS</p>
<ul>
<li>DOM Events</li>
<li>Websockets</li>
<li>Server-sent Events</li>
<li>Node Streams</li>
<li>Service Workers</li>
<li>JQuery Events</li>
<li>XMLHttpRequest</li>
<li>setInterval</li>
</ul>
<h2 id="Observables"><a href="#Observables" class="headerlink" title="Observables"></a>Observables</h2><h3 id="Observables-Introduction"><a href="#Observables-Introduction" class="headerlink" title="Observables Introduction"></a>Observables Introduction</h3><h4 id="Introducing-Observable"><a href="#Introducing-Observable" class="headerlink" title="Introducing Observable"></a>Introducing Observable</h4><p>Observable === Collection + Time</p>
<p>Observables can model</p>
<ul>
<li>Events</li>
<li>Async Server Requests</li>
<li>Animations</li>
</ul>
<h4 id="Reactive-Extensions"><a href="#Reactive-Extensions" class="headerlink" title="Reactive Extensions"></a>Reactive Extensions</h4><ul>
<li>Events as Streams</li>
<li>Open Source(Apache2)</li>
<li>Ported to many languages<ul>
<li>C</li>
<li>.NET</li>
<li>JavaScript</li>
<li>Java(Netflix)</li>
<li>Objective-C</li>
</ul>
</li>
</ul>
<p><a href="http://reactivex.io/" target="_blank" rel="noopener">ReactiveX - An API for asynchronous programming with observable streams</a></p>
<p>Events to Observables</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mouseMoves =</span><br><span class="line">  Observable</span><br><span class="line">    .fromEvent(element, <span class="string">'mousemove'</span>)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Adapt Push APIs to Observable</th>
</tr>
</thead>
<tbody>
<tr>
<td>DOM Events</td>
<td></td>
</tr>
<tr>
<td>Websockets</td>
<td></td>
</tr>
<tr>
<td>Server-sent Events</td>
<td></td>
</tr>
<tr>
<td>Node Stream</td>
<td>Observable</td>
</tr>
<tr>
<td>Service Workers</td>
<td></td>
</tr>
<tr>
<td>JQuery Events</td>
<td></td>
</tr>
<tr>
<td>XMLHttpRequest</td>
<td></td>
</tr>
<tr>
<td>setInterval</td>
</tr>
</tbody>
</table>
<h4 id="Event-Subscription"><a href="#Event-Subscription" class="headerlink" title="Event Subscription"></a>Event Subscription</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "subscribe"</span></span><br><span class="line"><span class="keyword">const</span> handler = <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e)</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'mousemoves'</span>, handler)</span><br><span class="line"></span><br><span class="line"><span class="comment">// "unsubscibe"</span></span><br><span class="line"><span class="built_in">document</span>.removeEventListener(<span class="string">'mousemoves'</span>, handler)</span><br></pre></td></tr></table></figure>
<h4 id="Observable-forEach"><a href="#Observable-forEach" class="headerlink" title="Observable.forEach"></a>Observable.forEach</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "subscribe"</span></span><br><span class="line"><span class="keyword">const</span> subscription =</span><br><span class="line">  mouseMoves.forEach(<span class="built_in">console</span>.log)</span><br><span class="line"></span><br><span class="line"><span class="comment">// "unsubcribe"</span></span><br><span class="line">subcription.dispose()</span><br></pre></td></tr></table></figure>
<h4 id="Expanded-Observable-forEach"><a href="#Expanded-Observable-forEach" class="headerlink" title="Expanded Observable.forEach"></a>Expanded Observable.forEach</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "subscribe"</span></span><br><span class="line"><span class="keyword">const</span> subscription =</span><br><span class="line">  mouseMoves.forEach(</span><br><span class="line">    <span class="comment">// next data</span></span><br><span class="line">    event =&gt; <span class="built_in">console</span>.log(event)</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    error =&gt; <span class="built_in">console</span>.log(error)</span><br><span class="line">    <span class="comment">// complete</span></span><br><span class="line">    () =&gt; <span class="built_in">console</span>.log(<span class="string">'Done'</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">// "unsubscribe"</span></span><br><span class="line">subscription.dispose()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subscription =</span><br><span class="line">  mouseMoves.forEach(&#123; <span class="comment">// Observer</span></span><br><span class="line">    onNext: <span class="function"><span class="params">event</span> =&gt;</span> <span class="built_in">console</span>.log(event),</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    onError: <span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error),</span><br><span class="line">    <span class="comment">// completed</span></span><br><span class="line">    onCompleted: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'done'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// "unsubscribe"</span></span><br><span class="line">subscription.dispose()</span><br></pre></td></tr></table></figure>
<h3 id="Observable-Metaphor"><a href="#Observable-Metaphor" class="headerlink" title="Observable Metaphor"></a>Observable Metaphor</h3><p>iterator 和 observer 的区别就是是producer(数据提供者)还是consumer(数据接收使用者)占据主动。 所以有时两者可以互相转换。</p>
<p>就像分蛋糕，分蛋糕的人是producer，吃蛋糕的是consumer，可以由consumer根据自己的需求要蛋糕，也可以由producer根据自己的意愿分蛋糕。</p>
<h4 id="Converting-Events-to-Observables"><a href="#Converting-Events-to-Observables" class="headerlink" title="Converting Events to Observables"></a>Converting Events to Observables</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromEvent = <span class="function"><span class="keyword">function</span>(<span class="params">dom, eventName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// returning Observable object</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    forEach: <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> handler = <span class="function"><span class="params">e</span> =&gt;</span> observer.onNext(e)</span><br><span class="line">      dom.addEventListener(eventName, handler)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// returning Subscription object</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        dispose: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          dom.removeEventListener(eventName, handler)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Observables-in-Action"><a href="#Observables-in-Action" class="headerlink" title="Observables in Action"></a>Observables in Action</h3><p>Observer的forEach,map,filter等方法与数组的不同，是一个异步方法，当数据流更新时，马上对新数据进行处理，并不对旧数据进行保存。</p>
<p>使用concatAll方法，可以将数据流依次收集起来，合并为一个有序的一维数组，在需要的时候在对数据进行处理。</p>
<h3 id="Race-Conditions-amp-Nested-Observables"><a href="#Race-Conditions-amp-Nested-Observables" class="headerlink" title="Race Conditions &amp; Nested Observables"></a>Race Conditions &amp; Nested Observables</h3><p>通过concatAll，可以将一个有限的数据流缓存起来，转换为一个有序的一维数组，这样对一维数组进行处理，因为数据流按时间顺序尽心了排序，就可以对race condition进行处理。所以也不建议使用cancatAll对一个无限的数据流进行缓存。</p>
<h3 id="TakeUntil"><a href="#TakeUntil" class="headerlink" title="TakeUntil"></a>TakeUntil</h3><p>takeUntil需要两个参数，一个是Source Collection，一般是一个无限的数据流，另一个是Stop Collection，是停止条件，当停止事件触发时，停止监听Source Collection。</p>
<p>之前停止监听的方法是使用<code>.dipose()</code>停止订阅，现在可以使用另一个事件作为停止条件自动停止订阅。</p>
<h3 id="Implementing-Mouse-Move"><a href="#Implementing-Mouse-Move" class="headerlink" title="Implementing Mouse Move"></a>Implementing Mouse Move</h3><p>JS中的异步编程使用了event loop模型，独立于主线程之外，所以递归的尾调用对于异步编程来说并没有什么作用（尾调用把递归变为类似循环，发生在主线程之内，会堵塞主线程）。<br><!-- markdownlint-disable md024 --></p>
<h4 id="Mouse-Drags-Collection-1"><a href="#Mouse-Drags-Collection-1" class="headerlink" title="Mouse Drags Collection"></a>Mouse Drags Collection</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getElementDrags = <span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">  [<span class="string">'mouseMoves'</span>, <span class="string">'mouseDowns'</span>, <span class="string">'mouseUps'</span>]</span><br><span class="line">  .forEach(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">    ele[key] = Observable.fromEvent(ele, key)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ele.mouseDowns</span><br><span class="line">    .map(<span class="function"><span class="params">mouseDown</span> =&gt;</span></span><br><span class="line">      <span class="built_in">document</span>.mouseMoves</span><br><span class="line">        .takeUntil(<span class="built_in">document</span>.mouseUps)</span><br><span class="line">    )</span><br><span class="line">    .concatAll()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getElementDrags(image)</span><br><span class="line">  .forEach(<span class="function"><span class="params">pos</span> =&gt;</span> image.position = pos)</span><br></pre></td></tr></table></figure>
<h3 id="MergeAll-amp-SwitchLatest"><a href="#MergeAll-amp-SwitchLatest" class="headerlink" title="MergeAll &amp; SwitchLatest"></a>MergeAll &amp; SwitchLatest</h3><p>mergeAll按照时间顺序对数据流进行合并(concatAll会按照多个数据流，每个数据流开始的顺序进行合并，在当前数据流完成（onComplete发生）前不会跳转到下一个数据流，mergeAll会按照多个数据流的每一个数据的时间尽心合并，下一个数据流的数据下发生时，会合并到最终数据流中。</p>
<p>switchLatest会监听最后一个数据流，既多个数据流传入时，只监听最后传入的数据流。当新的数据流传入时，会对当前数据流停止监听，并开始监听新传入的数据流。</p>
<h3 id="Netflix-Search-Box"><a href="#Netflix-Search-Box" class="headerlink" title="Netflix Search Box"></a>Netflix Search Box</h3><p>Don’t unsubscribe from Events.<em>Complete them when another event fires</em>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchResultSets =</span><br><span class="line">  keyPresses</span><br><span class="line">    .throttle(<span class="number">250</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">      getJSON(<span class="string">`/searchResults?q=<span class="subst">$&#123;input.value&#125;</span>`</span>)</span><br><span class="line">        .retry(<span class="number">3</span>)</span><br><span class="line">        .takeUntil(keyPresses)</span><br><span class="line">    )</span><br><span class="line">    .concatAll()</span><br><span class="line"></span><br><span class="line">searchResultSets.forEach(</span><br><span class="line">  resultSet =&gt; updateSearchResults(resultSet),</span><br><span class="line">  error =&gt; showMessage(<span class="string">'the server appears to be down.'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>As we begin to solves these problems, we are gonna start describing them in four steps:</p>
<ol>
<li>What collections do I have?</li>
<li>What collection do I want?</li>
<li>How do I get from the collections I have to the collection that I want？</li>
<li>Once I’ve got the collection that I want, what am I gonna to do with the data that comes out of it?</li>
</ol>
<h3 id="Optimizing-the-Search"><a href="#Optimizing-the-Search" class="headerlink" title="Optimizing the Search"></a>Optimizing the Search</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchResultSets =</span><br><span class="line">  keyPresses</span><br><span class="line">    .throttle(<span class="number">250</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">      getJSON(<span class="string">`/searchResults?q=<span class="subst">$&#123;input.value&#125;</span>`</span>)</span><br><span class="line">        .retry(<span class="number">3</span>)</span><br><span class="line">        <span class="comment">// .takeUntil(keyPresses)</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// .concatAll()</span></span><br><span class="line">    .switchLatest() <span class="comment">// 注释掉的两段代码的作用可以使用switchLatest完成</span></span><br><span class="line"></span><br><span class="line">searchResultSets.forEach(</span><br><span class="line">  resultSet =&gt; updateSearchResults(resultSet),</span><br><span class="line">  error =&gt; showMessage(<span class="string">'the server appears to be down.'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这里提到了promise，并提出了observable由于promise的三点：</p>
<ol>
<li>observable可以取消</li>
<li>observable可以重试</li>
<li>有些网络请求是一个数据流（websockets），更适合使用observable</li>
</ol>
<h3 id="Three-Dimensional-Collections"><a href="#Three-Dimensional-Collections" class="headerlink" title="Three-Dimensional Collections"></a>Three-Dimensional Collections</h3><h4 id="Player-Callback-Hell"><a href="#Player-Callback-Hell" class="headerlink" title="Player Callback Hell"></a>Player Callback Hell</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params">movieId, cancelButton, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieTicket,</span><br><span class="line">      playError,</span><br><span class="line">      tryFinish = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (playError) &#123;</span><br><span class="line">          callback(<span class="literal">null</span>, playError)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (movieTicket &amp;&amp; palyer.initialized) &#123;</span><br><span class="line">          callback(<span class="literal">null</span>, ticket)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  cancelButton.addEventListener(<span class="string">'click'</span>, () =&gt; &#123; playError = <span class="string">'callcelled'</span> &#125;) <span class="comment">// 这里只绑定了取消事件，执行后并没有取消绑定事件，下次开始播放时会绑定另一个取消事件，引发内存泄漏</span></span><br><span class="line">  <span class="keyword">if</span> (!player.initialized) &#123;</span><br><span class="line">    player.init(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      playError = error</span><br><span class="line">      tryFinish()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  authorizeMovie(<span class="function">(<span class="params">error, ticket</span>) =&gt;</span> &#123;</span><br><span class="line">    playError = error</span><br><span class="line">    movieTicket = ticket</span><br><span class="line">    tryFinish()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Player-with-Observable"><a href="#Player-with-Observable" class="headerlink" title="Player with Observable"></a>Player with Observable</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> authorizations =</span><br><span class="line">  player</span><br><span class="line">    .init()</span><br><span class="line">    .map(<span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">      playAttempts</span><br><span class="line">        .map(<span class="function"><span class="params">movieId</span> =&gt;</span></span><br><span class="line">          player.authorize(movieId)</span><br><span class="line">            .catch(<span class="function"><span class="params">e</span> =&gt;</span> Observable.empty)</span><br><span class="line">            .takeUntil(cancles)</span><br><span class="line">        )</span><br><span class="line">        .cancatAll()</span><br><span class="line">    ).concatAll()</span><br><span class="line"></span><br><span class="line">authorizations.forEach(</span><br><span class="line">  license =&gt; player.play(license),</span><br><span class="line">  error =&gt; showDialog(<span class="string">"Sorry, can't play right now."</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Creating-Array-Functions"><a href="#Creating-Array-Functions" class="headerlink" title="Creating Array Functions"></a>Creating Array Functions</h2><h3 id="Working-with-Arrays"><a href="#Working-with-Arrays" class="headerlink" title="Working with Arrays"></a>Working with Arrays</h3><p><a href="http://jhusain.github.io/learnrx/" target="_blank" rel="noopener">Interactive Learning Exercises</a></p>
<p>The Array is Javascript’s only collection type. Arrays are everywhere. We’re going to add the five functions to the Array type, and in the process make it much more powerful and useful. As a matter of fact, Array already has the map, filter, and reduce functions! However we’re going to reimplement these functions as a learning exercise.<br>数组是Javascript唯一的集合类型。数组是无处不在。我们将把这五个函数添加到数组类型中，在这个过程中使它变得更加强大和有用。事实上，Array已经具有map、filter和reduce函数!不过，我们将把这些函数重新实现为一个学习练习</p>
<p>This section will follow a pattern. First we’ll solve problems the way you probably learned in school, or on your own by reading other people’s code. In other words, we’ll transform collections into new collections using loops and statements. Then we’ll implement one of the five functions, and then use it to solve the same problem again without the loop. Once we’ve learned the five functions, you’ll learn how to combine them to solve complex problems with very little code. The first two exercises have been completed in advance, but please look them over carefully!</p>
<p>本节将遵循一种模式。首先，我们将用你可能在学校学到的方法来解决问题，或者你自己通过阅读别人的代码来解决问题。换句话说，我们将使用循环和语句将集合转换为新的集合。然后我们将实现这五个函数中的一个，然后使用它来解决同样的问题，而不需要循环。一旦我们学习了这五个函数，您将学习如何将它们组合在一起，用很少的代码解决复杂的问题。前两个练习已经提前完成了，请仔细检查!</p>
<h4 id="Traversing-an-Array"><a href="#Traversing-an-Array" class="headerlink" title="Traversing an Array"></a>Traversing an Array</h4><h4 id="Exercise-1-Print-all-the-names-in-an-array"><a href="#Exercise-1-Print-all-the-names-in-an-array" class="headerlink" title="Exercise 1: Print all the names in an array"></a>Exercise 1: Print all the names in an array</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">console</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> names = [<span class="string">"Ben"</span>, <span class="string">"Jafar"</span>, <span class="string">"Matt"</span>, <span class="string">"Priya"</span>, <span class="string">"Brian"</span>],</span><br><span class="line">    counter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(counter = <span class="number">0</span>; counter &lt; names.length; counter++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(names[counter]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-2-Use-forEach-to-print-all-the-names-in-an-array"><a href="#Exercise-2-Use-forEach-to-print-all-the-names-in-an-array" class="headerlink" title="Exercise 2: Use forEach to print all the names in an array"></a>Exercise 2: Use forEach to print all the names in an array</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">console</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> names = [<span class="string">"Ben"</span>, <span class="string">"Jafar"</span>, <span class="string">"Matt"</span>, <span class="string">"Priya"</span>, <span class="string">"Brian"</span>];</span><br><span class="line"></span><br><span class="line">  names.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Projecting-Arrays"><a href="#Projecting-Arrays" class="headerlink" title="Projecting Arrays"></a>Projecting Arrays</h3><p>Applying a function to a value and creating a new value is called a projection. To project one array into another, we apply a projection function to each item in the array and collect the results in a new array.</p>
<h4 id="Exercise-3-Project-an-array-of-videos-into-an-array-of-id-title-pairs-using-forEach"><a href="#Exercise-3-Project-an-array-of-videos-into-an-array-of-id-title-pairs-using-forEach" class="headerlink" title="Exercise 3: Project an array of videos into an array of {id,title} pairs using forEach()"></a>Exercise 3: Project an array of videos into an array of {id,title} pairs using forEach()</h4><!-- markdownlint-disable md033 -->
<details><br><br><summary><br>For each video, add a projected {id, title} pair to the videoAndTitlePairs array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newReleases = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">4.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">5.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">4.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">5.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  videoAndTitlePairs = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  <span class="comment">// Use forEach function to accumulate &#123;id, title&#125; pairs from each video.</span></span><br><span class="line">  <span class="comment">// Put the results into the videoAndTitlePairs array using the Array's</span></span><br><span class="line">  <span class="comment">// push() method. Example: videoAndTitlePairs.push(newItem);</span></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  newReleases.forEach(<span class="function">(<span class="params">&#123;id, title&#125;</span>) =&gt;</span> videoAndTitlePairs.push(&#123;id, title&#125;))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> videoAndTitlePairs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>All array projections share two operations in common:</p>
<ol>
<li>Traverse the source array</li>
<li>Add each item’s projected value to a new array<br>Why not abstract away how these operations are carried out?</li>
</ol>
<h4 id="Exercise-4-Implement-map"><a href="#Exercise-4-Implement-map" class="headerlink" title="Exercise 4: Implement map()"></a>Exercise 4: Implement map()</h4><p>To make projections easier, let’s add a map() function to the Array type. Map accepts the projection function to be applied to each item in the source array, and returns the projected array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">projectionFunction</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> results = [];</span><br><span class="line">  <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">itemInArray</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    <span class="comment">// Apply the projectionFunction to each item in the array and add</span></span><br><span class="line">    <span class="comment">// each result to the results array.</span></span><br><span class="line">    <span class="comment">// Note: you can add items to an array with the push() method.</span></span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    results.push(projectionFunction(itemInArray))</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON.stringify([1,2,3].map(function(x) &#123; return x + 1; &#125;)) === '[2,3,4]'</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-5-Use-map-to-project-an-array-of-videos-into-an-array-of-id-title-pairs"><a href="#Exercise-5-Use-map-to-project-an-array-of-videos-into-an-array-of-id-title-pairs" class="headerlink" title="Exercise 5: Use map() to project an array of videos into an array of {id,title} pairs"></a>Exercise 5: Use map() to project an array of videos into an array of {id,title} pairs</h4><details><br><summary><br>Let’s repeat the exercise of collecting {id, title} pairs for each video in the newReleases array, but <strong>this time we’ll use our map function</strong>.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newReleases = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">4.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">5.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">4.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: [<span class="number">5.0</span>],</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  <span class="comment">// Use map function to accumulate &#123;id, title&#125; pairs from each video.</span></span><br><span class="line">  <span class="keyword">return</span> newReleases.map(<span class="function">(<span class="params">&#123;id, title&#125;</span>) =&gt;</span> &#123; <span class="keyword">return</span> &#123;id, title&#125; &#125;) <span class="comment">// finish this expression!</span></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h3 id="Filtering-Arrays"><a href="#Filtering-Arrays" class="headerlink" title="Filtering Arrays"></a>Filtering Arrays</h3><p>Like projection, filtering an array is also a very common operation. To filter an array we apply a test to each item in the array and collect the items that pass into a new array.</p>
<h4 id="Exercise-6-Use-forEach-to-collect-only-those-videos-with-a-rating-of-5-0"><a href="#Exercise-6-Use-forEach-to-collect-only-those-videos-with-a-rating-of-5-0" class="headerlink" title="Exercise 6: Use forEach() to collect only those videos with a rating of 5.0"></a>Exercise 6: Use forEach() to collect only those videos with a rating of 5.0</h4><details><br><summary><br>Use forEach() to loop through the videos in the newReleases array and, if a video has a rating of 5.0, add it to the videos array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newReleases = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  videos = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  <span class="comment">// Use forEach function to accumulate every video with a rating of 5.0</span></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  newReleases.forEach(<span class="function">(<span class="params">video</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(video.rating === <span class="number">5.0</span>)</span><br><span class="line">    videos.push(video)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> videos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Notice that, like map(), every filter() operation shares some operations in common:</p>
<ol>
<li>Traverse the array</li>
<li>Add objects that pass the test to a new array<br>Why not abstract away how these operations are carried out?</li>
</ol>
<h4 id="Exercise-7-Implement-filter"><a href="#Exercise-7-Implement-filter" class="headerlink" title="Exercise 7: Implement filter()"></a>Exercise 7: Implement filter()</h4><p>To make filtering easier, let’s add a filter() function to the Array type. The filter() function accepts a predicate. A predicate is a function that accepts an item in the array, and returns a boolean indicating whether the item should be retained in the new array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.filter = <span class="function"><span class="keyword">function</span>(<span class="params">predicateFunction</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> results = [];</span><br><span class="line">  <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">itemInArray</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    <span class="comment">// Apply the predicateFunction to each item in the array.</span></span><br><span class="line">    <span class="comment">// If the result is truthy, add the item to the results array.</span></span><br><span class="line">    <span class="comment">// Note: remember you can add items to the array using the array's</span></span><br><span class="line">    <span class="comment">// push() method.</span></span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    <span class="keyword">if</span>(predicateFunction(itemInArray))&#123;</span><br><span class="line">      results.push(itemInArray)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON.stringify([1,2,3].filter(function(x) &#123; return x &gt; 2&#125;)) === "[3]"</span></span><br></pre></td></tr></table></figure>
<p>Like map(), filter() lets us express what data we want without requiring us to specify how we want to collect the data.</p>
<h3 id="Query-Data-by-Chaining-Method-Calls"><a href="#Query-Data-by-Chaining-Method-Calls" class="headerlink" title="Query Data by Chaining Method Calls"></a>Query Data by Chaining Method Calls</h3><h4 id="Exercise-8-Chain-filter-and-map-to-collect-the-ids-of-videos-that-have-a-rating-of-5-0"><a href="#Exercise-8-Chain-filter-and-map-to-collect-the-ids-of-videos-that-have-a-rating-of-5-0" class="headerlink" title="Exercise 8: Chain filter and map to collect the ids of videos that have a rating of 5.0"></a>Exercise 8: Chain filter and map to collect the ids of videos that have a rating of 5.0</h4><details><br><summary><br>Answer<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newReleases = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">      <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">      <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">      <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">  <span class="comment">// Chain the filter and map functions to select the id of all videos</span></span><br><span class="line">  <span class="comment">// with a rating of 5.0.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newReleases</span><br><span class="line">    .filter(<span class="function">(<span class="params">&#123;rating&#125;</span>) =&gt;</span> rating === <span class="number">5.0</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">&#123;id&#125;</span>) =&gt;</span> id) <span class="comment">// Complete this expression</span></span><br><span class="line">  <span class="comment">// ------------ INSERT CODE HERE! -----------------------------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Chaining together map() and filter() gives us a lot of expressive power. These high level functions let us express what data we want, but leave the underlying libraries a great deal of flexibility in terms of how our queries are executed.</p>
<h3 id="Querying-Trees"><a href="#Querying-Trees" class="headerlink" title="Querying Trees"></a>Querying Trees</h3><p>Sometimes, in addition to flat arrays, we need to query trees. Trees pose a challenge because we need to flatten them into arrays in order to apply filter() and map() operations on them. In this section we’ll define a concatAll() function that we can combine with map() and filter() to query trees.</p>
<h4 id="Exercise-9-Flatten-the-movieLists-array-into-an-array-of-video-ids"><a href="#Exercise-9-Flatten-the-movieLists-array-into-an-array-of-video-ids" class="headerlink" title="Exercise 9: Flatten the movieLists array into an array of video ids"></a>Exercise 9: Flatten the movieLists array into an array of video ids</h4><details><br><br><summary><br>Let’s start by using two nested forEach loops to collect the id of every video in the two-dimensional movieLists array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"New Releases"</span>,</span><br><span class="line">      videos: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">          <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">          <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">          <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">          <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"Dramas"</span>,</span><br><span class="line">      videos: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">          <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">          <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">          <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">          <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  allVideoIdsInMovieLists = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------   INSERT CODE HERE!  -----------------------------------</span></span><br><span class="line">  <span class="comment">// Use two nested forEach loops to flatten the movieLists into a list of</span></span><br><span class="line">  <span class="comment">// video ids.</span></span><br><span class="line">  <span class="comment">// ------------   INSERT CODE HERE!  -----------------------------------</span></span><br><span class="line"></span><br><span class="line">  movieLists.forEach(<span class="function"><span class="params">movieList</span> =&gt;</span> &#123;</span><br><span class="line">    movieList.videos.forEach(<span class="function"><span class="params">video</span> =&gt;</span> &#123;allVideoIdsInMovieLists.push(video.id)&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> allVideoIdsInMovieLists;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Flattening trees with nested forEach expressions is easy because we can explicitly add items to the array. Unfortunately it’s exactly this type of low-level operation that we’ve been trying to abstract away with functions like map() and filter(). Can we define a function that’s abstract enough to express our intent to flatten a tree, without specifying too much information about how to carry out the operation?</p>
<h4 id="Exercise-10-Implement-concatAll"><a href="#Exercise-10-Implement-concatAll" class="headerlink" title="Exercise 10: Implement concatAll()"></a>Exercise 10: Implement concatAll()</h4><p>Let’s add a concatAll() function to the Array type. The concatAll() function iterates over each sub-array in the array and collects the results in a new, flat array. Notice that the concatAll() function expects each item in the array to be another array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.concatAll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> results = [];</span><br><span class="line">  <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">subArray</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    <span class="comment">// Add all the items in each subArray to the results array.</span></span><br><span class="line">    <span class="comment">// ------------ INSERT CODE HERE! ----------------------------</span></span><br><span class="line">    subArray.forEach(<span class="function"><span class="params">subItems</span> =&gt;</span> results.push(subItems))</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON.stringify([ [1,2,3], [4,5,6], [7,8,9] ].concatAll()) === "[1,2,3,4,5,6,7,8,9]"</span></span><br><span class="line"><span class="comment">// [1,2,3].concatAll(); // throws an error because this is a one-dimensional array</span></span><br></pre></td></tr></table></figure>
<p>concatAll is a very simple function, so much so that it may not be obvious yet how it can be combined with map() to query a tree. Let’s try an example…</p>
<h4 id="Exercise-11-Use-map-and-concatAll-to-project-and-flatten-the-movieLists-into-an-array-of-video-ids"><a href="#Exercise-11-Use-map-and-concatAll-to-project-and-flatten-the-movieLists-into-an-array-of-video-ids" class="headerlink" title="Exercise 11: Use map() and concatAll() to project and flatten the movieLists into an array of video ids"></a>Exercise 11: Use map() and concatAll() to project and flatten the movieLists into an array of video ids</h4><details><br><br><summary><br>Answer<br>Hint: use two nested calls to map() and one call to concatAll().<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"New Releases"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">            <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">            <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">            <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">            <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"Dramas"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">            <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">            <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">            <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">            <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------------   INSERT CODE HERE!  -----------------------------------</span></span><br><span class="line">  <span class="comment">// Use map and concatAll to flatten the movieLists in a list of video ids.</span></span><br><span class="line">  <span class="comment">// ------------   INSERT CODE HERE!  -----------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> movieLists</span><br><span class="line">    .map(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos.map(<span class="function">(<span class="params">&#123;id&#125;</span>) =&gt;</span> id)</span><br><span class="line">    )</span><br><span class="line">    .concatAll() <span class="comment">// Complete this expression!</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Wow! Great work. Mastering the combination of map() and concatAll() is key to effective functional programming. You’re half way there! Let’s try a more complicated example…</p>
<h4 id="Exercise-12-Retrieve-id-title-and-a-150x200-box-art-url-for-every-video"><a href="#Exercise-12-Retrieve-id-title-and-a-150x200-box-art-url-for-every-video" class="headerlink" title="Exercise 12: Retrieve id, title, and a 150x200 box art url for every video"></a>Exercise 12: Retrieve id, title, and a 150x200 box art url for every video</h4><details><br><summary><br>You’ve managed to flatten a tree that’s two levels deep, let’s try for three! Let’s say that instead of a single boxart url on each video, we had a collection of boxart objects, each with a different size and url. Create a query that selects {id, title, boxart} for every video in the movieLists. This time though, the boxart property in the result will be the url of the boxart object with dimensions of 150x200px. Let’s see if you can solve this problem with map(), concatAll(), and filter().<br><br><strong>There’s just more one thing: you can’t use indexers</strong>. In other words, this is <em>illegal</em>:<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> itemInArray = movieLists[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><br><br>Furthermore, <strong>you’re not allowed to use indexers in any of the remaining exercises</strong> unless you’re implementing one of the five functions. There is a very good reason for this restriction, and that reason will eventually be explained. For now, you’ll simply have to accept it on faith that this restriction serves a purpose. :-)<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"Instant Queue"</span>,</span><br><span class="line">        videos : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg"</span> &#125;</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"New Releases"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use one or more map, concatAll, and filter calls to create an array with the following items</span></span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" &#125;</span></span><br><span class="line">  <span class="comment">// ];</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// return movieLists</span></span><br><span class="line">  <span class="comment">//   .map(movieList =&gt;</span></span><br><span class="line">  <span class="comment">//     movieList.videos</span></span><br><span class="line">  <span class="comment">//       .map((&#123;id, title, boxarts&#125;) =&gt; (</span></span><br><span class="line">  <span class="comment">//         &#123;</span></span><br><span class="line">  <span class="comment">//           id,</span></span><br><span class="line">  <span class="comment">//           title,</span></span><br><span class="line">  <span class="comment">//           boxart: boxarts</span></span><br><span class="line">  <span class="comment">//                     .filter(boxart =&gt; boxart.width === 150 &amp;&amp; boxart.height === 200)</span></span><br><span class="line">  <span class="comment">//                     .map(item =&gt; item.url) + ''</span></span><br><span class="line">  <span class="comment">//         &#125;</span></span><br><span class="line">  <span class="comment">//       ))</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   .concatAll()// Complete this expression!</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> movieLists</span><br><span class="line">    .map(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos.map(<span class="function"><span class="params">video</span> =&gt;</span></span><br><span class="line">        video.boxarts</span><br><span class="line">          .filter(<span class="function"><span class="params">boxart</span> =&gt;</span> boxart.width ===<span class="number">150</span> &amp;&amp; boxart.height === <span class="number">200</span>)</span><br><span class="line">          .map(<span class="function"><span class="params">boxart</span> =&gt;</span></span><br><span class="line">            (&#123;</span><br><span class="line">              id: video.id,</span><br><span class="line">              title: video.title,</span><br><span class="line">              boxart: boxart.url</span><br><span class="line">            &#125;)</span><br><span class="line">          )</span><br><span class="line">      ).concatAll()</span><br><span class="line">    )</span><br><span class="line">    .concatAll()</span><br><span class="line">    <span class="comment">// 首先获取最深层的数据，然后将在作用域内获取上层数据并保存在新数组中，最后压平数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Fantastic job! Now you’ve learned to use concatAll() alongside map() and filter() to query trees. Notice that map() and concatAll() are very commonly chained together. Let’s create a small helper function to help us with this common pattern.</p>
<h4 id="Exercise-13-Implement-concatMap"><a href="#Exercise-13-Implement-concatMap" class="headerlink" title="Exercise 13: Implement concatMap()"></a>Exercise 13: Implement concatMap()</h4><p>Nearly every time we flatten a tree we chain map() and concatAll(). Sometimes, if we’re dealing with a tree several levels deep, we’ll repeat this combination many times in our code. To save on typing, let’s create a concatMap function that’s just a map operation, followed by a concatAll.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.concatMap = <span class="function"><span class="keyword">function</span>(<span class="params">projectionFunctionThatReturnsArray</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.</span><br><span class="line">    map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ------------   INSERT CODE HERE!  ----------------------------</span></span><br><span class="line">      <span class="comment">// Apply the projection function to each item. The projection</span></span><br><span class="line">      <span class="comment">// function will return a new child array. This will create a</span></span><br><span class="line">      <span class="comment">// two-dimensional array.</span></span><br><span class="line">      <span class="comment">// ------------   INSERT CODE HERE!  ----------------------------</span></span><br><span class="line">      <span class="keyword">return</span> projectionFunctionThatReturnsArray(item)</span><br><span class="line">    &#125;).</span><br><span class="line">    <span class="comment">// apply the concatAll function to flatten the two-dimensional array</span></span><br><span class="line">    concatAll();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  var spanishFrenchEnglishWords = [ ["cero","rien","zero"], ["uno","un","one"], ["dos","deux","two"] ];</span></span><br><span class="line"><span class="comment">  // collect all the words for each number, in every language, in a single, flat list</span></span><br><span class="line"><span class="comment">  var allWords = [0,1,2].</span></span><br><span class="line"><span class="comment">    concatMap(function(index) &#123;</span></span><br><span class="line"><span class="comment">      return spanishFrenchEnglishWords[index];</span></span><br><span class="line"><span class="comment">    &#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  return JSON.stringify(allWords) === '["cero","rien","zero","uno","un","one","dos","deux","two"]';</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>Now, instead of using map().concatAll() to flatten a tree, we can just use concatMap helper function.</p>
<h4 id="Exercise-14-Use-concatMap-to-retrieve-id-title-and-150x200-box-art-url-for-every-video"><a href="#Exercise-14-Use-concatMap-to-retrieve-id-title-and-150x200-box-art-url-for-every-video" class="headerlink" title="Exercise 14: Use concatMap() to retrieve id, title, and 150x200 box art url for every video"></a>Exercise 14: Use concatMap() to retrieve id, title, and 150x200 box art url for every video</h4><details><br><summary><br>Let’s repeat the exercise we just performed. However this time we’ll simplify the code by replacing the map().concatAll() calls with concatMap().<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"Instant Queue"</span>,</span><br><span class="line">        videos : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg"</span> &#125;</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"New Releases"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>: <span class="number">432534</span>, <span class="attr">time</span>: <span class="number">65876586</span> &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use one or more concatMap, map, and filter calls to create an array with the following items</span></span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 675465, "title": "Fracture", "boxart": "http://cdn-0.nflximg.com/images/2891/Fracture150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 65432445, "title": "The Chamber", "boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 654356453, "title": "Bad Boys", "boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys150.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 70111470, "title": "Die Hard", "boxart": "http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" &#125;</span></span><br><span class="line">  <span class="comment">// ];</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> movieLists</span><br><span class="line">    .concatMap(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos.concatMap(<span class="function"><span class="params">video</span> =&gt;</span></span><br><span class="line">        video.boxarts</span><br><span class="line">          .filter(<span class="function"><span class="params">boxart</span> =&gt;</span> boxart.width === <span class="number">150</span> &amp;&amp; boxart.height === <span class="number">200</span>)</span><br><span class="line">          .map(<span class="function"><span class="params">boxart</span> =&gt;</span> (</span><br><span class="line">            &#123;</span><br><span class="line">              id: video.id,</span><br><span class="line">              title: video.title,</span><br><span class="line">              boxart: boxart.url</span><br><span class="line">            &#125;</span><br><span class="line">          ))</span><br><span class="line">      )</span><br><span class="line">    ) <span class="comment">// Complete this expression!</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>It’s a very common pattern to see several nested concatMap operations, with the last operation being a map. You can think of this pattern as the functional version of a nested forEach.</p>
<h3 id="Reducing-Arrays"><a href="#Reducing-Arrays" class="headerlink" title="Reducing Arrays"></a>Reducing Arrays</h3><p>Sometimes we need to perform an operation on more than one item in the array at the same time. For example, let’s say we need to find the largest integer in an array. We can’t use a filter() operation, because it only examines one item at a time. To find the largest integer we need to compare items in the array to each other.</p>
<p>One approach could be to select an item in the array as the assumed largest number (perhaps the first item), and then compare that value to every other item in the array. Each time we come across a number that was larger than our assumed largest number, we’d replace it with the larger value, and continue the process until the entire array was traversed.</p>
<p>If we replaced the specific size comparison with a closure, we could write a function that handled the array traversal process for us. At each step our function would apply the closure to the last value and the current value and use the result as the last value the next time. Finally we’d be left with only one value. This process is known as reducing because we reduce many values to a single value.</p>
<h4 id="Exercise-15-Use-forEach-to-find-the-largest-box-art"><a href="#Exercise-15-Use-forEach-to-find-the-largest-box-art" class="headerlink" title="Exercise 15: Use forEach to find the largest box art"></a>Exercise 15: Use forEach to find the largest box art</h4><details><br><summary><br>In this example we use forEach to find the largest box art. Each time we examine a new boxart we update a variable with the currently known maximumSize. If the boxart is smaller than the maximum size, we discard it. If it’s larger, we keep track of it. Finally we’re left with a single boxart which must necessarily be the largest.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> boxarts = [</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">425</span>, <span class="attr">height</span>: <span class="number">150</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture425.jpg"</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    currentSize,</span><br><span class="line">    maxSize = <span class="number">-1</span>,</span><br><span class="line">    largestBoxart;</span><br><span class="line"></span><br><span class="line">  boxarts.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">boxart</span>) </span>&#123;</span><br><span class="line">    currentSize = boxart.width * boxart.height;</span><br><span class="line">    <span class="keyword">if</span> (currentSize &gt; maxSize) &#123;</span><br><span class="line">      largestBoxart = boxart;</span><br><span class="line">      maxSize = currentSize;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> largestBoxart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>This process is a reduction because we’re using the information we derived from the last computation to calculate the current value. However in the example above, we still have to specify the method of traversal. Wouldn’t it be nice if we could just specify what operation we wanted to perform on the last and current value? Let’s create a helper function to perform reductions on arrays.</p>
<h4 id="Exercise-16-Implement-reduce"><a href="#Exercise-16-Implement-reduce" class="headerlink" title="Exercise 16: Implement reduce()"></a>Exercise 16: Implement reduce()</h4><details><br><summary><br>Let’s add a reduce() function to the Array type. Like map. Take note this is different from the reduce in ES5, which returns a value instead of an Array!<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [1,2,3].reduce(function(accumulatedValue, currentValue) &#123; return accumulatedValue + currentValue; &#125;); === [6];</span></span><br><span class="line"><span class="comment">// [1,2,3].reduce(function(accumulatedValue, currentValue) &#123; return accumulatedValue + currentValue; &#125;, 10); === [16];</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.prototype.reduce = <span class="function"><span class="keyword">function</span>(<span class="params">combiner, initialValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> counter,</span><br><span class="line">    accumulatedValue;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the array is empty, do nothing</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If the user didn't pass an initial value, use the first item.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span>) &#123;</span><br><span class="line">      counter = <span class="number">1</span>;</span><br><span class="line">      accumulatedValue = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">      counter = <span class="number">0</span>;</span><br><span class="line">      accumulatedValue = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="string">"Invalid arguments."</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Loop through the array, feeding the current value and the result of</span></span><br><span class="line">    <span class="comment">// the previous computation back into the combiner function until</span></span><br><span class="line">    <span class="comment">// we've exhausted the entire array and are left with only one value.</span></span><br><span class="line">    <span class="keyword">while</span>(counter &lt; <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      accumulatedValue = combiner(accumulatedValue, <span class="keyword">this</span>[counter])</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [accumulatedValue];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br><br></details>

<h4 id="Exercise-17-Retrieve-the-largest-rating"><a href="#Exercise-17-Retrieve-the-largest-rating" class="headerlink" title="Exercise 17: Retrieve the largest rating"></a>Exercise 17: Retrieve the largest rating</h4><details><br><summary><br>Let’s use our new reduce function to isolate the largest value in an array of ratings.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ratings = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// You should return an array containing only the largest rating. Remember that reduce always</span></span><br><span class="line">  <span class="comment">// returns an array with one item.</span></span><br><span class="line">  <span class="keyword">return</span> ratings.</span><br><span class="line">    reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span> acc &gt; curr ? acc : curr, ratings[<span class="number">0</span>])   <span class="comment">// Complete this expression</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Nice work. Now let’s try combining reduce() with our other functions to build more complex queries.</p>
<h4 id="Exercise-18-Retrieve-url-of-the-largest-boxart"><a href="#Exercise-18-Retrieve-url-of-the-largest-boxart" class="headerlink" title="Exercise 18: Retrieve url of the largest boxart"></a>Exercise 18: Retrieve url of the largest boxart</h4><details><br><summary><br>Let’s try combining reduce() with map() to reduce multiple boxart objects to a single value: the url of the largest box art.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> boxarts = [</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture150.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>: <span class="number">200</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">width</span>: <span class="number">425</span>, <span class="attr">height</span>: <span class="number">150</span>, <span class="attr">url</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture425.jpg"</span> &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// You should return an array containing only the URL of the largest box art. Remember that reduce always</span></span><br><span class="line">  <span class="comment">// returns an array with one item.</span></span><br><span class="line">  <span class="keyword">return</span> boxarts</span><br><span class="line">    .reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span> acc.width * acc.height &gt; curr.width * curr.height ? acc : curr)</span><br><span class="line">    .map(<span class="function">(<span class="params">&#123;url&#125;</span>) =&gt;</span> url)   <span class="comment">// Complete this expression</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h4 id="Exercise-19-Reducing-with-an-initial-value"><a href="#Exercise-19-Reducing-with-an-initial-value" class="headerlink" title="Exercise 19: Reducing with an initial value"></a>Exercise 19: Reducing with an initial value</h4><details><br><summary><br>Sometimes when we reduce an array, we want the reduced value to be a different type than the items stored in the array. Let’s say we have an array of videos and we want to reduce them to a single map where the key is the video id and the value is the video’s title.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> videos = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"The Chamber"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Fracture"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Die Hard"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"Bad Boys"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Expecting this output...</span></span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123;</span></span><br><span class="line">  <span class="comment">//     "65432445": "The Chamber",</span></span><br><span class="line">  <span class="comment">//     "675465": "Fracture",</span></span><br><span class="line">  <span class="comment">//     "70111470": "Die Hard",</span></span><br><span class="line">  <span class="comment">//     "654356453": "Bad Boys"</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">  <span class="keyword">return</span> videos.</span><br><span class="line">    reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulatedMap, video</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----- INSERT CODE TO ADD THE VIDEO TITLE TO THE ----</span></span><br><span class="line">    <span class="comment">// ----- NEW MAP USING THE VIDEO ID AS THE KEY   ----</span></span><br><span class="line"></span><br><span class="line">    obj[video.id] = video.title</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Object.assign() takes all of the enumerable properties from</span></span><br><span class="line">    <span class="comment">// the object listed in its second argument (obj) and assigns them</span></span><br><span class="line">    <span class="comment">// to the object listed in its first argument (accumulatedMap).</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(accumulatedMap, obj);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Use an empty map as the initial value instead of the first item in</span></span><br><span class="line">    <span class="comment">// the list.</span></span><br><span class="line">    &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Nice work. Now let’s try combining reduce() with our other functions to build more complex queries.</p>
<h4 id="Exercise-20-Retrieve-the-id-title-and-smallest-box-art-url-for-every-video"><a href="#Exercise-20-Retrieve-the-id-title-and-smallest-box-art-url-for-every-video" class="headerlink" title="Exercise 20: Retrieve the id, title, and smallest box art url for every video"></a>Exercise 20: Retrieve the id, title, and smallest box art url for every video</h4><details><br><summary><br>This is a variation of the problem we solved earlier, where we retrieved the url of the boxart with a width of 150px. This time we’ll use reduce() instead of filter() to retrieve the smallest box art in the boxarts array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"New Releases"</span>,</span><br><span class="line">      videos: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">          <span class="string">"boxarts"</span>: [</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg"</span> &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">          <span class="string">"boxarts"</span>: [</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg"</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">140</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"</span> &#125;</span><br><span class="line"></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>:<span class="number">432534</span>, <span class="attr">time</span>:<span class="number">65876586</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"Thrillers"</span>,</span><br><span class="line">      videos: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">          <span class="string">"boxarts"</span>: [</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">130</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg"</span> &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">          <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">          <span class="string">"boxarts"</span>: [</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">120</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">          <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">          <span class="string">"bookmark"</span>: [&#123; <span class="attr">id</span>:<span class="number">432534</span>, <span class="attr">time</span>:<span class="number">65876586</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use one or more concatMap, map, and reduce calls to create an array with the following items (order matters)</span></span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 675465,"title": "Fracture","boxart":"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 65432445,"title": "The Chamber","boxart":"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 654356453,"title": "Bad Boys","boxart":"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg" &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123;"id": 70111470,"title": "Die Hard","boxart":"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg" &#125;</span></span><br><span class="line">  <span class="comment">// ];</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> movieLists.</span><br><span class="line">    concatMap(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos.concatMap(<span class="function"><span class="params">video</span> =&gt;</span></span><br><span class="line">        video.boxarts</span><br><span class="line">          .reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span></span><br><span class="line">            acc.width * acc.height &lt; curr.width * curr.height ? acc : curr</span><br><span class="line">          )</span><br><span class="line">          .map(<span class="function"><span class="params">boxart</span> =&gt;</span> (</span><br><span class="line">            &#123;</span><br><span class="line">              id: video.id,</span><br><span class="line">              title: video.title,</span><br><span class="line">              boxart: boxart.url</span><br><span class="line">            &#125;</span><br><span class="line">        ))</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">    .reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>()</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h3 id="Zipping-Arrays"><a href="#Zipping-Arrays" class="headerlink" title="Zipping Arrays"></a>Zipping Arrays</h3><p>Sometimes we need to combine two arrays by progressively taking an item from each and combining the pair. If you visualize a zipper, where each side is an array, and each tooth is an item, you’ll have a good idea of how the zip operation works.</p>
<h4 id="Exercise-21-Combine-videos-and-bookmarks-by-index"><a href="#Exercise-21-Combine-videos-and-bookmarks-by-index" class="headerlink" title="Exercise 21: Combine videos and bookmarks by index"></a>Exercise 21: Combine videos and bookmarks by index</h4><details><br><summary><br>Use a for loop to traverse the videos and bookmarks array at the same time. For each video and bookmark pair, create a {videoId, bookmarkId} pair and add it to the videoIdAndBookmarkIdPairs array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> videos = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    bookmarks = [</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">470</span>, <span class="attr">time</span>: <span class="number">23432</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">453</span>, <span class="attr">time</span>: <span class="number">234324</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">445</span>, <span class="attr">time</span>: <span class="number">987834</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">  counter,</span><br><span class="line">  videoIdAndBookmarkIdPairs = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(counter = <span class="number">0</span>; counter &lt; <span class="built_in">Math</span>.min(videos.length, bookmarks.length); counter++) &#123;</span><br><span class="line">    <span class="comment">// Insert code here to create a &#123;videoId, bookmarkId&#125; pair and add it to the videoIdAndBookmarkIdPairs array.</span></span><br><span class="line">    videoIdAndBookmarkIdPairs.push(</span><br><span class="line">        &#123;</span><br><span class="line">          videoId: videos[counter].id,</span><br><span class="line">          bookmarkId: bookmarks[counter].id</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> videoIdAndBookmarkIdPairs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h4 id="Exercise-22-Implement-zip"><a href="#Exercise-22-Implement-zip" class="headerlink" title="Exercise 22: Implement zip"></a>Exercise 22: Implement zip</h4><details><br><summary><br>Let’s add a static zip() function to the Array type. The zip function accepts a combiner function, traverses each array at the same time, and calls the combiner function on the current item on the left-hand-side and right-hand-side. The zip function requires an item from each array in order to call the combiner function, therefore the array returned by zip will only be as large as the smallest input array.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSON.stringify(Array.zip([1,2,3],[4,5,6], function(left, right) &#123; return left + right &#125;)) === '[5,7,9]'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.zip = <span class="function"><span class="keyword">function</span>(<span class="params">left, right, combinerFunction</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> counter,</span><br><span class="line">    results = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(counter = <span class="number">0</span>; counter &lt; <span class="built_in">Math</span>.min(left.length, right.length); counter++) &#123;</span><br><span class="line">    <span class="comment">// Add code here to apply the combinerFunction to the left and right-hand items in the respective arrays</span></span><br><span class="line">    results.push(</span><br><span class="line">      combinerFunction(left[counter], right[counter])</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br><br></details>

<h4 id="Exercise-23-Combine-videos-and-bookmarks-by-index"><a href="#Exercise-23-Combine-videos-and-bookmarks-by-index" class="headerlink" title="Exercise 23: Combine videos and bookmarks by index"></a>Exercise 23: Combine videos and bookmarks by index</h4><details><br><summary><br>Let’s repeat exercise 21, but this time lets use your new zip() function. For each video and bookmark pair, create a {videoId, bookmarkId} pair.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> videos = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">        <span class="string">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture.jpg"</span>,</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">        <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    bookmarks = [</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">470</span>, <span class="attr">time</span>: <span class="number">23432</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">453</span>, <span class="attr">time</span>: <span class="number">234324</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">445</span>, <span class="attr">time</span>: <span class="number">987834</span>&#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.</span><br><span class="line">    zip(videos, bookmarks, (video, bookmark) =&gt; (&#123;</span><br><span class="line">        videoId: video.id,</span><br><span class="line">        bookmarkId: bookmark.id</span><br><span class="line">      &#125;)</span><br><span class="line">    ) <span class="comment">//... finish this expression</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h4 id="Exercise-24-Retrieve-each-video’s-id-title-middle-interesting-moment-time-and-smallest-box-art-url"><a href="#Exercise-24-Retrieve-each-video’s-id-title-middle-interesting-moment-time-and-smallest-box-art-url" class="headerlink" title="Exercise 24: Retrieve each video’s id, title, middle interesting moment time, and smallest box art url"></a>Exercise 24: Retrieve each video’s id, title, middle interesting moment time, and smallest box art url</h4><details><br><summary><br>This is a variation of the problem we solved earlier. This time each video has an interesting moments collection, each representing a time during which a screenshot is interesting or representative of the title as a whole. Notice that both the boxarts and interestingMoments arrays are located at the same depth in the tree. Retrieve the time of the middle interesting moment and the smallest box art url simultaneously with zip(). Return an {id, title, time, url} object for each video.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> movieLists = [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"New Releases"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"interestingMoments"</span>: [</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"End"</span>, <span class="attr">time</span>:<span class="number">213432</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Start"</span>, <span class="attr">time</span>: <span class="number">64534</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Middle"</span>, <span class="attr">time</span>: <span class="number">323133</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">140</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"</span> &#125;</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"interestingMoments"</span>: [</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"End"</span>, <span class="attr">time</span>:<span class="number">54654754</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Start"</span>, <span class="attr">time</span>: <span class="number">43524243</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Middle"</span>, <span class="attr">time</span>: <span class="number">6575665</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"Instant Queue"</span>,</span><br><span class="line">        videos: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">130</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">4.0</span>,</span><br><span class="line">            <span class="string">"interestingMoments"</span>: [</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"End"</span>, <span class="attr">time</span>:<span class="number">132423</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Start"</span>, <span class="attr">time</span>: <span class="number">54637425</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Middle"</span>, <span class="attr">time</span>: <span class="number">3452343</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">            <span class="string">"boxarts"</span>: [</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">120</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"url"</span>: <span class="string">"http://api.netflix.com/catalog/titles/movies/70111470"</span>,</span><br><span class="line">            <span class="string">"rating"</span>: <span class="number">5.0</span>,</span><br><span class="line">            <span class="string">"interestingMoments"</span>: [</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"End"</span>, <span class="attr">time</span>:<span class="number">45632456</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Start"</span>, <span class="attr">time</span>: <span class="number">234534</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">type</span>: <span class="string">"Middle"</span>, <span class="attr">time</span>: <span class="number">3453434</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//------------ COMPLETE THIS EXPRESSION --------------</span></span><br><span class="line">  <span class="keyword">return</span> movieLists.</span><br><span class="line">    concatMap(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos.concatMap(<span class="function"><span class="params">video</span> =&gt;</span></span><br><span class="line">        <span class="built_in">Array</span>.zip(</span><br><span class="line">          video.boxarts</span><br><span class="line">            .reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span> acc.width * acc.height &lt; curr.width * curr.height ? acc : curr),</span><br><span class="line">          video.interestingMoments</span><br><span class="line">            .filter(<span class="function"><span class="params">item</span> =&gt;</span> item.type === <span class="string">'Middle'</span>),</span><br><span class="line">          (boxart, interestingMoment) =&gt; (</span><br><span class="line">            &#123;</span><br><span class="line">              id: video.id,</span><br><span class="line">              title: video.title,</span><br><span class="line">              time: interestingMoment.time,</span><br><span class="line">              url: boxart.url</span><br><span class="line">            &#125;</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<h2 id="Creating-Trees"><a href="#Creating-Trees" class="headerlink" title="Creating Trees"></a>Creating Trees</h2><h3 id="Debugging-Async"><a href="#Debugging-Async" class="headerlink" title="Debugging Async"></a>Debugging Async</h3><p>使用开发者工具的调试器设置断点并执行来观察结果。</p>
<h3 id="SQL-Comparison"><a href="#SQL-Comparison" class="headerlink" title="SQL Comparison"></a>SQL Comparison</h3><p>使用上面的几种方法，可以实现与SQL语句一样的查询效果</p>
<p>Powerful Queries</p>
<p>Now that we’ve learned the five operators let’s flex our muscles and write some powerful queries.</p>
<h4 id="Exercise-25-Converting-from-Arrays-to-Trees"><a href="#Exercise-25-Converting-from-Arrays-to-Trees" class="headerlink" title="Exercise 25: Converting from Arrays to Trees"></a>Exercise 25: Converting from Arrays to Trees</h4><details><br><summary><br>When information is organized in a tree like a JSON expression, relationships point from parent to child. In relational systems like databases, relationships point from children to their parents. Both ways of organizing information are equivalent, and depending on the circumstances, we might get data organized in one way or another. It may surprise you to learn that you can use the 5 query functions you already know to easily convert between these representations. In other words, not only can you query arrays from trees, you can query trees from arrays.<br><br>We have 2 arrays each containing lists, and videos respectively. Each video has a listId field indicating its parent list. We want to build an array of list objects, each with a name and a videos array. The videos array will contain the video’s id and title. In other words we want to build the following structure:<br></summary><br><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"New Releases"</span>,</span><br><span class="line">    <span class="attr">"videos"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"The Chamber"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Fracture"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Thrillers"</span>,</span><br><span class="line">    <span class="attr">"videos"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Die Hard"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Bad Boys"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br><br></details><br><details><br><summary><br>Note: please make sure when creating objects (both lists and videos) that you add properties in the same order as above. This doesn’t impact the correctness of your code, but the verifier expects properties to be created in this order.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> lists = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"New Releases"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65456475</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"Thrillers"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    videos = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"The Chamber"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Fracture"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">65456475</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Die Hard"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">65456475</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Bad Boys"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> lists.map(<span class="function"><span class="params">list</span> =&gt;</span>(&#123;</span><br><span class="line">    name: list.name,</span><br><span class="line">    videos: videos</span><br><span class="line">              .filter(<span class="function"><span class="params">video</span> =&gt;</span> video.listId === list.id)</span><br><span class="line">              .map(<span class="function"><span class="params">video</span> =&gt;</span> (&#123;<span class="attr">id</span>: video.id, <span class="attr">title</span>: video.title&#125;))</span><br><span class="line">  &#125;)) <span class="comment">// complete this expression</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Looks like you figured out that you can use map and filter to join two different arrays by a key. Now let’s try a more complex example…</p>
<h4 id="Exercise-26-Converting-from-Arrays-to-Deeper-Trees"><a href="#Exercise-26-Converting-from-Arrays-to-Deeper-Trees" class="headerlink" title="Exercise 26: Converting from Arrays to Deeper Trees"></a>Exercise 26: Converting from Arrays to Deeper Trees</h4><details><br><summary><br>Let’s try creating a deeper tree structure. This time we have 4 separate arrays each containing lists, videos, boxarts, and bookmarks respectively. Each object has a parent id, indicating its parent. We want to build an array of list objects, each with a name and a videos array. The videos array will contain the video’s id, title, bookmark time, and smallest boxart url. In other words we want to build the following structure:<br></summary><br><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"New Releases"</span>,</span><br><span class="line">    <span class="attr">"videos"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"The Chamber"</span>,</span><br><span class="line">        <span class="attr">"time"</span>: <span class="number">32432</span>,</span><br><span class="line">        <span class="attr">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Fracture"</span>,</span><br><span class="line">        <span class="attr">"time"</span>: <span class="number">3534543</span>,</span><br><span class="line">        <span class="attr">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Thrillers"</span>,</span><br><span class="line">    <span class="attr">"videos"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Die Hard"</span>,</span><br><span class="line">        <span class="attr">"time"</span>: <span class="number">645243</span>,</span><br><span class="line">        <span class="attr">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Bad Boys"</span>,</span><br><span class="line">        <span class="attr">"time"</span>: <span class="number">984934</span>,</span><br><span class="line">        <span class="attr">"boxart"</span>: <span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br><br></details>

<details><br><summary><br>Note: please make sure when creating objects (both lists and videos) that you add properties in the same order as above. This doesn’t impact the correctness of your code, but the verifier expects properties to be created in this order.<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> lists = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"New Releases"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65456475</span>,</span><br><span class="line">        name: <span class="string">"Thrillers"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    videos = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">65432445</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"The Chamber"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">5434364</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">675465</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Fracture"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">65456475</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">70111470</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Die Hard"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"listId"</span>: <span class="number">65456475</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">654356453</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"Bad Boys"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    boxarts = [</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">65432445</span>, <span class="attr">width</span>: <span class="number">130</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber130.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">65432445</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/TheChamber200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">675465</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">675465</span>, <span class="attr">width</span>: <span class="number">120</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture120.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">675465</span>, <span class="attr">width</span>: <span class="number">300</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/Fracture300.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">70111470</span>, <span class="attr">width</span>: <span class="number">150</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard150.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">70111470</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/DieHard200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">654356453</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys200.jpg"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">654356453</span>, <span class="attr">width</span>: <span class="number">140</span>, <span class="attr">height</span>:<span class="number">200</span>, <span class="attr">url</span>:<span class="string">"http://cdn-0.nflximg.com/images/2891/BadBoys140.jpg"</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    bookmarks = [</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">65432445</span>, <span class="attr">time</span>: <span class="number">32432</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">675465</span>, <span class="attr">time</span>: <span class="number">3534543</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">70111470</span>, <span class="attr">time</span>: <span class="number">645243</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">videoId</span>: <span class="number">654356453</span>, <span class="attr">time</span>: <span class="number">984934</span> &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> lists.map(<span class="function"><span class="params">list</span> =&gt;</span>(&#123;</span><br><span class="line">    name: list.name,</span><br><span class="line">    videos: videos</span><br><span class="line">              .filter(<span class="function"><span class="params">video</span> =&gt;</span> video.listId === list.id)</span><br><span class="line">              .concatMap(<span class="function"><span class="params">video</span> =&gt;</span></span><br><span class="line">                <span class="built_in">Array</span>.zip(</span><br><span class="line">                  bookmarks.filter(<span class="function"><span class="params">bookmark</span> =&gt;</span> bookmark.videoId === video.id),</span><br><span class="line">                  boxarts</span><br><span class="line">                    .filter(<span class="function"><span class="params">boxart</span> =&gt;</span> boxart.videoId === video.id)</span><br><span class="line">                    .reduce(<span class="function">(<span class="params">acc, curr</span>) =&gt;</span> acc.width * acc.height &lt; curr.width * curr.height ? acc : curr),</span><br><span class="line">                    (bookmark, boxart) =&gt; (&#123;</span><br><span class="line">                      id: video.id,</span><br><span class="line">                      title: video.title,</span><br><span class="line">                      time: bookmark.time,</span><br><span class="line">                      boxart: boxart.url</span><br><span class="line">                    &#125;)</span><br><span class="line">                )</span><br><span class="line">              )</span><br><span class="line">  &#125;)) <span class="comment">// complete this expression</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Wow! That’s a large query, but the code is still small relative to the amount of work it’s doing. If we rewrote this query with a series of loops our code would be much less self-describing. Loops don’t give the reader any information about the kind of operation being performed. Every time you see a loop, you need to carefully read through the code to find out what’s being done. Is it a projection? A filter? A reduction? Why use loops for querying data when we’ve demonstrated that the 5 functions can be used to create virtually any output we want?</p>
<h4 id="Exercise-27-Stock-Ticker"><a href="#Exercise-27-Stock-Ticker" class="headerlink" title="Exercise 27: Stock Ticker"></a>Exercise 27: Stock Ticker</h4><details><br><summary><br>Let’s try an easier question. Let’s say we have a collection of all of the prices for NASDAQ stocks over time. Every time the price of a stock changes on the NASDAQ ticker an entry is added to this collection. Let’s say that ten days ago you bought shares in Microsoft, and now you want to print all of the MSFT share prices since then. Filter the collection for MSFT trades starting from ten days ago and print each price record (including the time stamp) using the print() function. Note: this is not a trick question. It’s as easy as it seems.<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The pricesNASDAQ collection looks something like this...</span></span><br><span class="line"><span class="keyword">var</span> pricesNASDAQ = [</span><br><span class="line">  <span class="comment">// ... from the NASDAQ's opening day</span></span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"ANGI"</span>, <span class="attr">price</span>: <span class="number">31.22</span>, <span class="attr">timeStamp</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">15</span>) &#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"MSFT"</span>, <span class="attr">price</span>: <span class="number">32.32</span>, <span class="attr">timeStamp</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">15</span>) &#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"GOOG"</span>, <span class="attr">price</span>: <span class="number">150.43</span>, <span class="attr">timeStamp</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">15</span>)&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"ANGI"</span>, <span class="attr">price</span>: <span class="number">28.44</span>, <span class="attr">timeStamp</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">16</span>)&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"GOOG"</span>, <span class="attr">price</span>: <span class="number">199.33</span>, <span class="attr">timeStamp</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">16</span>)&#125;,</span><br><span class="line">  <span class="comment">// ...and up to the present.</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><br><br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">pricesNASDAQ, printRecord</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> microsoftPrices,</span><br><span class="line">    now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    tenDaysAgo = <span class="keyword">new</span> <span class="built_in">Date</span>( now.getFullYear(), now.getMonth(), now.getDate() - <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// use filter() to filter the trades for MSFT prices recorded any time after 10 days ago</span></span><br><span class="line">  microsoftPrices =</span><br><span class="line">    pricesNASDAQ.</span><br><span class="line">      filter(<span class="function"><span class="keyword">function</span>(<span class="params">priceRecord</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> priceRecord.timeStamp &gt; tenDaysAgo &amp;&amp; priceRecord.name === <span class="string">"MSFT"</span></span><br><span class="line">      &#125;<span class="comment">// finish this expression</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print the trades to the output console</span></span><br><span class="line">  microsoftPrices.</span><br><span class="line">    forEach(<span class="function"><span class="keyword">function</span>(<span class="params">priceRecord</span>) </span>&#123;</span><br><span class="line">      printRecord(priceRecord);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>Notice that the console is changing over time. Now look at the time stamps on the stock prices. We’re displaying stock prices sampled after we ran our program! How could our array have contained stock price records from the future? Did we accidentally rip a hole in the space-time continuum?</p>
<p>The solution to the riddle is that pricesNASDAQ is not an array. Unlike an array, which can only store a snapshot of stock prices, this new type can react to changes and update over time.</p>
<p>In the next section I’ll reveal the inner workings of this magical type. You’ll learn how you can use it to model everything from mouse events to asynchronous JSON requests. Finally I’ll show you how you can query this type using the 5 query functions you already know. It’s about time we gave this magical type a name…</p>
<h2 id="Handling-Events-with-Ovservables"><a href="#Handling-Events-with-Ovservables" class="headerlink" title="Handling Events with Ovservables"></a>Handling Events with Ovservables</h2><h3 id="Working-with-Observables"><a href="#Working-with-Observables" class="headerlink" title="Working with Observables"></a>Working with Observables</h3><p>Microsoft’s open-source Reactive Extensions library introduces a new collection type to Javascript: Observable. An Observable is a lot like an Event. Like an Event, an Observable is a sequence of values that a data producer pushes to the consumer. However unlike an Event, an Observable can signal to a listener that it has completed, and will send no more data.</p>
<p>微软的开源反应扩展库为Javascript引入了一种新的集合类型:Observable。可观察对象很像事件。与事件类似，可观察对象是数据生产者推送给消费者的一系列值。然而，与事件不同的是，一个可观察对象可以向侦听器发送它已经完成的信号，并且不会发送更多的数据。</p>
<p>Observables can send data to consumers asynchronously. Unlike Array, there’s no Javascript literal syntax for creating Observable sequences. However we can build a helper method that visually describes the contents of sequences as well as the times between each item’s arrival. The seq function creates an Observable from an array of items, and adds a delay for every empty item encountered. Every ,,, adds up to a second.</p>
<p>可观察对象可以异步地向消费者发送数据。与数组不同的是，没有用于创建可观察序列的Javascript文字语法。但是，我们可以构建一个帮助器方法，它可以直观地描述序列的内容以及每个条目到达之间的时间。seq函数从一个项目数组中创建一个可观察对象，并为遇到的每个空项目添加一个延迟。每…加起来是一秒。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// An array of numbers 1,2,3</span></span><br><span class="line"><span class="keyword">var</span> numbers123Array =      [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// A sequence that returns 1, and then after 4 seconds returns 2,</span></span><br><span class="line"><span class="comment">// and then after another second returns 3, and then completes.</span></span><br><span class="line"><span class="keyword">var</span> numbers123Observable = seq([<span class="number">1</span>,,,,,,,,,,,,<span class="number">2</span>,,,<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Like Arrays, Observables can contain any object - even Arrays.</span></span><br><span class="line"><span class="keyword">var</span> observableOfArrays = seq([ [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],,,,,,[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],,,,,,,,,,,[<span class="number">1</span>,<span class="number">2</span>] ]);</span><br></pre></td></tr></table></figure>
<p>Observables are a sequence of values, delivered one after the other. Therefore it’s possible that an Observable can go on sending data to a listener forever just like a mouse move event. To create a sequence that doesn’t complete, you can add a trailing ,,, to the end of the items passed to seq().</p>
<p>可观察值是一系列值，一个接一个地交付。因此，一个可观察对象可能会像鼠标移动事件一样，一直向侦听器发送数据。要创建不完整的序列，可以在传递给seq()的项的末尾添加尾随…。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The trailing ,,, ensures that the sequence will not complete.</span></span><br><span class="line"><span class="keyword">var</span> mouseMovesObservable =</span><br><span class="line">  seq([ &#123;<span class="attr">x</span>: <span class="number">23</span>, <span class="attr">y</span>: <span class="number">55</span>&#125;,,,,,,,&#123;<span class="attr">x</span>: <span class="number">44</span>, <span class="attr">y</span>: <span class="number">99</span>&#125;,,,&#123;<span class="attr">x</span>:<span class="number">55</span>,<span class="attr">y</span>:<span class="number">99</span>&#125;,,,&#123;<span class="attr">x</span>: <span class="number">54</span>, <span class="attr">y</span>:<span class="number">543</span>&#125;,,, ]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// No trailing ,,, indicates that sequence will complete.</span></span><br><span class="line"><span class="keyword">var</span> numbers123Observable = seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>]);</span><br></pre></td></tr></table></figure>
<p>Querying Arrays only gives us a snapshot. By contrast, querying Observables allows us to create data sets that react and update as the system changes over time. This enables a very powerful type of programming known as reactive programming.</p>
<p>查询数组只给我们一个快照。相比之下，查询Observables允许我们创建数据集，这些数据集会随着系统的变化做出反应并进行更新。这支持一种非常强大的编程类型，称为反应性编程。</p>
<p>Let’s start off by contrasting Observable with Events…</p>
<p>让我们从可观察到的与事件的对比开始…</p>
<h4 id="Exercise-28-Subscribing-to-an-event"><a href="#Exercise-28-Subscribing-to-an-event" class="headerlink" title="Exercise 28: Subscribing to an event"></a>Exercise 28: Subscribing to an event</h4><p>You’re probably used to thinking about events as a list of handlers stored in an object. In this example, we subscribe to a button click event and then unsubscribe the first time the button is clicked.</p>
<p>您可能习惯于将事件看作存储在对象中的处理程序列表。在本例中，我们订阅按钮单击事件，然后在第一次单击按钮时取消订阅。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">button</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// the button click handler</span></span><br><span class="line">  <span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Unsubscribe from the button event.</span></span><br><span class="line">    button.removeEventListener(<span class="string">"click"</span>, handler);</span><br><span class="line"></span><br><span class="line">    alert(<span class="string">"Button was clicked. Unsubscribing from event."</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add the button click handler</span></span><br><span class="line">  button.addEventListener(<span class="string">"click"</span>, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ask yourself this question: How is subscribing to an event different than traversing an array? Both operations involve sending a listener a sequence of items by repeatedly invoking a function. So why can’t we traverse Arrays and Events the same way?</p>
<p>问问你自己这个问题:订阅一个事件和遍历一个数组有什么不同?这两种操作都涉及通过反复调用函数向侦听器发送项目序列。为什么我们不能以相同的方式遍历数组和事件呢?</p>
<h4 id="Exercise-29-Traversing-an-Event"><a href="#Exercise-29-Traversing-an-Event" class="headerlink" title="Exercise 29: Traversing an Event"></a>Exercise 29: Traversing an Event</h4><p>Subscribing to an Event and traversing an Array are fundamentally the same operation. The only difference is that Array traversal is synchronous and completes, and Event traversal is asynchronous and never completes. If we convert a button click Event to an Observable object, we can use do() to traverse the Event.</p>
<p>订阅事件和遍历数组基本上是相同的操作。唯一的区别是数组遍历是同步的并完成的，而事件遍历是异步的，并且永远不会完成。如果将按钮单击事件转换为可观察对象，则可以使用do()遍历该事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">button</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> buttonClicks = Observable.fromEvent(button, <span class="string">"click"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> subscription =</span><br><span class="line">    buttonClicks.</span><br><span class="line">      <span class="keyword">do</span>(<span class="function"><span class="keyword">function</span>(<span class="params">clickEvent</span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">"Button was clicked. Stopping Traversal."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Stop traversing the button clicks</span></span><br><span class="line">        subscription.unsubscribe();</span><br><span class="line">      &#125;).</span><br><span class="line">      subscribe();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that Observable’s forEach() function returns a Subscription object. Disposing of a Subscription object unsubscribes from the event and prevents memory leaks. Disposing of a subscription is the asynchronous equivalent of stopping half-way through a counting for loop.</p>
<p>注意，Observable的forEach()函数返回一个订阅对象。处理订阅对象将从事件中取消订阅，并防止内存泄漏。处理订阅相当于在循环计数的中途停止异步操作。</p>
<p>Disposing of a Subscription object is basically the same as calling removeEventListener(). On the surface, these two approaches to Event handling don’t seem to be very different. Under the circumstances, why should we bother converting Events to Observables? The reason is that if we convert Events to Observable Objects, we can use powerful functions to transform them. In the next exercise we’ll learn how we can use one such function to avoid dealing with Subscriptions in many cases…</p>
<p>处理订阅对象与调用removeEventListener()基本相同。从表面上看，这两种事件处理方法似乎没有太大的不同。在这种情况下，我们为什么要把事件转换成可观测的呢?原因是，如果我们将事件转换为Observable，我们可以使用强大的函数来转换它们。在下一个练习中，我们将学习如何使用一个这样的函数来避免在许多情况下处理订阅…</p>
<h4 id="Exercise-30-Completing-Sequences-with-take"><a href="#Exercise-30-Completing-Sequences-with-take" class="headerlink" title="Exercise 30: Completing Sequences with take()"></a>Exercise 30: Completing Sequences with take()</h4><p>Have you ever wished that you could listen for the next occurrence of an event and then immediately unsubscribe? For example, developers will often attach an event handler to window.onload, expecting that their event handler will only be called once.</p>
<p>你是否曾经希望你可以收听下一个事件的发生，然后立即取消订阅?例如，开发人员经常将事件处理程序附加到<code>window.onload</code>，期望它们的事件处理程序只被调用一次。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(</span><br><span class="line">  <span class="string">"load"</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    // <span class="title">do</span> <span class="title">some</span> <span class="title">work</span> <span class="title">here</span>, <span class="title">but</span> <span class="title">expect</span> <span class="title">this</span> <span class="title">function</span> <span class="title">will</span> <span class="title">only</span> <span class="title">be</span> <span class="title">called</span> <span class="title">once</span>.</span></span><br><span class="line"><span class="function">  &#125;)</span></span><br></pre></td></tr></table></figure>
<p>In instances such as this, it’s good practice to unsubscribe from the event after it’s fired. Failing to unsubscribe is a memory leak. Depending on the circumstances, memory leaks can seriously destablize your application and can be very difficult to track down. Unfortunately unsubscribing from an event after one occurrence can be cumbersome:</p>
<p>在这种情况下，最好在事件触发后取消订阅。未能取消订阅会造成内存泄漏。根据不同的情况，内存泄漏会严重破坏应用程序的性能，并且很难跟踪。不幸的是，在事件发生后取消订阅可能很麻烦:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do some work here, then unsubscribe from the event</span></span><br><span class="line">  <span class="built_in">window</span>.removeEventListener(<span class="string">"load"</span>, handler)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, handler);</span><br></pre></td></tr></table></figure>
<p>Wouldn’t it be nice if there was an easier way to code this? That’s why Observable has a take() function. The take() function works like this…</p>
<p>如果有一种更简单的编码方法不是很好吗?这就是为什么Observable有一个take()函数。take()函数的工作原理是这样的……</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,,<span class="number">4</span>,,,<span class="number">5</span>,,,<span class="number">6</span>,,,]).take(<span class="number">3</span>) === seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>]);</span><br></pre></td></tr></table></figure>
<p>An Observable based on an Event will never complete on its own. The take() function creates a new sequence that completes after a discrete number of items arrive. This is important, because unlike an Event, when an Observable sequence completes it unsubscribes all of its listeners. That means that if we use take() to complete our Event sequence, we don’t need to unsubscribe!</p>
<p>基于事件的可观察性永远不会自己完成。<code>take()</code>函数的作用是:创建一个新序列，该序列在到达离散数量的项之后完成。这一点很重要，因为与事件不同，当一个可观察序列完成时，它会取消所有侦听器的订阅。这意味着如果我们使用take()来完成事件序列，就不需要取消订阅!</p>
<details><br><summary><br>Let’s repeat the previous exercise, in which we listened for a single button click and then unsubscribed. This time let’s use the take() function to complete the sequence after the button is clicked.<br><br>让我们重复前面的练习，在该练习中，我们侦听单个按钮单击，然后取消订阅。这次我们使用take()函数在单击按钮后完成序列。<br></summary><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">button</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> buttonClicks = Observable.fromEvent(button, <span class="string">"click"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use take() to listen for only one button click</span></span><br><span class="line">  <span class="comment">// and unsubscribe.</span></span><br><span class="line">  buttonClicks.</span><br><span class="line">    <span class="comment">// Insert take() call here</span></span><br><span class="line">    take(<span class="number">1</span>).</span><br><span class="line">    forEach(<span class="function"><span class="keyword">function</span>(<span class="params">clickEvent</span>) </span>&#123;</span><br><span class="line">      alert(<span class="string">"Button was clicked once. Stopping Traversal."</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></details>

<p>The take() function is great way of listening for a discrete number of events and then unsubscribing, but Observable has an even more flexible function that we can use to complete sequences…</p>
<p>take()函数是侦听离散事件数量然后取消订阅的好方法，但是Observable有一个更灵活的函数，我们可以使用它来完成序列……</p>
<h4 id="Exercise-31-Completing-sequences-with-takeUntil"><a href="#Exercise-31-Completing-sequences-with-takeUntil" class="headerlink" title="Exercise 31: Completing sequences with takeUntil()"></a>Exercise 31: Completing sequences with takeUntil()</h4><p>Have you ever wanted to unsubscribe from one Event when another Event fires? Observable’s takeUntil() function is a convenient way of completing a sequence when another Event occurs. Here’s how takeUntil() works:</p>
<p>您是否曾经想在另一个事件触发时取消订阅某个事件?Observable的takeUntil()函数是在另一个事件发生时完成序列的一种方便方法。下面是takeUntil()的工作原理:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbersUntilStopButtonPressed =</span><br><span class="line">  seq(              [ <span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,,<span class="number">4</span>,,,<span class="number">5</span>,,,<span class="number">6</span>,,,<span class="number">7</span>,,,<span class="number">8</span>,,,<span class="number">9</span>,,, ]).</span><br><span class="line">    takeUntil(seq([  ,,, &#123;<span class="attr">eventType</span>: <span class="string">"click"</span>&#125;,,, ]) )                    === seq([ <span class="number">1</span>,,,<span class="number">2</span> ])</span><br></pre></td></tr></table></figure>
<p>Earlier we (unknowningly) built a dynamic Microsoft price stock ticker using Observable. The problem with that stock ticker was that it kept going on forever. If left unchecked, all the entries in the log could use up all of the memory on the page. In the exercise below, filter the Observable sequence of NASDAQ prices for MSFT stock prices, use the fromEvent() function to create an Observable .</p>
<p>早些时候，我们(不知不觉地)使用Observable构建了一个动态的Microsoft price股票行情。股票行情的问题是它会一直持续下去。如果不选中，日志中的所有条目都可能耗尽页面上的所有内存。在下面的练习中，过滤MSFT股票价格的NASDAQ价格的可观察序列，使用fromEvent()函数创建一个可观察的序列。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">pricesNASDAQ, printRecord, stopButton</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> stopButtonClicks = Observable.fromEvent(stopButton, <span class="string">'click'</span>)<span class="comment">// ----- To finish this expression, use Observable.fromEvent to convert the "click" event on the stop button to an Observable</span></span><br><span class="line">    microsoftPrices =</span><br><span class="line">      pricesNASDAQ.</span><br><span class="line">        filter(<span class="function"><span class="keyword">function</span>(<span class="params">priceRecord</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> priceRecord.name === <span class="string">"MSFT"</span>;</span><br><span class="line">        &#125;).</span><br><span class="line">        takeUntil(stopButtonClicks)<span class="comment">// ----- To finish this expression, use takeUntil to complete the sequence when stopButtonClicks fires.</span></span><br><span class="line"></span><br><span class="line">  microsoftPrices.</span><br><span class="line">    forEach(<span class="function"><span class="keyword">function</span>(<span class="params">priceRecord</span>) </span>&#123;</span><br><span class="line">      printRecord(priceRecord);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ve learned that Observable sequences are much more powerful than raw events, because they can complete. The take() and takeUntil() functions are powerful enough to ensure that we never have to unsubscribe from another event again! This reduces the risk of memory leaks and makes our code more readable.</p>
<p>我们已经知道，可观察序列比原始事件强大得多，因为它们可以完成。take()和takeUntil()函数功能强大，足以确保我们再也不必取消订阅另一个事件!这降低了内存泄漏的风险，并使我们的代码更具可读性。</p>
<p>Here’s what we learned in this section:<br>以下是我们在这一节中学到的:</p>
<ul>
<li>We can traverse Observables using forEach().<br>我们可以使用forEach()遍历可观察对象。</li>
<li>We can use fromEvent() to convert Events into Observables that never complete.<br>我们可以使用fromEvent()将事件转换为永不完成的可观察对象。</li>
<li>We can apply take() and takeUntil() to an Observable to create a new sequence which does complete.<br>我们可以将take()和takeUntil()应用于一个可观察对象，以创建一个完成的新序列。</li>
</ul>
<p>In the next section we’ll learn how to combine events to create more complex events. You’ll be suprised how easily you can solve complex, asynchronous problems!</p>
<p>在下一节中，我们将学习如何组合事件来创建更复杂的事件。您会惊奇地发现，您可以轻松地解决复杂的异步问题!</p>
<h3 id="Querying-Observables"><a href="#Querying-Observables" class="headerlink" title="Querying Observables"></a>Querying Observables</h3><p>What’s the difference between these two tasks?<br>What’s the difference between these two tasks?</p>
<ol>
<li>Creating a flat list of movies with a rating of 5.0 from a bunch of movie lists.<br>从一堆电影列表中创建一个评分为5.0的电影列表。</li>
<li>Creating a sequence of all the mouse drag events from the mouseDown, mouseMove, and mouseUp events.<br>从mouseDown、mouseMove和mouseUp事件创建所有鼠标拖动事件的序列。</li>
</ol>
<p>You might think of them as different, and might code them very differently, but <strong>these tasks are fundamentally the same</strong>. Both of these tasks are queries, and can be solved using the functions you’ve learned in these exercises.</p>
<p>您可能认为它们是不同的，并且代码也可能非常不同，但是<strong>这些任务本质上是相同的</strong>。这两个任务都是查询，可以使用您在这些练习中所学到的函数来解决。</p>
<p><strong>The difference between traversing an Array and traversing an Observable is <em>the direction in which the data moves.</em></strong> When traversing an Array, the client pulls data from the data source, blocking until it gets a result. When traversing Observables, the data source pushes data at the client whenever it arrives.</p>
<p><strong>遍历数组和遍历可观察对象的区别在于<em>数据移动的方向</em></strong>。遍历数组时，客户机从数据源中提取数据，并进行阻塞，直到得到结果。当遍历可观察对象时，数据源将数据推送到客户机。</p>
<p>It turns out that the direction in which data moves is orthogonal to querying that data. In other words, <strong>when we’re querying data it doesn’t matter whether we pull data, or data is pushed at us</strong>. In either case the query methods make the same transformations. The only thing that changes is the input and output type respectively. If we filter an Array, we get a new Array. If we filter an Observable, we get a new Observable, and so on.</p>
<p>事实证明，数据移动的方向与查询该数据是正交的。换句话说，<strong>当我们查询数据时，是拉数据还是数据被推入并不重要</strong>。在这两种情况下，查询方法都执行相同的转换。惟一改变的是输入和输出类型。如果我们过滤一个数组，我们会得到一个新的数组。如果我们过滤一个Observable，我们会得到一个新的Observable，以此类推。</p>
<p>Take a look at how the query methods transform Observables and Arrays:<br>看看查询方法如何转换可观察对象和数组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map()</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>)                                         === [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>]).map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x + <span class="number">1</span>&#125;)               === seq([<span class="number">2</span>,,,<span class="number">3</span>,,,<span class="number">4</span>])</span><br><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,,]).map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x + <span class="number">1</span> &#125;)           === seq([<span class="number">2</span>,,,<span class="number">3</span>,,,<span class="number">4</span>,,,])</span><br><span class="line"></span><br><span class="line"><span class="comment">// filter()</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &gt; <span class="number">1</span>; &#125;)                   === [<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>]).filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &gt; <span class="number">1</span>; &#125;)          === seq([<span class="number">2</span>,,,<span class="number">3</span>])</span><br><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,,]).filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &gt; <span class="number">1</span>; &#125;)       === seq([<span class="number">2</span>,,,<span class="number">3</span>,,,])</span><br><span class="line"></span><br><span class="line"><span class="comment">// concatAll()</span></span><br><span class="line"></span><br><span class="line">[ [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] ].concatAll()                             === [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">seq([ seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>]),,,seq([<span class="number">4</span>,,,<span class="number">5</span>,,,<span class="number">6</span>]) ]).concatAll()         === seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,,<span class="number">4</span>,,,<span class="number">5</span>,,,<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// If a new sequence arrives before all the items</span></span><br><span class="line"><span class="comment">// from the previous sequence have arrived, no attempt</span></span><br><span class="line"><span class="comment">// to retrieve the new sequence's elements is made until</span></span><br><span class="line"><span class="comment">// the previous sequence has completed. As a result the</span></span><br><span class="line"><span class="comment">// order of elements in the sequence is preserved.</span></span><br><span class="line"><span class="comment">/** 如果一个新序列在前一个序列的所有项到达之前到达，</span></span><br><span class="line"><span class="comment"> * 则在前一个序列完成之前不会尝试检索新序列的元素。</span></span><br><span class="line"><span class="comment"> * 结果保留了序列中元素的顺序。</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">seq([</span><br><span class="line">  seq([<span class="number">1</span>,,,, ,<span class="number">2</span>, ,<span class="number">3</span>])</span><br><span class="line">  ,,,seq([,,<span class="number">4</span>, ,<span class="number">5</span>, ,,<span class="number">6</span>]) ]).</span><br><span class="line">  concatAll()                                                  === seq([<span class="number">1</span>,,,,,<span class="number">2</span>,,<span class="number">3</span>,,<span class="number">4</span>,,<span class="number">5</span>,,,<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notice that as long as at least one sequence being</span></span><br><span class="line"><span class="comment">// concatenated is incomplete, the concatenated sequence is also</span></span><br><span class="line"><span class="comment">// incomplete.</span></span><br><span class="line">seq([</span><br><span class="line">  seq([<span class="number">1</span>,, ,,, ,,,<span class="number">2</span>,,,<span class="number">3</span>])</span><br><span class="line">  ,,,seq([<span class="number">4</span>,,,<span class="number">5</span>,,, ,,, ,,<span class="number">6</span>,,,]) ]).</span><br><span class="line">  concatAll()                                                  === seq([<span class="number">1</span>,,,,,,,,<span class="number">2</span>,,,<span class="number">3</span>,<span class="number">4</span>,,,<span class="number">5</span>,,,,,,,,<span class="number">6</span>,,,])</span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce()</span></span><br><span class="line"></span><br><span class="line">[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ].reduce(sumFunction)                                 === [ <span class="number">6</span> ]</span><br><span class="line">seq([ <span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span> ]).reduce(sumFunction)                          === seq([,,,,,,<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reduced sequences do not complete until the sequence does.</span></span><br><span class="line">seq([ <span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,, ]).reduce(sumFunction)                       === seq([ ,,,,,,,,,])</span><br><span class="line"></span><br><span class="line"><span class="comment">// zip()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In both Arrays and Observables, the zipped sequence</span></span><br><span class="line"><span class="comment">// completes as soon as either the left or right-hand</span></span><br><span class="line"><span class="comment">// side sequence completes.</span></span><br><span class="line"><span class="built_in">Array</span>.zip([<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], sumFunction)                           === [<span class="number">4</span>,<span class="number">6</span>]</span><br><span class="line">Observable.zip(seq([<span class="number">1</span>,,,<span class="number">2</span>]),seq([<span class="number">3</span>,,,<span class="number">4</span>,,,<span class="number">5</span>]), sumFunction)      === seq([<span class="number">4</span>,,,<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// take()</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].take(<span class="number">2</span>)                                                 === [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">seq([ <span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span> ]).take(<span class="number">2</span>)                                      === seq([ <span class="number">1</span>,,,<span class="number">2</span> ])</span><br><span class="line">seq([ <span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,, ]).take(<span class="number">2</span>)                                   === seq([ <span class="number">1</span>,,,<span class="number">2</span> ])</span><br><span class="line"></span><br><span class="line"><span class="comment">// takeUntil()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// takeUntil works for Arrays, but it's not very useful</span></span><br><span class="line"><span class="comment">// because the result will always be an empty array.</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].takeUntil([<span class="number">1</span>])                                          === []</span><br><span class="line"></span><br><span class="line">seq([<span class="number">1</span>,,,<span class="number">2</span>,,,<span class="number">3</span>,,, ]).takeUntil(</span><br><span class="line">seq([ ,,, ,,<span class="number">4</span> , ]))                                             === seq([ <span class="number">1</span>,,,<span class="number">2</span> ])</span><br></pre></td></tr></table></figure>
<p>Remember when I prohibited the use of array indexers? The reason for that restriction should now become clearer to you. Whereas the 5 functions can be used on any collection, indexers can only be used on collections that support random-access (like Array). If you avoid indexers and stick to the functions you’ve learned in this tutorial, you’ll have a unified programming model for transforming any collection. Having a unified programming model makes it trivial to convert synchronous code to asynchronous code, a process which would otherwise be very difficult. As we’ve demonstrated, you don’t need indexers to perform complex collection transformations.</p>
<p>还记得我什么时候禁止使用数组索引器吗?这个限制的原因现在应该对您更清楚了。这5个函数可以用于任何集合，而索引器只能用于支持随机访问的集合(如数组)。如果您避免使用索引器并坚持使用本教程中学习的函数，您将拥有一个用于转换任何集合的统一编程模型。拥有统一的编程模型使得将同步代码转换为异步代码变得非常简单，否则这将是一个非常困难的过程。正如我们所演示的，您不需要索引器来执行复杂的集合转换。</p>
<p>Now that we’ve seen that we can query asychronous and synchronous data sources using the same programming model, let’s use Observable and our query functions to create complex new events.</p>
<p>既然我们已经看到可以使用相同的编程模型查询同步数据源，那么让我们使用Observable和查询函数来创建复杂的新事件。</p>
<h3 id="Observable-amp-Events"><a href="#Observable-amp-Events" class="headerlink" title="Observable &amp; Events"></a>Observable &amp; Events</h3><p>通过Observable，我们可以把一个事件转换为一个数据流，根据通过组织数据流的结构来按照我们想要的顺序返回一个新的数据流。这样就可以把复杂的异步交互转换为同步的数据流来进行处理。</p>
<h3 id="Anatomy-of-Observable"><a href="#Anatomy-of-Observable" class="headerlink" title="Anatomy of Observable"></a>Anatomy of Observable</h3><p>Observable只会产出数据流，在使用froEach方法之前并不会对数据进行操作。Observable只是将函数传入另一个函数，最终将其组合起来，创建一个新的组合函数，使用forEach进行使用。</p>
<p>Observable就是一个拥有forEach方法的对象，forEach分别接受三个参数：onNext, onError, onComplete三个参数来处理三种情况。</p>
<h3 id="Creating-a-setTimeout-Observable"><a href="#Creating-a-setTimeout-Observable" class="headerlink" title="Creating a setTimeout Observable"></a>Creating a setTimeout Observable</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    forEach(observer) &#123;</span><br><span class="line">      <span class="keyword">const</span> handle =</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          observer.onNext(<span class="literal">undefined</span>),</span><br><span class="line">          observer.onCompleted()</span><br><span class="line">        &#125;, time)</span><br><span class="line">      <span class="comment">// subscription</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        dispose() &#123;</span><br><span class="line">          clearTimeout(handle)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(<span class="number">500</span>).forEach(&#123;</span><br><span class="line">  onNext: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'timeout'</span>),</span><br><span class="line">  onCompleted: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'onComplete'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fromEvent</span>(<span class="params">dom, eventName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    forEach(observer) &#123;</span><br><span class="line">      <span class="keyword">const</span> handler = <span class="function"><span class="params">e</span> =&gt;</span> observer.onNext(e)</span><br><span class="line">      dom.addEventListener(eventName, handler)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        dispose() &#123;</span><br><span class="line">          removeEventListener(eventName, handler)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Observable-vs-Promise"><a href="#Observable-vs-Promise" class="headerlink" title="Observable vs. Promise"></a>Observable vs. Promise</h3><p>Observable在创建时只是创建了数据流，Promise创建时会立即返回一个promise对象，并调用浏览器API，所以Observable是懒惰模式，promise是饥饿模式。promise一经调用就无法取消。使用Observable可以轻松地retry，但是promise就比较复杂。使用observable可以传入promise对象，但是promise对象中无法使用observable。</p>
<h4 id="Exercise-32-Creating-a-mouse-drag-event"><a href="#Exercise-32-Creating-a-mouse-drag-event" class="headerlink" title="Exercise 32: Creating a mouse drag event"></a>Exercise 32: Creating a mouse drag event</h4><p>Remember the exercise we solved earlier? The one in which we retrieved all the movies with a rating of 5.0 from an array of movie lists? If we were to describe the solution in pseudocode it might read something like this…</p>
<p>还记得我们之前解过的题吗?我们从一组电影列表中检索评分为5.0的所有电影?如果我们用伪代码来描述解决方案，它可能是这样的……</p>
<p>“For every movie list, retrieve only those videos with a rating of 5.0”</p>
<p>“对于每个电影列表，只检索评分为5.0的视频”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moviesWithHighRatings =</span><br><span class="line">  movieLists</span><br><span class="line">    .concatMap(<span class="function"><span class="params">movieList</span> =&gt;</span></span><br><span class="line">      movieList.videos</span><br><span class="line">        .filter(<span class="function"><span class="params">video</span> =&gt;</span> video.rating === <span class="number">5.0</span>)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>Now we’re going to create a mouseDrag event for a DOM object. If we were to describe this problem as pseudocode it might read something like this…</p>
<p>现在我们要为DOM对象创建一个mouseDrag事件。如果我们把这个问题描述为伪代码，它可能是这样的……</p>
<p>“For every movie list mouse down event on the sprite, retrieve only those videos with a rating of 5.0 mouse move events that occur before the next mouse up event.”</p>
<p>“对于sprite上的每个电影列表鼠标下拉事件，只检索那些在下一次鼠标上拉事件之前发生的评分为5.0的鼠标移动事件的视频。”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">sprite, spriteContainer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> spriteMouseDowns = Observable.fromEvent(sprite, <span class="string">'mousedown'</span>),</span><br><span class="line">      spriteContainerMouseMoves = Observable.fromEvent(spriteContainer, <span class="string">'mousemove'</span>),</span><br><span class="line">      spriteContainerMOuseUps = Observable.fromEvent(spriteContainer, <span class="string">'mouseup'</span>),</span><br><span class="line">      spriteMouseDrags =</span><br><span class="line">        spriteMouseDowns</span><br><span class="line">          .concatMap(<span class="function"><span class="params">concatPoint</span> =&gt;</span></span><br><span class="line">            srriteContainerMouseMoves <span class="comment">// ...retrieve all the mouse move events on the sprite container...</span></span><br><span class="line">              .takeUntils(spriteContainerMOuseUps) <span class="comment">// ...until a mouse up event occurs.</span></span><br><span class="line">          )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For each mouse drag event, move the sprite to the absolute page position.</span></span><br><span class="line">  spriteMouseDrags.forEach(<span class="function"><span class="params">dragPoint</span> =&gt;</span> &#123;</span><br><span class="line">    sprite.style.left = dragPoint.pageX + <span class="string">'px'</span></span><br><span class="line">    sprite.style.top = dragPoint.pageY + <span class="string">'px'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we’re really cooking. We just created a complex event with a few lines of code. We didn’t have to deal with any subscriptions objects, or write any stateful code whatsoever. Let’s try something a little harder.</p>
<p>现在我们真的在做饭。我们刚刚用几行代码创建了一个复杂的事件。我们不需要处理任何订阅对象，也不需要编写任何有状态代码。让我们再努力一点。</p>
<h4 id="Exercise-33-Improving-our-mouse-drag-event"><a href="#Exercise-33-Improving-our-mouse-drag-event" class="headerlink" title="Exercise 33: Improving our mouse drag event"></a>Exercise 33: Improving our mouse drag event</h4><p>Our mouse drag event is a little too simple. Notice that when we drag around the sprite, it always positions itself at the top-left corner of the mouse. Ideally we’d like our drag event to offset its coordinates, based on where the mouse was when the mouse down event occurred. This will make our mouse drag more closely resemble moving a real object with our finger.</p>
<p>我们的鼠标拖动事件有点太简单了。注意，当我们拖动sprite时，它总是将自己定位在鼠标的左上角。理想情况下，我们希望我们的拖动事件偏移它的坐标，基于鼠标在鼠标下拉事件发生时的位置。这将使我们的鼠标拖动更接近于用手指移动一个真实的物体。</p>
<p>Let’s see if you can adjust the coordinates in the mouse drag event, based on the mousedown location on the sprite. The mouse events are sequences, and they look something like this:</p>
<p>让我们看看是否可以根据sprite上的mousedown位置在鼠标拖动事件中调整坐标。鼠标事件是序列，它们看起来像这样:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spriteContainerMouseMoves =</span><br><span class="line">  seq([ &#123;<span class="attr">x</span>: <span class="number">200</span>, <span class="attr">y</span>: <span class="number">400</span>, <span class="attr">layerX</span>: <span class="number">10</span>, <span class="attr">layerY</span>: <span class="number">15</span>&#125;,,,&#123;<span class="attr">x</span>: <span class="number">210</span>, <span class="attr">y</span>: <span class="number">410</span>, <span class="attr">layerX</span>: <span class="number">20</span>, <span class="attr">layerY</span>: <span class="number">26</span>&#125;,,, ])</span><br></pre></td></tr></table></figure>
<p>Each item in the mouse event sequences contains an x, y value that represents that absolute location of the mouse event on the page. The moveSprite() function uses these coordinates to position the sprite. Each item in the sequence also contains a pair of layerX and layerY properties that indicate the position of the mouse event relative to the event target.</p>
<p>鼠标事件序列中的每个项都包含一个x, y值，表示鼠标事件在页面上的绝对位置。 moveSprite()函数的作用是:使用这些坐标来定位sprite。序列中的每个项还包含一对layerX和layerY属性，它们指示鼠标事件相对于事件目标的位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">sprite, spriteContainer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// All of the mouse event sequences look like this:</span></span><br><span class="line">  <span class="comment">// seq([ &#123;pageX: 22, pageY: 3423, layerX: 14, layerY: 22&#125; ,,, ])</span></span><br><span class="line">  <span class="keyword">var</span> spriteMouseDowns = Observable.fromEvent(sprite, <span class="string">"mousedown"</span>),</span><br><span class="line">    spriteContainerMouseMoves = Observable.fromEvent(spriteContainer, <span class="string">"mousemove"</span>),</span><br><span class="line">    spriteContainerMouseUps = Observable.fromEvent(spriteContainer, <span class="string">"mouseup"</span>),</span><br><span class="line">    <span class="comment">// Create a sequence that looks like this:</span></span><br><span class="line">    <span class="comment">// seq([ &#123;pageX: 22, pageY:4080 &#125;,,,&#123;pageX: 24, pageY: 4082&#125;,,, ])</span></span><br><span class="line">    spriteMouseDrags =</span><br><span class="line">      <span class="comment">// For every mouse down event on the sprite...</span></span><br><span class="line">      spriteMouseDowns.</span><br><span class="line">        concatMap(<span class="function"><span class="keyword">function</span>(<span class="params">contactPoint</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// ...retrieve all the mouse move events on the sprite container...</span></span><br><span class="line">          <span class="keyword">return</span> spriteContainerMouseMoves.</span><br><span class="line">            <span class="comment">// ...until a mouse up event occurs.</span></span><br><span class="line">            takeUntil(spriteContainerMouseUps).</span><br><span class="line">            <span class="comment">// ------------   INSERT CODE HERE  -----------------</span></span><br><span class="line">            <span class="comment">// Project each mouse move object into a new object</span></span><br><span class="line">            <span class="comment">// with adjusted pageX and pageY properties.</span></span><br><span class="line">            <span class="comment">// Translate each page coordinate based on the value</span></span><br><span class="line">            <span class="comment">// of the layerX and layerY properties in the</span></span><br><span class="line">            <span class="comment">// contactPoint.</span></span><br><span class="line">            <span class="comment">// -------------------------------------------------</span></span><br><span class="line">            <span class="comment">// Complete expression...</span></span><br><span class="line">            map(<span class="function"><span class="params">movePoint</span> =&gt;</span> (&#123;</span><br><span class="line">              pageX: movePoint.pageX - contactPoint.layerX,</span><br><span class="line">              pageY: movePoint.pageY - contactPoint.layerY</span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For each mouse drag event, move the sprite to the absolute page position.</span></span><br><span class="line">  spriteMouseDrags.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dragPoint</span>) </span>&#123;</span><br><span class="line">    sprite.style.left = dragPoint.pageX + <span class="string">"px"</span>;</span><br><span class="line">    sprite.style.top = dragPoint.pageY + <span class="string">"px"</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Handing-HTTP-Requests-with-Observables"><a href="#Handing-HTTP-Requests-with-Observables" class="headerlink" title="Handing HTTP Requests with Observables"></a>Handing HTTP Requests with Observables</h2><h3 id="Exercise-34-HTTP-request"><a href="#Exercise-34-HTTP-request" class="headerlink" title="Exercise 34: HTTP request"></a>Exercise 34: HTTP request</h3><p>可以使用<a href="https://jsbin.com/?html,css,js,output" target="_blank" rel="noopener">jsbin</a>来引入库并书写执行代码。</p>
<p>Events aren’t the only source of asynchronous data in an application. There’s also HTTP requests. Most of the time HTTP requests are exposed via a callback-based API. To receive data asynchronously from a callback-based API, the client typically passes a success and error handler to the function. When the asynchronous operation completes, the appropriate handler is called with the data. In this exercise we’ll use jQuery’s getJSON api to asynchronously retrieve data.</p>
<p>事件不是应用程序中异步数据的唯一来源。还有HTTP请求。大多数时候HTTP请求是通过基于回调的API公开的。为了异步地从基于回调的API接收数据，客户机通常将一个成功和错误处理程序传递给函数。当异步操作完成时，将使用数据调用适当的处理程序。在本练习中，我们将使用jQuery的getJSON api异步检索数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">  $.getJSON(</span><br><span class="line">    <span class="string">"http://api-global.netflix.com/queue"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">"Data has arrived."</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="keyword">function</span>(<span class="params">ex</span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">"There was an error."</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Observable-In-Depth"><a href="#Observable-In-Depth" class="headerlink" title="Observable In-Depth"></a>Observable In-Depth</h2><h3 id="Creating-an-Observable-Class"><a href="#Creating-an-Observable-Class" class="headerlink" title="Creating an Observable Class"></a>Creating an Observable Class</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Observable构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observable</span>(<span class="params">forEach</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._forEach = forEach</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observable.prototype = &#123;</span><br><span class="line">  forEach(onNext, onError, onCompleted) &#123; <span class="comment">// 传入的参数是函数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onNext === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._forEach(&#123;</span><br><span class="line">        onNext: onNext,</span><br><span class="line">        onError: onError || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        onCompleted: onCompleted || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 传入的是一个observer对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._forEach(onNext)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observable.fromEvent = <span class="function"><span class="keyword">function</span> <span class="title">fromEvent</span>(<span class="params">dom, eventName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="function"><span class="params">event</span> =&gt;</span> observer.onNext(event)</span><br><span class="line">    dom.addEventListener(eventName, handler)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      dispose() &#123;</span><br><span class="line">        dom.removeEventListener(eventName, handler)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Observable-Map-Function"><a href="#Observable-Map-Function" class="headerlink" title="Observable Map Function"></a>Observable Map Function</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Observable.prototype = &#123;</span><br><span class="line">  <span class="comment">// 传入的参数是函数</span></span><br><span class="line">  forEach(onNext, onError, onCompleted) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  map(projectionFunction) &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> self.forEach(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onNext</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">          observer.onNext(projectionFunction(x))</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">          observer.onError(err)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onCompleted</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          observer.onCompleted()</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Observable-Filter-Function"><a href="#Observable-Filter-Function" class="headerlink" title="Observable Filter Function"></a>Observable Filter Function</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Observable.prototype = &#123;</span><br><span class="line">  <span class="comment">// 传入的参数是函数</span></span><br><span class="line">  forEach(onNext, onError, onCompleted) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  map(projectionFunction) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  filter(testFunction) &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> self.forEach(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onNext</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (testFunction(x)) observer.onNext(x)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">          observer.onError(err)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onCompleted</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          observer.onCompleted()</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Observable-Take-Function"><a href="#Observable-Take-Function" class="headerlink" title="Observable Take Function"></a>Observable Take Function</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe" target="_blank" rel="noopener">Object.observe</a> - 已废弃，现使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener">Proxy</a>代替</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Observable.prototype = &#123;</span><br><span class="line">  <span class="comment">// 传入的参数是函数</span></span><br><span class="line">  forEach(onNext, onError, onCompleted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onNext === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._forEach(&#123;</span><br><span class="line">        onNext: onNext,</span><br><span class="line">        onError: onError || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        onCompleted: onCompleted || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 传入的是一个observer对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._forEach(onNext)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  map(projectionFunction) &#123;</span><br><span class="line">   ..</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  filter(testFunction) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  take(num) &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line">      <span class="keyword">const</span> subscription = self.forEach(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onNext</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">          observer.onNext(data)</span><br><span class="line">          counter++</span><br><span class="line">          <span class="keyword">if</span> (counter === num) &#123;</span><br><span class="line">            observer.onCompleted()</span><br><span class="line">            subscription.dispose()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">          observer.onError(err)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onCompleted</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          observer.onCompleted()</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> subscription</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Syncing-Data-with-the-Server"><a href="#Syncing-Data-with-the-Server" class="headerlink" title="Syncing Data with the Server"></a>Syncing Data with the Server</h3><p>可以使用combineLatest来合并最新数据提交给服务器</p>
<h3 id="Observables-as-Animations"><a href="#Observables-as-Animations" class="headerlink" title="Observables as Animations"></a>Observables as Animations</h3><p>通过mergeAll，concatAll和switchAll的不同特性，可以设置不同的动画曲线。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/FrontEndMasters/" rel="tag"># FrontEndMasters</a>
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/rxjs/" rel="tag"># rxjs</a>
          
            <a href="/tags/Asynchronous-Programming/" rel="tag"># Asynchronous Programming</a>
          
            <a href="/tags/Functional-Programming/" rel="tag"># Functional Programming</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/28/JavaScript-The-New-Hard-Parts/" rel="next" title="JavaScript: The New Hard Parts">
                <i class="fa fa-chevron-left"></i> JavaScript: The New Hard Parts
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://img.zcool.cn/community/04c6fd55fa1a4a000001b19c79e625.jpg@160w_160h_1c_1e_1o_100sh.jpg" alt="刘勇">
            
              <p class="site-author-name" itemprop="name">刘勇</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">55</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/blingblingredstar" title="GitHub &rarr; https://github.com/blingblingredstar" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:564447023@qq.com" title="E-Mail &rarr; mailto:564447023@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Building-Blocks"><span class="nav-number">1.</span> <span class="nav-text">Building Blocks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Async-seems-hard"><span class="nav-number">1.1.1.</span> <span class="nav-text">Async seems hard</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Playing-a-Movie-Asynchronously"><span class="nav-number">1.1.2.</span> <span class="nav-text">Playing a Movie Asynchronously</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaScript-Tutorial"><span class="nav-number">1.2.</span> <span class="nav-text">JavaScript Tutorial</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#箭头函数"><span class="nav-number">1.2.1.</span> <span class="nav-text">箭头函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ForEach"><span class="nav-number">1.2.2.</span> <span class="nav-text">ForEach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map"><span class="nav-number">1.2.3.</span> <span class="nav-text">Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Filter"><span class="nav-number">1.2.4.</span> <span class="nav-text">Filter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#concatAll"><span class="nav-number">1.2.5.</span> <span class="nav-text">concatAll</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Collections"><span class="nav-number">1.3.</span> <span class="nav-text">Creating Collections</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Top-rated-Movies-Collection"><span class="nav-number">1.3.1.</span> <span class="nav-text">Top-rated Movies Collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mouse-Drags-Collection"><span class="nav-number">1.3.2.</span> <span class="nav-text">Mouse Drags Collection</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Iterators-amp-Observers"><span class="nav-number">1.4.</span> <span class="nav-text">Iterators &amp; Observers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator"><span class="nav-number">1.4.1.</span> <span class="nav-text">Iterator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Observer-Pattern"><span class="nav-number">1.4.2.</span> <span class="nav-text">Observer Pattern</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-Iterator-and-Observer-Pattern-are-Symmetrical"><span class="nav-number">1.4.3.</span> <span class="nav-text">The Iterator and Observer Pattern are Symmetrical</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Observables"><span class="nav-number">2.</span> <span class="nav-text">Observables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Observables-Introduction"><span class="nav-number">2.1.</span> <span class="nav-text">Observables Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Introducing-Observable"><span class="nav-number">2.1.1.</span> <span class="nav-text">Introducing Observable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reactive-Extensions"><span class="nav-number">2.1.2.</span> <span class="nav-text">Reactive Extensions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Event-Subscription"><span class="nav-number">2.1.3.</span> <span class="nav-text">Event Subscription</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Observable-forEach"><span class="nav-number">2.1.4.</span> <span class="nav-text">Observable.forEach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Expanded-Observable-forEach"><span class="nav-number">2.1.5.</span> <span class="nav-text">Expanded Observable.forEach</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-Metaphor"><span class="nav-number">2.2.</span> <span class="nav-text">Observable Metaphor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Converting-Events-to-Observables"><span class="nav-number">2.2.1.</span> <span class="nav-text">Converting Events to Observables</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observables-in-Action"><span class="nav-number">2.3.</span> <span class="nav-text">Observables in Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Race-Conditions-amp-Nested-Observables"><span class="nav-number">2.4.</span> <span class="nav-text">Race Conditions &amp; Nested Observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TakeUntil"><span class="nav-number">2.5.</span> <span class="nav-text">TakeUntil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementing-Mouse-Move"><span class="nav-number">2.6.</span> <span class="nav-text">Implementing Mouse Move</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mouse-Drags-Collection-1"><span class="nav-number">2.6.1.</span> <span class="nav-text">Mouse Drags Collection</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MergeAll-amp-SwitchLatest"><span class="nav-number">2.7.</span> <span class="nav-text">MergeAll &amp; SwitchLatest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Netflix-Search-Box"><span class="nav-number">2.8.</span> <span class="nav-text">Netflix Search Box</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Optimizing-the-Search"><span class="nav-number">2.9.</span> <span class="nav-text">Optimizing the Search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Three-Dimensional-Collections"><span class="nav-number">2.10.</span> <span class="nav-text">Three-Dimensional Collections</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Player-Callback-Hell"><span class="nav-number">2.10.1.</span> <span class="nav-text">Player Callback Hell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Player-with-Observable"><span class="nav-number">2.10.2.</span> <span class="nav-text">Player with Observable</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Array-Functions"><span class="nav-number">3.</span> <span class="nav-text">Creating Array Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Arrays"><span class="nav-number">3.1.</span> <span class="nav-text">Working with Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Traversing-an-Array"><span class="nav-number">3.1.1.</span> <span class="nav-text">Traversing an Array</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-1-Print-all-the-names-in-an-array"><span class="nav-number">3.1.2.</span> <span class="nav-text">Exercise 1: Print all the names in an array</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-2-Use-forEach-to-print-all-the-names-in-an-array"><span class="nav-number">3.1.3.</span> <span class="nav-text">Exercise 2: Use forEach to print all the names in an array</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Projecting-Arrays"><span class="nav-number">3.2.</span> <span class="nav-text">Projecting Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-3-Project-an-array-of-videos-into-an-array-of-id-title-pairs-using-forEach"><span class="nav-number">3.2.1.</span> <span class="nav-text">Exercise 3: Project an array of videos into an array of {id,title} pairs using forEach()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-4-Implement-map"><span class="nav-number">3.2.2.</span> <span class="nav-text">Exercise 4: Implement map()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-5-Use-map-to-project-an-array-of-videos-into-an-array-of-id-title-pairs"><span class="nav-number">3.2.3.</span> <span class="nav-text">Exercise 5: Use map() to project an array of videos into an array of {id,title} pairs</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filtering-Arrays"><span class="nav-number">3.3.</span> <span class="nav-text">Filtering Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-6-Use-forEach-to-collect-only-those-videos-with-a-rating-of-5-0"><span class="nav-number">3.3.1.</span> <span class="nav-text">Exercise 6: Use forEach() to collect only those videos with a rating of 5.0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-7-Implement-filter"><span class="nav-number">3.3.2.</span> <span class="nav-text">Exercise 7: Implement filter()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Query-Data-by-Chaining-Method-Calls"><span class="nav-number">3.4.</span> <span class="nav-text">Query Data by Chaining Method Calls</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-8-Chain-filter-and-map-to-collect-the-ids-of-videos-that-have-a-rating-of-5-0"><span class="nav-number">3.4.1.</span> <span class="nav-text">Exercise 8: Chain filter and map to collect the ids of videos that have a rating of 5.0</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Querying-Trees"><span class="nav-number">3.5.</span> <span class="nav-text">Querying Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-9-Flatten-the-movieLists-array-into-an-array-of-video-ids"><span class="nav-number">3.5.1.</span> <span class="nav-text">Exercise 9: Flatten the movieLists array into an array of video ids</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-10-Implement-concatAll"><span class="nav-number">3.5.2.</span> <span class="nav-text">Exercise 10: Implement concatAll()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-11-Use-map-and-concatAll-to-project-and-flatten-the-movieLists-into-an-array-of-video-ids"><span class="nav-number">3.5.3.</span> <span class="nav-text">Exercise 11: Use map() and concatAll() to project and flatten the movieLists into an array of video ids</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-12-Retrieve-id-title-and-a-150x200-box-art-url-for-every-video"><span class="nav-number">3.5.4.</span> <span class="nav-text">Exercise 12: Retrieve id, title, and a 150x200 box art url for every video</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-13-Implement-concatMap"><span class="nav-number">3.5.5.</span> <span class="nav-text">Exercise 13: Implement concatMap()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-14-Use-concatMap-to-retrieve-id-title-and-150x200-box-art-url-for-every-video"><span class="nav-number">3.5.6.</span> <span class="nav-text">Exercise 14: Use concatMap() to retrieve id, title, and 150x200 box art url for every video</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reducing-Arrays"><span class="nav-number">3.6.</span> <span class="nav-text">Reducing Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-15-Use-forEach-to-find-the-largest-box-art"><span class="nav-number">3.6.1.</span> <span class="nav-text">Exercise 15: Use forEach to find the largest box art</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-16-Implement-reduce"><span class="nav-number">3.6.2.</span> <span class="nav-text">Exercise 16: Implement reduce()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-17-Retrieve-the-largest-rating"><span class="nav-number">3.6.3.</span> <span class="nav-text">Exercise 17: Retrieve the largest rating</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-18-Retrieve-url-of-the-largest-boxart"><span class="nav-number">3.6.4.</span> <span class="nav-text">Exercise 18: Retrieve url of the largest boxart</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-19-Reducing-with-an-initial-value"><span class="nav-number">3.6.5.</span> <span class="nav-text">Exercise 19: Reducing with an initial value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-20-Retrieve-the-id-title-and-smallest-box-art-url-for-every-video"><span class="nav-number">3.6.6.</span> <span class="nav-text">Exercise 20: Retrieve the id, title, and smallest box art url for every video</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zipping-Arrays"><span class="nav-number">3.7.</span> <span class="nav-text">Zipping Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-21-Combine-videos-and-bookmarks-by-index"><span class="nav-number">3.7.1.</span> <span class="nav-text">Exercise 21: Combine videos and bookmarks by index</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-22-Implement-zip"><span class="nav-number">3.7.2.</span> <span class="nav-text">Exercise 22: Implement zip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-23-Combine-videos-and-bookmarks-by-index"><span class="nav-number">3.7.3.</span> <span class="nav-text">Exercise 23: Combine videos and bookmarks by index</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-24-Retrieve-each-video’s-id-title-middle-interesting-moment-time-and-smallest-box-art-url"><span class="nav-number">3.7.4.</span> <span class="nav-text">Exercise 24: Retrieve each video’s id, title, middle interesting moment time, and smallest box art url</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Trees"><span class="nav-number">4.</span> <span class="nav-text">Creating Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Async"><span class="nav-number">4.1.</span> <span class="nav-text">Debugging Async</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Comparison"><span class="nav-number">4.2.</span> <span class="nav-text">SQL Comparison</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-25-Converting-from-Arrays-to-Trees"><span class="nav-number">4.2.1.</span> <span class="nav-text">Exercise 25: Converting from Arrays to Trees</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-26-Converting-from-Arrays-to-Deeper-Trees"><span class="nav-number">4.2.2.</span> <span class="nav-text">Exercise 26: Converting from Arrays to Deeper Trees</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-27-Stock-Ticker"><span class="nav-number">4.2.3.</span> <span class="nav-text">Exercise 27: Stock Ticker</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handling-Events-with-Ovservables"><span class="nav-number">5.</span> <span class="nav-text">Handling Events with Ovservables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Observables"><span class="nav-number">5.1.</span> <span class="nav-text">Working with Observables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-28-Subscribing-to-an-event"><span class="nav-number">5.1.1.</span> <span class="nav-text">Exercise 28: Subscribing to an event</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-29-Traversing-an-Event"><span class="nav-number">5.1.2.</span> <span class="nav-text">Exercise 29: Traversing an Event</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-30-Completing-Sequences-with-take"><span class="nav-number">5.1.3.</span> <span class="nav-text">Exercise 30: Completing Sequences with take()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-31-Completing-sequences-with-takeUntil"><span class="nav-number">5.1.4.</span> <span class="nav-text">Exercise 31: Completing sequences with takeUntil()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Querying-Observables"><span class="nav-number">5.2.</span> <span class="nav-text">Querying Observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-amp-Events"><span class="nav-number">5.3.</span> <span class="nav-text">Observable &amp; Events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Anatomy-of-Observable"><span class="nav-number">5.4.</span> <span class="nav-text">Anatomy of Observable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-setTimeout-Observable"><span class="nav-number">5.5.</span> <span class="nav-text">Creating a setTimeout Observable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-vs-Promise"><span class="nav-number">5.6.</span> <span class="nav-text">Observable vs. Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-32-Creating-a-mouse-drag-event"><span class="nav-number">5.6.1.</span> <span class="nav-text">Exercise 32: Creating a mouse drag event</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-33-Improving-our-mouse-drag-event"><span class="nav-number">5.6.2.</span> <span class="nav-text">Exercise 33: Improving our mouse drag event</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handing-HTTP-Requests-with-Observables"><span class="nav-number">6.</span> <span class="nav-text">Handing HTTP Requests with Observables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Exercise-34-HTTP-request"><span class="nav-number">6.1.</span> <span class="nav-text">Exercise 34: HTTP request</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Observable-In-Depth"><span class="nav-number">7.</span> <span class="nav-text">Observable In-Depth</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-an-Observable-Class"><span class="nav-number">7.1.</span> <span class="nav-text">Creating an Observable Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-Map-Function"><span class="nav-number">7.2.</span> <span class="nav-text">Observable Map Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-Filter-Function"><span class="nav-number">7.3.</span> <span class="nav-text">Observable Filter Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observable-Take-Function"><span class="nav-number">7.4.</span> <span class="nav-text">Observable Take Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Syncing-Data-with-the-Server"><span class="nav-number">7.5.</span> <span class="nav-text">Syncing Data with the Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Observables-as-Animations"><span class="nav-number">7.6.</span> <span class="nav-text">Observables as Animations</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘勇</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
