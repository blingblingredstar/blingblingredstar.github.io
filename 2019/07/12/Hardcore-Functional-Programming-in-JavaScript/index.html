<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="The SlienceIntroductionThe Soul of Functional Programming: Separation and Recognition 函数式编程的灵魂:分离和识别 The structure of the course  The Slience The Voyage The Demo  In the beginning…  Anything goes Ever">
<meta property="og:type" content="article">
<meta property="og:title" content="Hardcore Functional Programming in JavaScript">
<meta property="og:url" content="http://yoursite.com/2019/07/12/Hardcore-Functional-Programming-in-JavaScript/index.html">
<meta property="og:site_name" content="刘勇的博客">
<meta property="og:description" content="The SlienceIntroductionThe Soul of Functional Programming: Separation and Recognition 函数式编程的灵魂:分离和识别 The structure of the course  The Slience The Voyage The Demo  In the beginning…  Anything goes Ever">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-07-12T09:19:20.000Z">
<meta property="article:modified_time" content="2023-05-17T14:12:23.323Z">
<meta property="article:author" content="刘勇">
<meta property="article:tag" content="FrontEndMasters">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="Functional Programming">
<meta property="article:tag" content="Point-Free">
<meta property="article:tag" content="Monads">
<meta property="article:tag" content="Functor">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yoursite.com/2019/07/12/Hardcore-Functional-Programming-in-JavaScript/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yoursite.com/2019/07/12/Hardcore-Functional-Programming-in-JavaScript/","path":"2019/07/12/Hardcore-Functional-Programming-in-JavaScript/","title":"Hardcore Functional Programming in JavaScript"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hardcore Functional Programming in JavaScript | 刘勇的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">刘勇的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Slience"><span class="nav-number">1.</span> <span class="nav-text">The Slience</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-Symptoms"><span class="nav-number">1.1.1.</span> <span class="nav-text">The Symptoms</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Omit-Needless-Names"><span class="nav-number">1.2.</span> <span class="nav-text">Omit Needless Names</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#separate-inputs-from-environment"><span class="nav-number">1.2.1.</span> <span class="nav-text">separate inputs from environment</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Separating-Mutation-from-Calculation"><span class="nav-number">1.3.</span> <span class="nav-text">Separating Mutation from Calculation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Recognize-Pure-Function"><span class="nav-number">1.4.</span> <span class="nav-text">Recognize Pure Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Separate-Functions-from-Rules"><span class="nav-number">1.5.</span> <span class="nav-text">Separate Functions from Rules</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Curry"><span class="nav-number">1.5.1.</span> <span class="nav-text">Curry</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Curring-Exercise"><span class="nav-number">1.6.</span> <span class="nav-text">Curring Exercise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Implment-map-with-reduce"><span class="nav-number">1.6.1.</span> <span class="nav-text">Implment map with reduce</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compose"><span class="nav-number">1.7.</span> <span class="nav-text">Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#separate-composition-from-args"><span class="nav-number">1.7.1.</span> <span class="nav-text">separate composition from args</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Simplified-compose-funciton"><span class="nav-number">1.7.2.</span> <span class="nav-text">Simplified compose funciton</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Composition-Exercise"><span class="nav-number">1.8.</span> <span class="nav-text">Composition Exercise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Point-Free"><span class="nav-number">1.9.</span> <span class="nav-text">Point Free</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Slience-Review"><span class="nav-number">1.10.</span> <span class="nav-text">The Slience: Review</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Voyage"><span class="nav-number">2.</span> <span class="nav-text">The Voyage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Category-Theory"><span class="nav-number">2.1.</span> <span class="nav-text">Category Theory</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Go-into-Category-Theory"><span class="nav-number">2.1.1.</span> <span class="nav-text">Go into Category Theory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Category-Laws"><span class="nav-number">2.1.2.</span> <span class="nav-text">Category Laws</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Objects"><span class="nav-number">2.2.</span> <span class="nav-text">Objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-Map"><span class="nav-number">2.3.</span> <span class="nav-text">Object Map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Maybe-Functor"><span class="nav-number">2.4.</span> <span class="nav-text">Maybe Functor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Them-pesky-nulls"><span class="nav-number">2.4.1.</span> <span class="nav-text">Them pesky nulls</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-Maybe-Functor"><span class="nav-number">2.4.2.</span> <span class="nav-text">Use Maybe Functor</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Functor-Exercise"><span class="nav-number">2.5.</span> <span class="nav-text">Functor Exercise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Either"><span class="nav-number">2.6.</span> <span class="nav-text">Either</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IO"><span class="nav-number">2.7.</span> <span class="nav-text">IO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Either-x2F-IO-Exercise"><span class="nav-number">2.8.</span> <span class="nav-text">Either&#x2F;IO Exercise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-Functors"><span class="nav-number">2.9.</span> <span class="nav-text">Other Functors</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#EventStream"><span class="nav-number">2.9.1.</span> <span class="nav-text">EventStream</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Future"><span class="nav-number">2.9.2.</span> <span class="nav-text">Future</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-Functors-Exercise"><span class="nav-number">2.10.</span> <span class="nav-text">Other Functors: Exercise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Functor-Laws-amp-Properties"><span class="nav-number">2.11.</span> <span class="nav-text">Functor Laws &amp; Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Natural-Transformations"><span class="nav-number">2.11.1.</span> <span class="nav-text">Natural Transformations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Card-Game-1"><span class="nav-number">2.11.2.</span> <span class="nav-text">Card Game #1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Card-Game-2"><span class="nav-number">2.11.3.</span> <span class="nav-text">Card Game #2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Card-Game-3"><span class="nav-number">2.11.4.</span> <span class="nav-text">Card Game #3</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monads"><span class="nav-number">2.12.</span> <span class="nav-text">Monads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Pointed-Functors"><span class="nav-number">2.12.1.</span> <span class="nav-text">Pointed Functors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#monads"><span class="nav-number">2.12.2.</span> <span class="nav-text">monads</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monads-Exercises"><span class="nav-number">2.13.</span> <span class="nav-text">Monads Exercises</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Monad-Laws"><span class="nav-number">2.13.1.</span> <span class="nav-text">Monad Laws</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Demo"><span class="nav-number">3.</span> <span class="nav-text">The Demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Project-Setup"><span class="nav-number">3.1.</span> <span class="nav-text">Project Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Demo"><span class="nav-number">3.2.</span> <span class="nav-text">Demo</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘勇"
      src="https://avatars.githubusercontent.com/u/43870278?s=400&u=7e0e1bf1f3550a08fa79cb6368718793280eb5eb&v=4">
  <p class="site-author-name" itemprop="name">刘勇</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">100</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">151</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blingblingredstar" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blingblingredstar" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:564447023@qq.com" title="E-Mail → mailto:564447023@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/12/Hardcore-Functional-Programming-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/43870278?s=400&u=7e0e1bf1f3550a08fa79cb6368718793280eb5eb&v=4">
      <meta itemprop="name" content="刘勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘勇的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hardcore Functional Programming in JavaScript | 刘勇的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hardcore Functional Programming in JavaScript
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-12 17:19:20" itemprop="dateCreated datePublished" datetime="2019-07-12T17:19:20+08:00">2019-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-17 22:12:23" itemprop="dateModified" datetime="2023-05-17T22:12:23+08:00">2023-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="The-Slience"><a href="#The-Slience" class="headerlink" title="The Slience"></a>The Slience</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>The Soul of Functional Programming: Separation and Recognition</p>
<p>函数式编程的灵魂:分离和识别</p>
<p>The structure of the course</p>
<ol>
<li>The Slience</li>
<li>The Voyage</li>
<li>The Demo</li>
</ol>
<p>In the beginning…</p>
<ul>
<li>Anything goes</li>
<li>Everything changes</li>
<li>Weird names<span id="more"></span>
There was primordial soup</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10 i = 0</span><br><span class="line">20 i = i + 1</span><br><span class="line">30 PRINT i; &quot; squared = &quot;; i * i</span><br><span class="line">40 IF i &gt;= 10 THEN GOTO 60</span><br><span class="line">50 GOTO 20</span><br><span class="line">60 PRINT &quot;Program Completed.&quot;</span><br><span class="line">70 END</span><br></pre></td></tr></table></figure>

<p>Discipline Wins</p>
<blockquote>
<p>Exercising restraint while coding feels weird at first, but it’s worth it.<br>“The goto statement as it stands is just too primitive; it is too much an invitation to make a mess of one’s program.”</p>
</blockquote>
<h4 id="The-Symptoms"><a href="#The-Symptoms" class="headerlink" title="The Symptoms"></a>The Symptoms</h4><ul>
<li>Custom names</li>
<li>Looping patterns</li>
<li>Glue code</li>
<li>Side effects</li>
</ul>
<h3 id="Omit-Needless-Names"><a href="#Omit-Needless-Names" class="headerlink" title="Omit Needless Names"></a>Omit Needless Names</h3><p>Omit needless names with separations and recongnitions.</p>
<h4 id="separate-inputs-from-environment"><a href="#separate-inputs-from-environment" class="headerlink" title="separate inputs from environment"></a>separate inputs from environment</h4><p>Secret input: time</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">daysThisMonth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> date  = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    , y     = date.<span class="title function_">getFullYear</span>()</span><br><span class="line">    , m     = date.<span class="title function_">getMonth</span>()</span><br><span class="line">    , start = <span class="keyword">new</span> <span class="title class_">Date</span>(y, m, <span class="number">1</span>)</span><br><span class="line">    , end   = <span class="keyword">new</span> <span class="title class_">Date</span>(y, m + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> (end - start) / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Always works the same</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">daysInMonth</span>(<span class="params">y, m</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>(y, m - <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    , end   = <span class="keyword">new</span> <span class="title class_">Date</span>(y, m, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> (end - start) / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Separating-Mutation-from-Calculation"><a href="#Separating-Mutation-from-Calculation" class="headerlink" title="Separating Mutation from Calculation"></a>Separating Mutation from Calculation</h3><p>Teaser updates DOM</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">teaser</span>(<span class="params">size, elt</span>) &#123;</span><br><span class="line">  <span class="title function_">setText</span>(elt, <span class="title function_">slice</span>(<span class="number">0</span>, size, <span class="title function_">text</span>(elt)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(<span class="title function_">teaser</span>(<span class="number">50</span>), <span class="title function_">all</span>(<span class="string">&#x27;p&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>Merely calculates</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> teaser = <span class="title function_">slice</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_">map</span>(<span class="title function_">compose</span>(setText, <span class="title function_">teaser</span>(<span class="number">50</span>), text), <span class="title function_">all</span>(<span class="string">&#x27;p&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="Recognize-Pure-Function"><a href="#Recognize-Pure-Function" class="headerlink" title="Recognize Pure Function"></a>Recognize Pure Function</h3><p>Function that don’t change anything are called “pure”.</p>
<p>Their purity makes them:</p>
<ul>
<li>testable</li>
<li>memoizable</li>
<li>portable</li>
<li>parallelizable</li>
</ul>
<p>Let’s play pure or impure</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>) &#123; <span class="comment">// impure 因为window.loaction</span></span><br><span class="line">    <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; vars.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">decodeURIComponent</span>(pair[<span class="number">0</span>]) == variable) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(pair[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">random</span>(<span class="params">m_w, m_z</span>) &#123; <span class="comment">// pure</span></span><br><span class="line">  m_z = <span class="number">36969</span> * (m_z &amp; <span class="number">65535</span>) + (m_z &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  m_w = <span class="number">18000</span> * (m_w &amp; <span class="number">65535</span>) + (m_w &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> (m_z &lt;&lt; <span class="number">16</span>) + m_w;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">chattyAdd</span>(<span class="params">a, b, <span class="variable language_">console</span></span>) &#123; <span class="comment">// impure 因为console参数</span></span><br><span class="line">  <span class="keyword">var</span> c = a+b;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a, <span class="string">&#x27;+&#x27;</span>, b, <span class="string">&#x27;=&#x27;</span>, c);</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Separate-Functions-from-Rules"><a href="#Separate-Functions-from-Rules" class="headerlink" title="Separate Functions from Rules"></a>Separate Functions from Rules</h3><p>Functions are nouns</p>
<p>Set theoretically</p>
<p>Every function is a single-valued collection of pairs</p>
<p>One input, one output</p>
<p>Separate arity from functions</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">property, object</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> object[property]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> people = [&#123;<span class="attr">name</span>: ...&#125;, ...]</span><br></pre></td></tr></table></figure>

<p>Args up front</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPersonName</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>, person)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> names = people.<span class="title function_">map</span>(getPersonName)</span><br></pre></td></tr></table></figure>

<p>More args later</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Magic!</span></span><br><span class="line"><span class="keyword">const</span> names = people.<span class="title function_">map</span>(<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="Curry"><a href="#Curry" class="headerlink" title="Curry"></a>Curry</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(fn.<span class="property">length</span> &gt; <span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> slice = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>,</span><br><span class="line">       args = slice.<span class="title function_">apply</span>(<span class="variable language_">arguments</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args.<span class="title function_">concat</span>(slice.<span class="title function_">apply</span>(<span class="variable language_">arguments</span>)))</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Our code becomes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> get = <span class="title function_">curry</span>(<span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">property, object</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> object[property]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> names = people.<span class="title function_">map</span>(<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Curring-Exercise"><a href="#Curring-Exercise" class="headerlink" title="Curring Exercise"></a>Curring Exercise</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use ramda.js</span></span><br><span class="line"><span class="keyword">var</span> _ = R;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************</span></span><br><span class="line"><span class="comment">      C U R R Y I N G  E X A M P L E</span></span><br><span class="line"><span class="comment">******************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// We&#x27;ve got a nice multiply function.</span></span><br><span class="line"><span class="comment">// It takes two arguments.</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( _.<span class="title function_">multiply</span>(<span class="number">3</span>, <span class="number">4</span>) );</span><br><span class="line"></span><br><span class="line"><span class="comment">// But it has been secretly curried already</span></span><br><span class="line"><span class="comment">// so we can feed it fewer arguments and it</span></span><br><span class="line"><span class="comment">// will return a new function.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// How about making a function to double a</span></span><br><span class="line"><span class="comment">// value? Done.</span></span><br><span class="line"><span class="keyword">var</span> double = _.<span class="title function_">multiply</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="title function_">double</span>(<span class="number">13</span>) );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************</span></span><br><span class="line"><span class="comment">               Y O U R  T U R N</span></span><br><span class="line"><span class="comment">******************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// _.split pulls a string apart around a</span></span><br><span class="line"><span class="comment">// given value</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( _.<span class="title function_">split</span>(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;mississippi&#x27;</span>) );</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 1 ------------------------</span></span><br><span class="line"><span class="comment">// Make a function called &quot;words&quot; which</span></span><br><span class="line"><span class="comment">// returns a list of words in a string.</span></span><br><span class="line"><span class="comment">// Use only the split function and</span></span><br><span class="line"><span class="comment">// currying.</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Testing challenge 1...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> words = _.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>); <span class="comment">// change this</span></span><br><span class="line"><span class="title function_">assertEqualArrays</span>(</span><br><span class="line">  [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>],</span><br><span class="line">  <span class="title function_">words</span>(<span class="string">&#x27;one two three&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;passed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 2 ------------------------</span></span><br><span class="line"><span class="comment">// Create a function to triple every</span></span><br><span class="line"><span class="comment">// number in a list using only</span></span><br><span class="line"><span class="comment">// _.multiply and _.map.</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Testing challenge 2...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tripleList = _.<span class="title function_">map</span>(_.<span class="title function_">multiply</span>(<span class="number">3</span>));</span><br><span class="line"><span class="title function_">assertEqualArrays</span>([<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>], <span class="title function_">tripleList</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;passed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 3 ------------------------</span></span><br><span class="line"><span class="comment">// Create a function to find the largest</span></span><br><span class="line"><span class="comment">// number in a list. You can use the</span></span><br><span class="line"><span class="comment">// greater(a,b) function which returns the</span></span><br><span class="line"><span class="comment">// greater of its two inputs. You can do</span></span><br><span class="line"><span class="comment">// this with currying and one of the list</span></span><br><span class="line"><span class="comment">// functions _.map, _.filter, or _.reduce.</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Testing challenge 3...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> greater = <span class="keyword">function</span>(<span class="params">a,b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> max = _.<span class="title function_">reduce</span>(greater, <span class="literal">undefined</span>);</span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="number">9</span>, <span class="title function_">max</span>([<span class="number">1</span>,-<span class="number">3483</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>]));</span><br><span class="line"><span class="title function_">assertEqual</span>(-<span class="number">1</span>, <span class="title function_">max</span>([-<span class="number">21</span>,-<span class="number">3483</span>,-<span class="number">2</span>,-<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;passed&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;All tests pass.&quot;</span>);</span><br><span class="line"><span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">        B A C K G R O U N D  C O D E</span></span><br><span class="line"><span class="comment">*******************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqualArrays</span>(<span class="params">x,y</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">length</span> !== y.<span class="property">length</span>) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> x) &#123;</span><br><span class="line">    <span class="keyword">if</span>(x[i] !== y[i]) &#123;</span><br><span class="line">      <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Implment-map-with-reduce"><a href="#Implment-map-with-reduce" class="headerlink" title="Implment map with reduce"></a>Implment map with reduce</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newmap = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">f, list</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> concatList = <span class="keyword">function</span> (<span class="params">acc, element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> acc.<span class="title function_">concat</span>(<span class="title function_">f</span>(element))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _.<span class="title function_">reduce</span>(concatList, [], list)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Compose"><a href="#Compose" class="headerlink" title="Compose"></a>Compose</h3><p>functions can “meld” aka <em>compose</em>.</p>
<p>A &#x3D;&gt; f(A) &#x3D;&gt; B &#x3D;&gt; g(B) &#x3D;&gt; C &#x3D;&gt; h(C) &#x3D;&gt; D<br>A &#x3D;&gt;       g | f       &#x3D;&gt; C &#x3D;&gt; h(C) &#x3D;&gt; D<br>A &#x3D;&gt;         h | (g | f)            &#x3D;&gt; D</p>
<p>Aside: categories</p>
<p>Zooming way out from code</p>
<p>You start seeing similarities</p>
<p>Pure functions are the arrows of a “category”</p>
<h4 id="separate-composition-from-args"><a href="#separate-composition-from-args" class="headerlink" title="separate composition from args"></a>separate composition from args</h4><p>Javascript code composes functions all the time</p>
<p>But too often it uses unnecessary arguments</p>
<p>example “glue” names</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">on_error</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line"> <span class="title function_">log</span>(error.<span class="property">message</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>To compose the logging and message extraction we created a function and a “glue” name called error.<br>为了组合日志记录和消息提取，我们创建了一个函数，并起了一个“胶水”名称叫error。</p>
<h4 id="Simplified-compose-funciton"><a href="#Simplified-compose-funciton" class="headerlink" title="Simplified compose funciton"></a>Simplified compose funciton</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">g, f</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">g</span>(<span class="title function_">f</span>(x))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This function does not care what is inside f or g. It produces a new function that pushes a value through.</p>
<p>“olleH” ← “Hello” ← “hello”<br>compose(reverse, properNoun)</p>
<p>Cut out the middle man</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">on_error</span>( <span class="title function_">compose</span>(log, <span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>)) );</span><br></pre></td></tr></table></figure>

<h3 id="Composition-Exercise"><a href="#Composition-Exercise" class="headerlink" title="Composition Exercise"></a>Composition Exercise</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = R;</span><br><span class="line"><span class="keyword">var</span> get = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">x, obj</span>) &#123; <span class="keyword">return</span> obj[x]; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">    C O M P O S I T I O N  E X A M P L E</span></span><br><span class="line"><span class="comment">******************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Curried functions are easy to compose.</span></span><br><span class="line"><span class="comment">// Using _.map, _.size, and _.split we can</span></span><br><span class="line"><span class="comment">// make a function that returns the lengths</span></span><br><span class="line"><span class="comment">// of the words in a string.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lengths = _.<span class="title function_">compose</span>(</span><br><span class="line">  _.<span class="title function_">map</span>(_.<span class="property">size</span>), _.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">lengths</span>(<span class="string">&#x27;once upon a time&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************</span></span><br><span class="line"><span class="comment">               Y O U R  T U R N</span></span><br><span class="line"><span class="comment">********************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> articles = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Everything Sucks&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://do.wn/sucks.html&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Debbie Downer&#x27;</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">&#x27;debbie@do.wn&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;If You Please&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://www.geocities.com/milq&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Caspar Milquetoast&#x27;</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">&#x27;hello@me.com&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 1 -------------------------</span></span><br><span class="line"><span class="comment">// Return a list of the author names in</span></span><br><span class="line"><span class="comment">// articles using only get, _.compose, and</span></span><br><span class="line"><span class="comment">// _.map.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> names = _.<span class="title function_">map</span>(</span><br><span class="line">              _.<span class="title function_">compose</span>(<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>), <span class="title function_">get</span>(<span class="string">&#x27;author&#x27;</span>))</span><br><span class="line">            ); <span class="comment">// change this</span></span><br><span class="line"><span class="title function_">assertEqualArrays</span>(</span><br><span class="line">  [<span class="string">&#x27;Debbie Downer&#x27;</span>, <span class="string">&#x27;Caspar Milquetoast&#x27;</span>],</span><br><span class="line">  <span class="title function_">names</span>(articles)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 2 -------------------------</span></span><br><span class="line"><span class="comment">// Make a boolean function that says whether</span></span><br><span class="line"><span class="comment">// a given person wrote any of the articles.</span></span><br><span class="line"><span class="comment">// Use the names function you wrote above</span></span><br><span class="line"><span class="comment">// with _.compose and _.contains.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var isAuthor = (name, list) =&gt; _.contains(name, names(list)) // change this</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">isAuthor</span> = (<span class="params">name, articles</span>) =&gt; _.<span class="title function_">compose</span>(_.<span class="title function_">contains</span>(name), names)(articles);</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertEqual</span>(  </span><br><span class="line">  <span class="literal">false</span>,</span><br><span class="line">  <span class="title function_">isAuthor</span>(<span class="string">&#x27;New Guy&#x27;</span>, articles)</span><br><span class="line">);</span><br><span class="line"><span class="title function_">assertEqual</span>(</span><br><span class="line">  <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">isAuthor</span>(<span class="string">&#x27;Debbie Downer&#x27;</span>, articles)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- Challenge 3 -------------------------</span></span><br><span class="line"><span class="comment">// There is more to point-free programming</span></span><br><span class="line"><span class="comment">// than compose! Let&#x27;s build ourselves</span></span><br><span class="line"><span class="comment">// another function that combines functions</span></span><br><span class="line"><span class="comment">// to let us write code without glue variables.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fork = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">lastly, f, g, x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">lastly</span>(<span class="title function_">f</span>(x), <span class="title function_">g</span>(x));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// As you can see, the fork function is a</span></span><br><span class="line"><span class="comment">// pipeline like compose, except it duplicates</span></span><br><span class="line"><span class="comment">// its value, sends it to two functions, then</span></span><br><span class="line"><span class="comment">// sends the results to a combining function.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Your challenge: implement a function to</span></span><br><span class="line"><span class="comment">// compute the average values in a list using</span></span><br><span class="line"><span class="comment">// only fork, _.divide, _.sum, and _.size.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> avg = <span class="title function_">fork</span>(_.<span class="property">divide</span>, _.<span class="property">sum</span>, _.<span class="property">size</span>); <span class="comment">// change this</span></span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="number">3</span>, <span class="title function_">avg</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;All tests pass.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">        B A C K G R O U N D  C O D E</span></span><br><span class="line"><span class="comment">*******************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqualArrays</span>(<span class="params">x,y</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">length</span> !== y.<span class="property">length</span>)</span><br><span class="line">    <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> x) &#123;</span><br><span class="line">    <span class="keyword">if</span>(x[i] !== y[i]) &#123;</span><br><span class="line">      <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y)</span><br><span class="line">    <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Point-Free"><a href="#Point-Free" class="headerlink" title="Point Free"></a>Point Free</h3><p>Point means argument. You can think of Point Free means argument free.</p>
<p>就像是如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fork = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">lastly, f, g, x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">lastly</span>(<span class="title function_">f</span>(x), <span class="title function_">g</span>(x));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> avg = <span class="title function_">fork</span>(_.<span class="property">divide</span>, _.<span class="property">sum</span>, _.<span class="property">size</span>)</span><br></pre></td></tr></table></figure>

<p>把几个基本函数组合起来返回一个新的函数，在调用新函数时才输入要处理的数据。</p>
<h3 id="The-Slience-Review"><a href="#The-Slience-Review" class="headerlink" title="The Slience: Review"></a>The Slience: Review</h3><p>Recognize most loops are one of reduce, filter, map</p>
<p>In review</p>
<ol>
<li>Make all function inputs explicit as arguments</li>
<li>These arguments can be provided over time, not just all at once</li>
<li>Try not to modify outside things</li>
<li>Compose without “glue” variables</li>
</ol>
<h2 id="The-Voyage"><a href="#The-Voyage" class="headerlink" title="The Voyage"></a>The Voyage</h2><h3 id="Category-Theory"><a href="#Category-Theory" class="headerlink" title="Category Theory"></a>Category Theory</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="number">1</span>, <span class="number">1</span>) <span class="comment">// =&gt; 2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// associative</span></span><br><span class="line"><span class="title function_">add</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">4</span>) == <span class="title function_">add</span>(<span class="number">1</span>, <span class="title function_">add</span>(<span class="number">2</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// commutative</span></span><br><span class="line"><span class="title function_">add</span>(<span class="number">4</span>, <span class="number">1</span>) == <span class="title function_">add</span>(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// identity</span></span><br><span class="line"><span class="title function_">add</span>(n, <span class="number">0</span>) == n</span><br><span class="line"></span><br><span class="line"><span class="comment">// distributive</span></span><br><span class="line"><span class="title function_">multiply</span>(<span class="number">2</span>, <span class="title function_">add</span>(<span class="number">3</span>,<span class="number">4</span>)) == <span class="title function_">add</span>(<span class="title function_">multiply</span>(<span class="number">2</span>, <span class="number">3</span>), <span class="title function_">multiply</span>(<span class="number">2</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="string">&quot;ta&quot;</span>, <span class="string">&quot;cos&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; tacos</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>(<span class="number">9.2</span>, <span class="number">0.5</span>)</span><br><span class="line"><span class="comment">//=&gt; 9.7</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br><span class="line"><span class="comment">//=&gt; [1,2,3,4,5,6]</span></span><br></pre></td></tr></table></figure>

<h4 id="Go-into-Category-Theory"><a href="#Go-into-Category-Theory" class="headerlink" title="Go into Category Theory"></a>Go into Category Theory</h4><p>compose :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</p>
<p>id:: a -&gt; a</p>
<p>You need a composition and an identity to from a category</p>
<h4 id="Category-Laws"><a href="#Category-Laws" class="headerlink" title="Category Laws"></a>Category Laws</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// left identity</span></span><br><span class="line"><span class="title function_">compose</span>(id, f)  == f</span><br><span class="line"></span><br><span class="line"><span class="comment">// right identity</span></span><br><span class="line"><span class="title function_">compose</span>(f, id)  == f</span><br><span class="line"></span><br><span class="line"><span class="comment">// associativity</span></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">compose</span>(f, g), h)  == <span class="title function_">compose</span>(f, <span class="title function_">compose</span>(g, h))</span><br></pre></td></tr></table></figure>

<h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><ol>
<li>Containers&#x2F;Wrappers for values</li>
<li>No methods</li>
<li>Not nouns</li>
<li>Probably won’t be making your own often</li>
</ol>
<p>*think of it this way for now.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _Container = <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">val</span> = val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Container</span> = <span class="keyword">function</span>(<span class="params">x</span>) &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">_Container</span>(x); &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Container</span>(<span class="number">3</span>)</span><br><span class="line"><span class="comment">//=&gt; _Container &#123;val: 3&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">capitalize</span>(<span class="string">&quot;flamethrower&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; &quot;Flamethrower&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">capitalize</span>(<span class="title class_">Container</span>(<span class="string">&quot;flamethrower&quot;</span>))</span><br><span class="line"><span class="comment">//=&gt; [object Object]</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-Map"><a href="#Object-Map" class="headerlink" title="Object Map"></a>Object Map</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_.<span class="property">Container</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">map</span> = <span class="keyword">function</span>(<span class="params">f</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Container</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">val</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Container(&#x27;flamethrower&#x27;).map(function(s)&#123;return capitalize(s)&#125;)</span></span><br><span class="line"><span class="title class_">Container</span>(<span class="string">&#x27;flamethrower&#x27;</span>).<span class="title function_">map</span>(capitalize）</span><br><span class="line"><span class="comment">// =&gt; Container(“Flamethrower”)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Container</span>(<span class="number">3</span>).<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)) <span class="comment">// =&gt; Container(4)</span></span><br><span class="line"></span><br><span class="line">[<span class="number">3</span>].<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)) <span class="comment">// =&gt; [4]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Container</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).<span class="title function_">map</span>(reverse).<span class="title function_">map</span>(first)</span><br><span class="line"><span class="comment">//=&gt; Container(3)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Container</span>(<span class="string">&quot;flamethrower&quot;</span>).<span class="title function_">map</span>(length).<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">//=&gt; Container(13)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">f, obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj.<span class="title function_">map</span>(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Container</span>(<span class="number">3</span>).<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)) <span class="comment">// Container(4)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>), <span class="title class_">Container</span>(<span class="number">3</span>)) <span class="comment">// Container(4)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">f, obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj.<span class="title function_">map</span>(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Container</span>(<span class="number">3</span>).<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)) <span class="comment">// Container(4)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>), <span class="title class_">Container</span>(<span class="number">3</span>)) <span class="comment">// Container(4)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">map</span>(<span class="title function_">match</span>(<span class="regexp">/cat/g</span>), <span class="title class_">Container</span>(<span class="string">&quot;catsup&quot;</span>))</span><br><span class="line"><span class="comment">//=&gt; Container([“cat”])</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(<span class="title function_">compose</span>(first, reverse), <span class="title class_">Container</span>(<span class="string">&quot;dog&quot;</span>))</span><br><span class="line"><span class="comment">//=&gt; Container(“g”)</span></span><br></pre></td></tr></table></figure>

<h3 id="Maybe-Functor"><a href="#Maybe-Functor" class="headerlink" title="Maybe Functor"></a>Maybe Functor</h3><p>Functor: “An object or data structure you can map over”</p>
<p>functions: map</p>
<h4 id="Them-pesky-nulls"><a href="#Them-pesky-nulls" class="headerlink" title="Them pesky nulls"></a>Them pesky nulls</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getElement = <span class="variable language_">document</span>.<span class="property">querySelector</span></span><br><span class="line"><span class="keyword">var</span> getNameParts = <span class="title function_">compose</span>(<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>), <span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>), getElement)</span><br><span class="line"></span><br><span class="line"><span class="title function_">getNameParts</span>(<span class="string">&#x27;#full_name&#x27;</span>)</span><br><span class="line"><span class="comment">//=&gt; [&#x27;Jonathan&#x27;, &#x27;Gregory&#x27;, &#x27;Brandis&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">getNameParts</span>(<span class="string">&#x27;#fullname&#x27;</span>)</span><br><span class="line"><span class="comment">//=&gt; Boom!</span></span><br></pre></td></tr></table></figure>

<h4 id="Use-Maybe-Functor"><a href="#Use-Maybe-Functor" class="headerlink" title="Use Maybe Functor"></a>Use Maybe Functor</h4><p>Captures a null check</p>
<p>The value inside may not be there</p>
<p>Sometimes has two subclasses Just &#x2F; Nothing</p>
<p>Sometimes called Option with subclasses Some&#x2F;None</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _Maybe.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">map</span> = <span class="keyword">function</span>(<span class="params">func</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">val</span> ? <span class="title class_">Maybe</span>(<span class="title function_">func</span>(<span class="variable language_">this</span>.<span class="property">val</span>)) : <span class="title class_">Maybe</span>(<span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(capitalize, <span class="title class_">Maybe</span>(<span class="string">&#x27;flamethrower&#x27;</span>)) <span class="comment">// Maybe(&#x27;Flamethrower&#x27;)</span></span><br><span class="line"><span class="title function_">map</span>(capitalize, <span class="title class_">Maybe</span>(<span class="literal">null</span>)) <span class="comment">// =&gt; Maybe(null)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstMatch = <span class="title function_">compose</span>(first, <span class="title function_">match</span>(<span class="regexp">/cat/g</span>))</span><br><span class="line"></span><br><span class="line"><span class="title function_">firstMatch</span>(<span class="string">&#x27;dogsup&#x27;</span>) <span class="comment">// =&gt; Boom!</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstMatch = <span class="title function_">compose</span>(<span class="title function_">map</span>(first), <span class="title class_">Maybe</span>, <span class="title function_">match</span>(<span class="regexp">/cat/g</span>))</span><br><span class="line"></span><br><span class="line"><span class="title function_">firstMatch</span>(<span class="string">&#x27;dogsup&#x27;</span>) <span class="comment">// =&gt; Maybe(null)</span></span><br></pre></td></tr></table></figure>

<h3 id="Functor-Exercise"><a href="#Functor-Exercise" class="headerlink" title="Functor Exercise"></a>Functor Exercise</h3><p><a target="_blank" rel="noopener" href="http://jsbin.com/yumog">http://jsbin.com/yumog</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">clear</span>();</span><br><span class="line"><span class="keyword">var</span> _ = R;</span><br><span class="line"><span class="keyword">var</span> P = <span class="title class_">PointFree</span>;</span><br><span class="line"><span class="keyword">var</span> map = P.<span class="property">fmap</span>;</span><br><span class="line"><span class="keyword">var</span> compose = P.<span class="property">compose</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Maybe</span> = P.<span class="property">Maybe</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Identity</span> = P.<span class="property">Id</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use _.add(x,y) and map(f,x) to make a function that increments a value inside a functor</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 1--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex1 = <span class="title function_">map</span>(_.<span class="title function_">add</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Identity</span>(<span class="number">3</span>), <span class="title function_">ex1</span>(<span class="title class_">Identity</span>(<span class="number">2</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 1...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use _.head to get the first element of the list</span></span><br><span class="line"><span class="keyword">var</span> xs = <span class="title class_">Identity</span>([<span class="string">&#x27;do&#x27;</span>, <span class="string">&#x27;ray&#x27;</span>, <span class="string">&#x27;me&#x27;</span>, <span class="string">&#x27;fa&#x27;</span>, <span class="string">&#x27;so&#x27;</span>, <span class="string">&#x27;la&#x27;</span>, <span class="string">&#x27;ti&#x27;</span>, <span class="string">&#x27;do&#x27;</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 2--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex2 = <span class="title function_">map</span>(_.<span class="property">head</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Identity</span>(<span class="string">&#x27;do&#x27;</span>), <span class="title function_">ex2</span>(xs))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 2...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use safeGet and _.head to find the first initial of the user</span></span><br><span class="line"><span class="keyword">var</span> safeGet = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">x,o</span>)&#123; <span class="keyword">return</span> <span class="title class_">Maybe</span>(o[x]) &#125;)</span><br><span class="line"><span class="keyword">var</span> user = &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;Albert&quot;</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 3--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex3 = <span class="title function_">compose</span>(<span class="title function_">map</span>(_.<span class="property">head</span>), <span class="title function_">safeGet</span>(<span class="string">&#x27;name&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Maybe</span>(<span class="string">&#x27;A&#x27;</span>), <span class="title function_">ex3</span>(user))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 3...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 4</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use Maybe to rewrite ex4 without an if statement</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 4--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex4 = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="built_in">parseInt</span>), <span class="title class_">Maybe</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Maybe</span>(<span class="number">4</span>), <span class="title function_">ex4</span>(<span class="string">&quot;4&quot;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 4...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TEST HELPERS</span></span><br><span class="line"><span class="comment">// =====================</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inspectIt</span>(<span class="params">x</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (x.<span class="property">inspect</span> &amp;&amp; x.<span class="title function_">inspect</span>()) || (x.<span class="property">toString</span> &amp;&amp; x.<span class="title function_">toString</span>()) || x.<span class="title function_">valueOf</span>(); <span class="comment">//hacky for teachy.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y)&#123; <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertDeepEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">val</span> !== y.<span class="property">val</span>) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+<span class="title function_">inspectIt</span>(x)+<span class="string">&quot; to equal &quot;</span>+<span class="title function_">inspectIt</span>(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Either"><a href="#Either" class="headerlink" title="Either"></a>Either</h3><ul>
<li>Typically used for pure error handling</li>
<li>Like Maybe, but with an error message embedded</li>
<li>Has two subclasses: Left&#x2F;Right</li>
<li>Map the function over a Right, ignores the Left</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>, <span class="title class_">Right</span>(<span class="number">2</span>)) <span class="comment">// =&gt; Right(3)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>, <span class="title class_">Left</span>(<span class="string">&#x27;Some message&#x27;</span>)) <span class="comment">// =&gt; Left(&#x27;Some message&#x27;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> determineAge = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> user.<span class="property">age</span> ? <span class="title class_">Right</span>(user.<span class="property">age</span>) : <span class="title class_">Left</span>(<span class="string">`Couldn&#x27;t get age`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yearOlder = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)), determineAge)</span><br><span class="line"></span><br><span class="line"><span class="title function_">yearOlder</span>(&#123;<span class="attr">age</span>: <span class="number">22</span>&#125;) <span class="comment">// =&gt; Right(23)</span></span><br><span class="line"><span class="title function_">yearOlder</span>(&#123;<span class="attr">age</span>: <span class="literal">null</span>&#125;) <span class="comment">// =&gt; Left(&quot;Couldn&#x27;t get age&quot;)</span></span><br></pre></td></tr></table></figure>

<h3 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h3><ul>
<li>A lazy computation “builder”</li>
<li>Typically used to contain side effects</li>
<li>You must runIO to perform the operation</li>
<li>Map appends the function to a list of things to run with the effectful value</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> email_io = <span class="title function_">IO</span>( <span class="function">() =&gt;</span> $(<span class="string">&#x27;#email&#x27;</span>).<span class="title function_">val</span>() )</span><br><span class="line"><span class="keyword">const</span> msg_io = <span class="title function_">map</span>(<span class="title function_">concat</span>(<span class="string">&#x27;welcome&#x27;</span>), email_io)</span><br><span class="line"></span><br><span class="line"><span class="title function_">runIO</span>(msg_io) <span class="comment">// =&gt; &quot;welcome steve@foodie.net&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getBgColor = <span class="title function_">compose</span>(<span class="title function_">get</span>(<span class="string">&#x27;background-color&#x27;</span>), <span class="title class_">JSON</span>.<span class="property">parse</span>)</span><br><span class="line"><span class="keyword">const</span> bgPref = <span class="title function_">compose</span>(<span class="title function_">map</span>(getBgColor), <span class="title class_">Store</span>.<span class="title function_">get</span>(<span class="string">&#x27;preferences&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">bgPref</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">runIO</span>(app)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> email_io = <span class="title function_">IO</span>(<span class="function">() =&gt;</span> $(<span class="string">&#x27;#email&#x27;</span>).<span class="title function_">val</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getValue = (<span class="function"><span class="params">sel</span> =&gt;</span> $(sel).<span class="title function_">val</span>()).<span class="title function_">toIO</span>()</span><br></pre></td></tr></table></figure>

<h3 id="Either-x2F-IO-Exercise"><a href="#Either-x2F-IO-Exercise" class="headerlink" title="Either&#x2F;IO Exercise"></a>Either&#x2F;IO Exercise</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">clear</span>();</span><br><span class="line"><span class="keyword">var</span> _ = R;</span><br><span class="line"><span class="keyword">var</span> P = <span class="title class_">PointFree</span>;</span><br><span class="line"><span class="keyword">var</span> map = P.<span class="property">fmap</span>;</span><br><span class="line"><span class="keyword">var</span> compose = P.<span class="property">compose</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Maybe</span> = P.<span class="property">Maybe</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Identity</span> = P.<span class="property">Id</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Either</span> = folktale.<span class="property">data</span>.<span class="property">Either</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Left</span> = <span class="title class_">Either</span>.<span class="property">Left</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Right</span> = <span class="title class_">Either</span>.<span class="property">Right</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">IO</span> = P.<span class="property">IO</span>.<span class="property">IO</span>;</span><br><span class="line"><span class="keyword">var</span> runIO = P.<span class="property">IO</span>.<span class="property">runIO</span>;</span><br><span class="line">P.<span class="property">IO</span>.<span class="title function_">extendFn</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Write a function that uses checkActive() and showWelcome() to grant access or return the error</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 1--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> showWelcome = <span class="title function_">compose</span>(_.<span class="title function_">add</span>( <span class="string">&quot;Welcome &quot;</span>), _.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkActive = <span class="keyword">function</span>(<span class="params">user</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> user.<span class="property">active</span> ? <span class="title class_">Right</span>(user) : <span class="title class_">Left</span>(<span class="string">&#x27;Your account is not active&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex1 = <span class="title function_">compose</span>(<span class="title function_">map</span>(showWelcome), checkActive)</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Left</span>(<span class="string">&#x27;Your account is not active&#x27;</span>), <span class="title function_">ex1</span>(&#123;<span class="attr">active</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">&#x27;Gary&#x27;</span>&#125;))</span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Right</span>(<span class="string">&#x27;Welcome Theresa&#x27;</span>), <span class="title function_">ex1</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">&#x27;Theresa&#x27;</span>&#125;))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 1...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Write a validation function that checks for a length &gt; 3. It should return Right(x) if it is greater than 3 and Left(&quot;You need &gt; 3&quot;) otherwise</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 2--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex2 = <span class="keyword">function</span> <span class="title function_">greaterThan3</span>(<span class="params">x</span>) &#123;</span><br><span class="line"><span class="comment">//   return &quot;<span class="doctag">TODO:</span> write me&quot;;</span></span><br><span class="line">  <span class="keyword">return</span> x.<span class="property">length</span> &gt; <span class="number">3</span> ? <span class="title class_">Right</span>(x) : <span class="title class_">Left</span>(<span class="string">&quot;You need &gt; 3&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Right</span>(<span class="string">&quot;fpguy99&quot;</span>), <span class="title function_">ex2</span>(<span class="string">&quot;fpguy99&quot;</span>))</span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Left</span>(<span class="string">&quot;You need &gt; 3&quot;</span>), <span class="title function_">ex2</span>(<span class="string">&quot;...&quot;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 2...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use ex2 above and Either as a functor to save the user if they are valid</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> save = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SAVED USER!&quot;</span>); <span class="keyword">return</span> x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex3 = <span class="title function_">compose</span>(<span class="title function_">map</span>(save), ex2)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 3--------&quot;</span>)</span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Right</span>(<span class="string">&quot;fpguy99&quot;</span>), <span class="title function_">ex3</span>(<span class="string">&quot;fpguy99&quot;</span>))</span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Left</span>(<span class="string">&quot;You need &gt; 3&quot;</span>), <span class="title function_">ex3</span>(<span class="string">&quot;duh&quot;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 3...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 4</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Get the text from the input and strip the spaces</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 4--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getValue = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(x).<span class="property">value</span> &#125;.<span class="title function_">toIO</span>()</span><br><span class="line"><span class="keyword">var</span> stripSpaces = <span class="keyword">function</span>(<span class="params">s</span>)&#123; <span class="keyword">return</span> s.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&#x27;&#x27;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex4 = <span class="title function_">compose</span>(<span class="title function_">map</span>(stripSpaces), getValue)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="string">&quot;honkeytonk&quot;</span>, <span class="title function_">runIO</span>(<span class="title function_">ex4</span>(<span class="string">&#x27;#text&#x27;</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 4...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 5</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use getHref() / getProtocal() and runIO() to get the protocal of the page.</span></span><br><span class="line"><span class="keyword">var</span> getHref = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="keyword">return</span> location.<span class="property">href</span>; &#125;.<span class="title function_">toIO</span>();</span><br><span class="line"><span class="keyword">var</span> getProtocal = <span class="title function_">compose</span>(_.<span class="property">head</span>, _.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line"><span class="keyword">var</span> ex5 = <span class="title function_">compose</span>(<span class="title function_">map</span>(getProtocal), getHref)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 5--------&quot;</span>)</span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="string">&#x27;https:&#x27;</span>, <span class="title function_">runIO</span>(<span class="title function_">ex5</span>(<span class="literal">null</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 5...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 6*</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Write a function that returns the Maybe(email) of the User from getCache(). Don&#x27;t forget to JSON.parse once it&#x27;s pulled from the cache so you can _.get() the email</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setup...</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="property">user</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">email</span>: <span class="string">&quot;george@foreman.net&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getCache = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> <span class="title class_">Maybe</span>(<span class="variable language_">localStorage</span>[x]); &#125;.<span class="title function_">toIO</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getStringEmail = <span class="title function_">compose</span>( _.<span class="title function_">get</span>(<span class="string">&#x27;email&#x27;</span>), <span class="title class_">JSON</span>.<span class="property">parse</span>)</span><br><span class="line"><span class="keyword">var</span> ex6 = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">map</span>(getEmail)), getCache) <span class="comment">// 使用第一个map转换io内的数据，在使用第二个map转换Maybe内的数据</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Maybe</span>(<span class="string">&quot;george@foreman.net&quot;</span>), <span class="title function_">runIO</span>(<span class="title function_">ex6</span>(<span class="string">&#x27;user&#x27;</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 6...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TEST HELPERS</span></span><br><span class="line"><span class="comment">// =====================</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inspectIt</span>(<span class="params">x</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (x.<span class="property">inspect</span> &amp;&amp; x.<span class="title function_">inspect</span>()) || (x.<span class="property">toString</span> &amp;&amp; x.<span class="title function_">toString</span>()) || x.<span class="title function_">valueOf</span>(); <span class="comment">//hacky for teachy.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y)&#123; <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertDeepEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">val</span> !== y.<span class="property">val</span>) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+<span class="title function_">inspectIt</span>(x)+<span class="string">&quot; to equal &quot;</span>+<span class="title function_">inspectIt</span>(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Other-Functors"><a href="#Other-Functors" class="headerlink" title="Other Functors"></a>Other Functors</h3><h4 id="EventStream"><a href="#EventStream" class="headerlink" title="EventStream"></a>EventStream</h4><ul>
<li>An infinite list of results</li>
<li>Dual of array</li>
<li>Its map is sometimes lazy</li>
<li>Calls the mapped function each time an event happens</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id_s = <span class="title function_">map</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="string">`#<span class="subst">$&#123;e.id&#125;</span>`</span>, <span class="title class_">Bacon</span>.<span class="title function_">fromEventTarget</span>(<span class="variable language_">document</span>, <span class="string">&#x27;click&#x27;</span>))</span><br><span class="line"><span class="comment">// =&gt; EventStream(String)</span></span><br><span class="line"></span><br><span class="line">id_s.<span class="title function_">onValue</span>(<span class="function"><span class="params">id</span> =&gt;</span> &#123;<span class="title function_">alert</span>(<span class="string">`you clicked <span class="subst">$&#123;id&#125;</span>`</span>)&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id_s = <span class="title function_">map</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="string">`#<span class="subst">$&#123;e.id&#125;</span>`</span>, <span class="title class_">Bacon</span>.<span class="title function_">fromEventTarget</span>(<span class="variable language_">document</span>, <span class="string">&#x27;click&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> elements_s = <span class="title function_">map</span>(doucment.<span class="property">querySelector</span>, id_s)</span><br><span class="line"><span class="comment">// EventStream(Elements)</span></span><br><span class="line"></span><br><span class="line">elements_s.<span class="title function_">onValue</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;<span class="title function_">alert</span>(<span class="string">`The inner html is <span class="subst">$&#123;e.innerHTML&#125;</span>`</span>)&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hover_s = <span class="title class_">Bacon</span>.<span class="title function_">fromEventTarget</span>(<span class="variable language_">document</span>, <span class="string">&quot;hover&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> element_s = <span class="title function_">map</span>(<span class="title function_">compose</span>(<span class="variable language_">document</span>.<span class="property">querySelector</span>, <span class="title function_">get</span>(<span class="string">&#x27;id&#x27;</span>)), hover_s)</span><br><span class="line"><span class="keyword">var</span> postid_s = <span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">el</span>) &#123; <span class="keyword">return</span> el.<span class="title function_">data</span>(<span class="string">&#x27;post-id&#x27;</span>) &#125;, element_s)</span><br><span class="line"><span class="keyword">var</span> future_post_s = <span class="title function_">map</span>(<span class="title class_">Api</span>.<span class="property">getProductById</span>, postid_s)</span><br><span class="line"><span class="comment">//=&gt; EventStream(Future(Post))</span></span><br><span class="line"></span><br><span class="line">future_post_s.<span class="title function_">onValue</span>(alert)</span><br></pre></td></tr></table></figure>

<h4 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h4><ul>
<li>Has an eventual value</li>
<li>Similar to a promise, but it’s “lazy”</li>
<li>You must fork it to kick it off</li>
<li>It takes a function as it’s value</li>
<li>Calls the function with it’s result once it’s there</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">makeHtml</span> = post =&gt; <span class="string">`&lt;div&gt;<span class="subst">$&#123;post.title&#125;</span>&lt;/div&gt;`</span>,</span><br><span class="line">  page_f = <span class="title function_">map</span>(makeHtml, http.<span class="title function_">get</span>(<span class="string">&#x27;/posts/2&#x27;</span>))</span><br><span class="line"></span><br><span class="line">page_f.<span class="title function_">fork</span>(</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;<span class="keyword">throw</span>(err)&#125;,</span><br><span class="line">  <span class="function"><span class="params">page</span> =&gt;</span> &#123;$(<span class="string">&#x27;#container&#x27;</span>).<span class="title function_">html</span>(page)&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">makeHtml</span> = title =&gt; <span class="string">`&lt;div&gt;<span class="subst">$&#123;title&#125;</span>&lt;/div&gt;`</span>,</span><br><span class="line">  createPage = <span class="title function_">compose</span>(makeHtml, <span class="title function_">get</span>(<span class="string">&#x27;title&#x27;</span>)),</span><br><span class="line">  page_f = <span class="title function_">compose</span>(<span class="title function_">map</span>(createPage), http.<span class="title function_">get</span>(<span class="string">&#x27;/posts/2&#x27;</span>))</span><br><span class="line"></span><br><span class="line">page_f.<span class="title function_">fork</span>(</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">throw</span>(err) &#125;,</span><br><span class="line">  <span class="function"><span class="params">page</span> =&gt;</span> &#123; $(<span class="string">&#x27;#container&#x27;</span>).<span class="title function_">html</span>(page) &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineCount = <span class="title function_">compose</span>(length, <span class="title function_">split</span>(<span class="regexp">/n\n/</span>)),</span><br><span class="line">  fileLineCount = <span class="title function_">compose</span>(<span class="title function_">map</span>(lineCount), readFile)</span><br><span class="line"></span><br><span class="line"><span class="title function_">fileLineCount</span>(<span class="string">&#x27;mydoc.txt&#x27;</span>).<span class="title function_">fork</span>(log, log) <span class="comment">// =&gt; 34</span></span><br></pre></td></tr></table></figure>

<h3 id="Other-Functors-Exercise"><a href="#Other-Functors-Exercise" class="headerlink" title="Other Functors: Exercise"></a>Other Functors: Exercise</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">clear</span>();</span><br><span class="line"><span class="keyword">var</span> _ = ramda;</span><br><span class="line"><span class="keyword">var</span> P = <span class="title class_">PointFree</span>;</span><br><span class="line"><span class="keyword">var</span> map = P.<span class="property">fmap</span>;</span><br><span class="line"><span class="keyword">var</span> compose = P.<span class="property">compose</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Maybe</span> = P.<span class="property">Maybe</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Identity</span> = P.<span class="property">Id</span>;</span><br><span class="line"><span class="keyword">var</span> runIO = P.<span class="property">IO</span>.<span class="property">runIO</span>;</span><br><span class="line">P.<span class="property">IO</span>.<span class="title function_">extendFn</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use getPost(id) to return a Future of the title of the post (&#123;id: i, title: &#x27;Love them futures&#x27;&#125;)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 1--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex1 = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">_get</span>(<span class="string">&#x27;title&#x27;</span>)), getPost)</span><br><span class="line"></span><br><span class="line"><span class="title function_">ex1</span>(<span class="number">3</span>).<span class="title function_">fork</span>(log, <span class="keyword">function</span>(<span class="params">title</span>)&#123;</span><br><span class="line">  <span class="title function_">assertEqual</span>(<span class="string">&#x27;Love them futures&#x27;</span>, title)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 1..ok!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use ex1 to extend the computation and render the title in a div</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 2--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> render = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> <span class="string">&quot;&lt;div&gt;&quot;</span>+x+<span class="string">&quot;&lt;/div&gt;&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">var</span> ex2 = <span class="title function_">compose</span>(<span class="title function_">map</span>(render), ex1)</span><br><span class="line"></span><br><span class="line"><span class="title function_">ex2</span>(<span class="number">3</span>).<span class="title function_">fork</span>(log, <span class="keyword">function</span>(<span class="params">html</span>)&#123;</span><br><span class="line">  <span class="title function_">assertEqual</span>(<span class="string">&#x27;&lt;div&gt;Love them futures&lt;/div&gt;&#x27;</span>, html)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 2...ok!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// In JSBin, click the &quot;Output&quot; tab to see a div. Click this div to run the test.</span></span><br><span class="line"><span class="comment">// Turn the clicks into a stream of the div&#x27;s innerHTML</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 3--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clicks = <span class="title class_">Bacon</span>.<span class="title function_">fromEventTarget</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#box&quot;</span>), <span class="string">&quot;click&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Todo: turn clicks into a stream of the e.target.innerHTML</span></span><br><span class="line"><span class="keyword">var</span> htmlClicks = clicks.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123; <span class="keyword">return</span> e.<span class="property">target</span>.<span class="property">innerHTML</span>; &#125;)</span><br><span class="line"></span><br><span class="line">htmlClicks.<span class="title function_">onValue</span>(<span class="keyword">function</span>(<span class="params">html</span>)&#123;</span><br><span class="line">  <span class="title function_">assertEqual</span>(<span class="string">&#x27;&lt;span&gt;CLICK ME&lt;/span&gt;&#x27;</span>, <span class="title function_">trim</span>(html))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 3...ok!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 4</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Keep the Output tab open. Type into the input to run the test.</span></span><br><span class="line"><span class="comment">// Transform the keydowns into a stream of the input&#x27;s value</span></span><br><span class="line"><span class="comment">// Then use pureLog() to log it to the console</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 4--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pureLog = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="keyword">return</span> x; &#125;.<span class="title function_">toIO</span>();</span><br><span class="line"><span class="keyword">var</span> search_input = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#search&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> keydowns = <span class="title class_">Bacon</span>.<span class="title function_">fromEventTarget</span>(search_input, <span class="string">&quot;keydown&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Todo: turn keydowns into a stream of the logged input&#x27;s value</span></span><br><span class="line"><span class="keyword">var</span> logs = keydowns;</span><br><span class="line"></span><br><span class="line">logs.<span class="title function_">onValue</span>(<span class="keyword">function</span>(<span class="params">io</span>)&#123;</span><br><span class="line">  <span class="title function_">assertEqual</span>(search_input.<span class="property">value</span>, <span class="title function_">runIO</span>(io))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 4...ok!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 5*</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use only safeGet() to safely return the street name</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 5--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> safeGet = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">x,o</span>)&#123; <span class="keyword">return</span> <span class="title class_">Maybe</span>(o[x]) &#125;)</span><br><span class="line"><span class="keyword">var</span> user = &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;Albert&quot;</span>, <span class="attr">address</span>: &#123; <span class="attr">street</span>: &#123;<span class="attr">number</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;Walnut St&#x27;</span>&#125; &#125; &#125;</span><br><span class="line"><span class="keyword">var</span> ex5 = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">map</span>(<span class="title function_">safeGet</span>(<span class="string">&#x27;name&#x27;</span>))), <span class="title function_">map</span>(<span class="title function_">safeGet</span>(<span class="string">&#x27;street&#x27;</span>)), <span class="title function_">safeGet</span>(<span class="string">&#x27;address&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Maybe</span>(<span class="title class_">Maybe</span>(<span class="title class_">Maybe</span>(<span class="string">&#x27;Walnut St&#x27;</span>))), <span class="title function_">ex5</span>(user))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 5...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TEST HELPERS</span></span><br><span class="line"><span class="comment">// =====================</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inspectIt</span>(<span class="params">x</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (x.<span class="property">inspect</span> &amp;&amp; x.<span class="title function_">inspect</span>()) || (x.<span class="property">toString</span> &amp;&amp; x.<span class="title function_">toString</span>()) || x.<span class="title function_">valueOf</span>(); <span class="comment">//hacky for teachy.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y)&#123; <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertDeepEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">val</span> !== y.<span class="property">val</span>) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+<span class="title function_">inspectIt</span>(x)+<span class="string">&quot; to equal &quot;</span>+<span class="title function_">inspectIt</span>(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">x</span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="keyword">return</span> x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPost</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Future</span>(<span class="keyword">function</span>(<span class="params">rej, res</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">res</span>(&#123;<span class="attr">id</span>: i, <span class="attr">title</span>: <span class="string">&#x27;Love them futures&#x27;</span>&#125;)  </span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getComments</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Future</span>(<span class="keyword">function</span>(<span class="params">rej, res</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">res</span>([<span class="string">&quot;This class should be illegal&quot;</span>, <span class="string">&quot;Monads are like space burritos&quot;</span>])</span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trim</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> x.<span class="title function_">replace</span>(<span class="string">&#x27;/\S&#123;0,&#125;/g&#x27;</span>, <span class="string">&#x27;&#x27;</span>); &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Functor-Laws-amp-Properties"><a href="#Functor-Laws-amp-Properties" class="headerlink" title="Functor Laws &amp; Properties"></a>Functor Laws &amp; Properties</h3><p>Recognize map</p>
<table>
<thead>
<tr>
<th>Custom names</th>
<th>We see it is map</th>
</tr>
</thead>
<tbody><tr>
<td><code>[x].map(f) // [f(x)]</code></td>
<td><code>map(f, [x]) //[f(x)]</code></td>
</tr>
<tr>
<td><code>Maybe(x).attempt(f) // Maybe(f(x))</code></td>
<td><code>map(f, Maybe(x)) // Maybe(f(x))</code></td>
</tr>
<tr>
<td><code>Promise(x).then(f) // Promise(f(x))</code></td>
<td><code>map(f, Promise(x)) // Promise(f(x))</code></td>
</tr>
<tr>
<td><code>EventStream(x).subscribe(f) // EventStream(f(x))</code></td>
<td>map(f, EventStream(x)) &#x2F;&#x2F; EventStream(f(x))</td>
</tr>
</tbody></table>
<p>Laws &amp; Properties are useful</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// identity</span></span><br><span class="line"><span class="title function_">map</span>(id) == id</span><br><span class="line"></span><br><span class="line"><span class="comment">// composition</span></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">map</span>(f), <span class="title function_">map</span>(g)) == <span class="title function_">map</span>(<span class="title function_">compose</span>(f, g))</span><br></pre></td></tr></table></figure>

<p>reverse :: String -&gt; String<br>toArray :: a -&gt; Array a</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toArray = <span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> [x] &#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(toArray, reverse)(<span class="string">&quot;bingo&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; [ognib]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">map</span>(reverse), toArray)(<span class="string">&quot;bingo&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; [ognib]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">compose</span>(toArray, <span class="title function_">compose</span>(toUpper, reverse))(<span class="string">&quot;bingo&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; [OGNIB]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">map</span>(toUpper), <span class="title function_">map</span>(reverse), toArray)(<span class="string">&quot;bingo&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; [OGNIB]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">compose</span>(toUpper, reverse)), toArray)(<span class="string">&quot;bingo&quot;</span>)</span><br><span class="line"><span class="comment">//=&gt; [OGNIB]</span></span><br></pre></td></tr></table></figure>

<h4 id="Natural-Transformations"><a href="#Natural-Transformations" class="headerlink" title="Natural Transformations"></a>Natural Transformations</h4><p>nt:: F a -&gt; T a</p>
<p>“Take one functor to another without knowing anything about the values”</p>
<p>maybeToArray :: Maybe a -&gt; Array a</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">maybeToArray</span>(<span class="title class_">Maybe</span>(<span class="number">2</span>)) <span class="comment">// =&gt; [2]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">maybeToArray</span>(<span class="title class_">Maybe</span>(<span class="literal">null</span>)) <span class="comment">// =&gt; []</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">compose</span>(nt, <span class="title function_">map</span>(f)) == <span class="title function_">compose</span>(<span class="title function_">map</span>(f), nt)</span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(maybeToArray, <span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)))(<span class="title class_">Maybe</span>(<span class="number">5</span>)) <span class="comment">// [6]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">add</span>(<span class="number">1</span>)), maybeToArray)(<span class="title class_">Maybe</span>(<span class="number">5</span>)) <span class="comment">// [6]</span></span><br></pre></td></tr></table></figure>

<h4 id="Card-Game-1"><a href="#Card-Game-1" class="headerlink" title="Card Game #1"></a>Card Game #1</h4><p>“Make an api call with an id and possibly retrieve a post”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Future</span>(<span class="title class_">Maybe</span>(<span class="title class_">Post</span>))</span><br></pre></td></tr></table></figure>

<h4 id="Card-Game-2"><a href="#Card-Game-2" class="headerlink" title="Card Game #2"></a>Card Game #2</h4><p>“Click a navigation link and insert the corresponding html on the page”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">EventStream</span>(<span class="title function_">IO</span>(<span class="title class_">Dom</span>))</span><br></pre></td></tr></table></figure>

<h4 id="Card-Game-3"><a href="#Card-Game-3" class="headerlink" title="Card Game #3"></a>Card Game #3</h4><p>“Submit a signup form &amp; return errors or make an API call that will create a user”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">EventStream</span>(<span class="title class_">Either</span>(<span class="title class_">Future</span>(<span class="title class_">User</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="Monads"><a href="#Monads" class="headerlink" title="Monads"></a>Monads</h3><h4 id="Pointed-Functors"><a href="#Pointed-Functors" class="headerlink" title="Pointed Functors"></a>Pointed Functors</h4><p>of :: a -&gt; F a</p>
<p>aka: pure, return, unit, point</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Container</span>.<span class="title function_">of</span>(split) <span class="comment">// Container(split)</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Future</span>.<span class="title function_">of</span>(<span class="title function_">match</span>(<span class="regexp">/dubstep/</span>)) <span class="comment">// Future(match(/dubstep))</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Maybe</span>.<span class="title function_">of</span>(reverse) <span class="comment">// Maybe(reverse)</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">EventStream</span>.<span class="title function_">of</span>(<span class="title function_">replace</span>(<span class="regexp">/debstep/</span>, <span class="string">&#x27;shoegaze&#x27;</span>)) <span class="comment">// EventStream(replace(/debstep/, &#x27;shoegaze&#x27;))</span></span><br></pre></td></tr></table></figure>

<h4 id="monads"><a href="#monads" class="headerlink" title="monads"></a>monads</h4><p>A monad is a pointed functor with an extra function called mjoin and&#x2F;or chain</p>
<p>“Nested computations”</p>
<p>functions: mjoin, chain</p>
<p>mjion :: M M a -&gt; M a</p>
<p>chain :: (a -&gt; M b) -&gt; M a -&gt; M b</p>
<p>Pointed Functor + mjoin|chain &#x3D; Monad</p>
<p>aka: pure, return, unit, point</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">mjoin</span>(<span class="title class_">Container</span>(<span class="title class_">Container</span>(<span class="number">2</span>))) <span class="comment">// Container(2)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getTrackingId = <span class="title function_">compose</span>(<span class="title class_">Maybe</span>, <span class="title function_">get</span>(<span class="string">&#x27;tracking_id&#x27;</span>)),</span><br><span class="line">  findOrder = <span class="title function_">compose</span>(<span class="title class_">Maybe</span>, <span class="title class_">Api</span>.<span class="property">findOrder</span>),</span><br><span class="line">  getOrderTracking = <span class="title function_">compose</span>(<span class="title function_">map</span>(getTrackingId), findOrder)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderPage = <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">map</span>(renderTemplete)), getOrderTracking)</span><br><span class="line"><span class="title function_">renderPage</span>(<span class="number">379</span>) <span class="comment">// =&gt; Maybe(Maybe(Html))</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getTrackingId = <span class="title function_">compose</span>(<span class="title class_">Maybe</span>, <span class="title function_">get</span>(<span class="string">&#x27;tracking_id&#x27;</span>)),</span><br><span class="line">  findOrder = <span class="title function_">compose</span>(<span class="title class_">Maybe</span>, <span class="title class_">Api</span>.<span class="property">findOrder</span>),</span><br><span class="line">  getOrderTracking = <span class="title function_">compose</span>(mjoin, <span class="title function_">map</span>(getTrackingId), findOrder) <span class="comment">// 使用mjoin压平Maybe为一层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderPage = <span class="title function_">compose</span>(<span class="title function_">map</span>(renderTemplete), getOrderTracking)</span><br><span class="line"><span class="title function_">renderPage</span>(<span class="number">379</span>) <span class="comment">// =&gt; Maybe(Html)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setSearchInput = (<span class="function"><span class="params">x</span> =&gt;</span> (<span class="string">&#x27;#input&#x27;</span>).<span class="title function_">val</span>(x)).<span class="title function_">toIO</span>(),</span><br><span class="line">  getSearchTerm = (<span class="function">() =&gt;</span> <span class="title function_">getParam</span>(<span class="string">&#x27;term&#x27;</span>, location.<span class="property">search</span>)).<span class="title function_">toIO</span>()</span><br><span class="line">  initSearchForm = <span class="title function_">compose</span>(<span class="title function_">map</span>(setSearchInput), getSearchTerm)</span><br><span class="line"></span><br><span class="line"><span class="title function_">initSearchForm</span>() <span class="comment">// =&gt; IO(IO(Dom))</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">map</span>(runIO, <span class="title function_">initSearchForm</span>())</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setSearchInput = (<span class="function"><span class="params">x</span> =&gt;</span> (<span class="string">&#x27;#input&#x27;</span>).<span class="title function_">val</span>(x)).<span class="title function_">toIO</span>(),</span><br><span class="line">  getSearchTerm = (<span class="function">() =&gt;</span> <span class="title function_">getParam</span>(<span class="string">&#x27;term&#x27;</span>, location.<span class="property">search</span>)).<span class="title function_">toIO</span>()</span><br><span class="line">  initSearchForm = <span class="title function_">compose</span>(mjoin, <span class="title function_">map</span>(setSearchInput), getSearchTerm)</span><br><span class="line"></span><br><span class="line"><span class="title function_">initSearchForm</span>() <span class="comment">// =&gt; IO(Dom)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">runIO</span>(<span class="title function_">initSearchForm</span>())</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sendToServer = <span class="title function_">httpGet</span>(<span class="string">&#x27;/upload&#x27;</span>),</span><br><span class="line">  upLoadFromFile = <span class="title function_">compose</span>(mjoin, <span class="title function_">map</span>(sendToServer), readFile)</span><br><span class="line"></span><br><span class="line"><span class="title function_">upLoadFromFile</span>(<span class="string">&#x27;/tmp/my_file.txt&#x27;</span>).<span class="title function_">fork</span>(logErr, alertSuccess)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sendToServer = <span class="title function_">httpGet</span>(<span class="string">&#x27;/upload&#x27;</span>),</span><br><span class="line">  upLoadFromFile = <span class="title function_">compose</span>(mjoin, <span class="title function_">map</span>(sendToServer), mjoin, <span class="title function_">map</span>(readFlie), askUser)</span><br><span class="line"></span><br><span class="line"><span class="title function_">upLoadFile</span>(<span class="string">&#x27;What file?&#x27;</span>).<span class="title function_">fork</span>(logErr, alertSuccess)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chain = <span class="keyword">function</span>(<span class="params">f</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">compose</span>(mjion, <span class="title function_">map</span>(f))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">aka</span>: flatMap, bind</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sendToServer = <span class="title function_">httpGet</span>(<span class="string">&#x27;/upload&#x27;</span>),</span><br><span class="line">  upLoadFromFlie = <span class="title function_">compose</span>(<span class="title function_">chain</span>(sendToServer), <span class="title function_">chain</span>(readFile), askUser)</span><br><span class="line"></span><br><span class="line"><span class="title function_">upLoadFromFile</span>(<span class="string">&#x27;What file?&#x27;</span>).<span class="title function_">fork</span>(logErr, alertSuccess)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sendToServer = <span class="title function_">httpGet</span>(<span class="string">&#x27;/upload&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">upLoadFromFile</span> = what =&gt; <span class="title function_">askUser</span>(what).<span class="title function_">chain</span>(readFile).<span class="title function_">chain</span>(sendToServer)</span><br><span class="line"></span><br><span class="line"><span class="title function_">upLoadFromFile</span>(<span class="string">&#x27;What file?&#x27;</span>).<span class="title function_">fork</span>(logErr, alertSuccess)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">chain</span> = f =&gt; <span class="title function_">compose</span>(mjoin, <span class="title function_">map</span>(f))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mjoin = <span class="title function_">chain</span>(id)</span><br></pre></td></tr></table></figure>

<h3 id="Monads-Exercises"><a href="#Monads-Exercises" class="headerlink" title="Monads Exercises"></a>Monads Exercises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">clear</span>();</span><br><span class="line"><span class="keyword">var</span> _ = R;</span><br><span class="line"><span class="keyword">var</span> P = <span class="title class_">PointFree</span>;</span><br><span class="line"><span class="keyword">var</span> map = P.<span class="property">fmap</span>;</span><br><span class="line"><span class="keyword">var</span> mjoin = P.<span class="property">mjoin</span>;</span><br><span class="line"><span class="keyword">var</span> chain = P.<span class="property">flatMap</span>;</span><br><span class="line"><span class="keyword">var</span> compose = P.<span class="property">compose</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Maybe</span> = P.<span class="property">Maybe</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Identity</span> = P.<span class="property">Id</span>;</span><br><span class="line"><span class="keyword">var</span> runIO = P.<span class="property">IO</span>.<span class="property">runIO</span>;</span><br><span class="line">P.<span class="property">IO</span>.<span class="title function_">extendFn</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use safeGet and mjoin or chain to safetly get the street name</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 1--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> safeGet = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">x,o</span>)&#123; <span class="keyword">return</span> <span class="title class_">Maybe</span>(o[x]) &#125;)</span><br><span class="line"><span class="keyword">var</span> user = &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;Albert&quot;</span>, <span class="attr">address</span>: &#123; <span class="attr">street</span>: &#123;<span class="attr">number</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;Walnut St&#x27;</span>&#125; &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex1 = <span class="title function_">compose</span>(<span class="title function_">chain</span>(<span class="title function_">safeGet</span>(<span class="string">&#x27;name&#x27;</span>)), <span class="title function_">chain</span>(<span class="title function_">safeGet</span>(<span class="string">&#x27;street&#x27;</span>)),<span class="title function_">safeGet</span>(<span class="string">&#x27;address&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertDeepEqual</span>(<span class="title class_">Maybe</span>(<span class="string">&#x27;Walnut St&#x27;</span>), <span class="title function_">ex1</span>(user))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 1...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use monads to get the href, then purely log it.</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 2--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getHref = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="keyword">return</span> location.<span class="property">href</span> &#125;.<span class="title function_">toIO</span>();</span><br><span class="line"><span class="keyword">var</span> pureLog = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="keyword">return</span> x; &#125;.<span class="title function_">toIO</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex2 = <span class="title function_">compose</span>(<span class="title function_">chain</span>(pureLog),getHref)</span><br><span class="line"></span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="string">&quot;https://null.jsbin.com/runner&quot;</span>, <span class="title function_">runIO</span>(<span class="title function_">ex2</span>(<span class="literal">null</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 2...ok!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// ==========</span></span><br><span class="line"><span class="comment">// Use monads to first get the Post with getPost(), then pass it&#x27;s id in to getComments().</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--------Start exercise 3--------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ex3 = <span class="title function_">compose</span>(<span class="title function_">chain</span>(getComments, _.<span class="title function_">get</span>(<span class="string">&#x27;id&#x27;</span>)), getPost)</span><br><span class="line"></span><br><span class="line"><span class="title function_">ex3</span>(<span class="number">13</span>).<span class="title function_">fork</span>(log, <span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">  <span class="title function_">assertEqual</span>(<span class="number">2</span>, res.<span class="property">length</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;exercise 3...ok!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TEST HELPERS</span></span><br><span class="line"><span class="comment">// =====================</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inspectIt</span>(<span class="params">x</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (x.<span class="property">inspect</span> &amp;&amp; x.<span class="title function_">inspect</span>()) || (x.<span class="property">toString</span> &amp;&amp; x.<span class="title function_">toString</span>()) || x.<span class="title function_">valueOf</span>(); <span class="comment">//hacky for teachy.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x !== y)&#123; <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+x+<span class="string">&quot; to equal &quot;</span>+y); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertDeepEqual</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(x.<span class="property">val</span> !== y.<span class="property">val</span>) <span class="keyword">throw</span>(<span class="string">&quot;expected &quot;</span>+<span class="title function_">inspectIt</span>(x)+<span class="string">&quot; to equal &quot;</span>+<span class="title function_">inspectIt</span>(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">x</span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="keyword">return</span> x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPost</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Future</span>(<span class="keyword">function</span>(<span class="params">rej, res</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">res</span>(&#123;<span class="attr">id</span>: i, <span class="attr">title</span>: <span class="string">&#x27;Love them futures&#x27;</span>&#125;)  </span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getComments</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Future</span>(<span class="keyword">function</span>(<span class="params">rej, res</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">res</span>([<span class="string">&quot;This class should be illegal&quot;</span>, <span class="string">&quot;Monads are like space burritos&quot;</span>])</span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trim</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> x.<span class="title function_">replace</span>(<span class="string">&#x27;/\S&#123;0,&#125;/g&#x27;</span>, <span class="string">&#x27;&#x27;</span>); &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Monad-Laws"><a href="#Monad-Laws" class="headerlink" title="Monad Laws"></a>Monad Laws</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">compose</span>(mjoin, <span class="title function_">fmap</span>(g), mjoin, <span class="title function_">fmap</span>(f))</span><br><span class="line"></span><br><span class="line"><span class="title function_">mcompose</span>(g, f)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// left identity</span></span><br><span class="line"><span class="title function_">mcompose</span>(M, f)  == f</span><br><span class="line"></span><br><span class="line"><span class="comment">// right identity</span></span><br><span class="line"><span class="title function_">mcompose</span>(f, M)  == f</span><br><span class="line"></span><br><span class="line"><span class="comment">// associativity</span></span><br><span class="line"><span class="title function_">mcompose</span>(<span class="title function_">mcompose</span>(f, g), h)  == <span class="title function_">mcompose</span>(f, <span class="title function_">mcompose</span>(g, h))</span><br></pre></td></tr></table></figure>

<h2 id="The-Demo"><a href="#The-Demo" class="headerlink" title="The Demo"></a>The Demo</h2><h3 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h3><p>Libraries are Evolving</p>
<p>We’ll combine the best ones</p>
<ul>
<li>CrossEye &#x2F; ramda</li>
<li>baconjs &#x2F; bacon.js</li>
<li>fantasyland &#x2F; fantasy-io</li>
<li>DrBoolean &#x2F; pointfree-fantasy</li>
<li>folktale &#x2F; data.either</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/begriffs/immutube">github.com&#x2F;begriffs&#x2F;immutube</a></p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HELPERS ///////////////////////////////////////////</span></span><br><span class="line">  <span class="keyword">var</span> compose = P.<span class="property">compose</span>;</span><br><span class="line">  <span class="keyword">var</span> map = P.<span class="property">map</span>;</span><br><span class="line">  <span class="keyword">var</span> log = <span class="keyword">function</span>(<span class="params">x</span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="keyword">return</span> x; &#125;</span><br><span class="line">  <span class="keyword">var</span> fork = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">f, future</span>) &#123; <span class="keyword">return</span> future.<span class="title function_">fork</span>(log, f); &#125;)</span><br><span class="line">  <span class="keyword">var</span> setHtml = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">sel, x</span>) &#123; <span class="keyword">return</span> $(sel).<span class="title function_">html</span>(x); &#125;);</span><br><span class="line">  <span class="keyword">var</span> listen = _.<span class="title function_">curry</span>(<span class="keyword">function</span> (<span class="params">event, target</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> bacon.<span class="title function_">fromEventTarget</span>(target, event);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> getData = _.<span class="title function_">curry</span>(<span class="keyword">function</span>(<span class="params">name, elt</span>) &#123; <span class="keyword">return</span> $(elt).<span class="title function_">data</span>(name); &#125;);</span><br><span class="line">  <span class="keyword">var</span> last = <span class="keyword">function</span>(<span class="params">ar</span>) &#123; <span class="keyword">return</span> ar[ar.<span class="property">length</span> - <span class="number">1</span>]; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// PURE //////////////////////////////////////////////////</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//  api_key :: String</span></span><br><span class="line">  <span class="keyword">var</span> api_key = <span class="string">&#x27;AIzaSyAWoa7aqds2Cx_drrrb5FPsRObFa7Dxkfg&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ eventValue :: DomEvent -&gt; String</span></span><br><span class="line">  <span class="keyword">var</span> eventValue = <span class="title function_">compose</span>(_.<span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>), _.<span class="title function_">get</span>(<span class="string">&#x27;target&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ valueStream :: DomEvent -&gt; EventStream String</span></span><br><span class="line">  <span class="keyword">var</span> valueStream = <span class="title function_">compose</span>(<span class="title function_">map</span>(eventValue), <span class="title function_">listen</span>(<span class="string">&#x27;keyup&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ termToUrl :: String -&gt; URL</span></span><br><span class="line">  <span class="keyword">var</span> termToUrl = <span class="keyword">function</span>(<span class="params">term</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;https://www.googleapis.com/youtube/v3/search?&#x27;</span> +</span><br><span class="line">      $.<span class="title function_">param</span>(&#123;<span class="attr">part</span>: <span class="string">&#x27;snippet&#x27;</span>, <span class="attr">q</span>: term, <span class="attr">key</span>: api_key&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ urlStream :: DomEvent -&gt; EventStream String</span></span><br><span class="line">  <span class="keyword">var</span> urlStream = <span class="title function_">compose</span>(<span class="title function_">map</span>(termToUrl), valueStream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ getInputStream :: Selector -&gt; IO EventStream String</span></span><br><span class="line">  <span class="keyword">var</span> getInputStream = <span class="title function_">compose</span>(<span class="title function_">map</span>(urlStream), $.<span class="title function_">toIO</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ render :: Entry -&gt; Dom</span></span><br><span class="line">  <span class="keyword">var</span> render = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">&#x27;&lt;li/&gt;&#x27;</span>, &#123;<span class="attr">text</span>: e.<span class="property">snippet</span>.<span class="property">title</span>, <span class="string">&#x27;data-youtubeid&#x27;</span>: e.<span class="property">id</span>.<span class="property">videoId</span>&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ videoEntries :: YoutubeResponse -&gt; [Dom]</span></span><br><span class="line">  <span class="keyword">var</span> videoEntries = <span class="title function_">compose</span>(<span class="title function_">map</span>(render), _.<span class="title function_">get</span>(<span class="string">&#x27;items&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ search :: URL -&gt; Future [Dom]</span></span><br><span class="line">  <span class="keyword">var</span> search = <span class="title function_">compose</span>(<span class="title function_">map</span>(videoEntries), http.<span class="property">getJSON</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ DomElement -&gt; EventStream DomElement</span></span><br><span class="line">  <span class="keyword">var</span> clickStream = <span class="title function_">compose</span>(<span class="title function_">map</span>(_.<span class="title function_">get</span>(<span class="string">&#x27;target&#x27;</span>)), <span class="title function_">listen</span>(<span class="string">&#x27;click&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ URL -&gt; String</span></span><br><span class="line">  <span class="keyword">var</span> idInUrl = <span class="title function_">compose</span>(last, _.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//+ youtubeLink :: DomElement -&gt; Maybe ID</span></span><br><span class="line">  <span class="keyword">var</span> youtubeId = <span class="title function_">compose</span>(<span class="title function_">map</span>(idInUrl), <span class="title class_">Maybe</span>, <span class="title function_">getData</span>(<span class="string">&#x27;youtubeid&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// IMPURE /////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">getInputStream</span>(<span class="string">&#x27;#search&#x27;</span>).<span class="title function_">runIO</span>().<span class="title function_">onValue</span>(</span><br><span class="line">    <span class="title function_">compose</span>(<span class="title function_">fork</span>(<span class="title function_">setHtml</span>(<span class="string">&#x27;#results&#x27;</span>)), search)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clickStream</span>(<span class="variable language_">document</span>).<span class="title function_">onValue</span>(</span><br><span class="line">    <span class="title function_">compose</span>(<span class="title function_">map</span>(<span class="title function_">compose</span>(<span class="title function_">setHtml</span>(<span class="string">&#x27;#player&#x27;</span>), <span class="title class_">Player</span>.<span class="property">create</span>)), youtubeId)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/FrontEndMasters/" rel="tag"># FrontEndMasters</a>
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
              <a href="/tags/Functional-Programming/" rel="tag"># Functional Programming</a>
              <a href="/tags/Point-Free/" rel="tag"># Point-Free</a>
              <a href="/tags/Monads/" rel="tag"># Monads</a>
              <a href="/tags/Functor/" rel="tag"># Functor</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/07/09/Rethinking-Asynchronous-JavaScript/" rel="prev" title="Rethinking Asynchronous JavaScript">
                  <i class="fa fa-chevron-left"></i> Rethinking Asynchronous JavaScript
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/07/16/Webpack-4-Fundamentals/" rel="next" title="Webpack 4 Fundamentals">
                  Webpack 4 Fundamentals <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘勇</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
