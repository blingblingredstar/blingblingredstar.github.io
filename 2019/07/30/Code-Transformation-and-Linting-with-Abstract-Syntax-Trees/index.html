<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="IntroductionWhat this talk is Introduction to Abstract Syntax Trees Introduction to inspecting and traversing ASTs with ESLint and Babel  What this talk is not Deep dive into ASTs Publishing actual pl">
<meta name="keywords" content="JavaScript,FrontEndMasters,AST,Babel,ESLint,Codemods">
<meta property="og:type" content="article">
<meta property="og:title" content="Code Transformation and Linting with Abstract Syntax Trees">
<meta property="og:url" content="http://yoursite.com/2019/07/30/Code-Transformation-and-Linting-with-Abstract-Syntax-Trees/index.html">
<meta property="og:site_name" content="刘勇的博客">
<meta property="og:description" content="IntroductionWhat this talk is Introduction to Abstract Syntax Trees Introduction to inspecting and traversing ASTs with ESLint and Babel  What this talk is not Deep dive into ASTs Publishing actual pl">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-30T13:50:54.815Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Code Transformation and Linting with Abstract Syntax Trees">
<meta name="twitter:description" content="IntroductionWhat this talk is Introduction to Abstract Syntax Trees Introduction to inspecting and traversing ASTs with ESLint and Babel  What this talk is not Deep dive into ASTs Publishing actual pl">






  <link rel="canonical" href="http://yoursite.com/2019/07/30/Code-Transformation-and-Linting-with-Abstract-Syntax-Trees/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Code Transformation and Linting with Abstract Syntax Trees | 刘勇的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘勇的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/30/Code-Transformation-and-Linting-with-Abstract-Syntax-Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘勇">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://img.zcool.cn/community/04c6fd55fa1a4a000001b19c79e625.jpg@160w_160h_1c_1e_1o_100sh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘勇的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Code Transformation and Linting with Abstract Syntax Trees

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-30 21:49:21 / 修改时间：21:50:54" itemprop="dateCreated datePublished" datetime="2019-07-30T21:49:21+08:00">2019-07-30</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="What-this-talk-is"><a href="#What-this-talk-is" class="headerlink" title="What this talk is"></a>What this talk is</h3><ul>
<li>Introduction to Abstract Syntax Trees</li>
<li>Introduction to inspecting and traversing ASTs with ESLint and Babel</li>
</ul>
<h3 id="What-this-talk-is-not"><a href="#What-this-talk-is-not" class="headerlink" title="What this talk is not"></a>What this talk is not</h3><ul>
<li>Deep dive into ASTs</li>
<li>Publishing actual plugin packages<a id="more"></a>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3></li>
</ul>
<p><a href="https://github.com/kentcdodds/asts-workshop#setup" target="_blank" rel="noopener">https://github.com/kentcdodds/asts-workshop#setup</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/kentcdodds/asts-workshop.git</span><br><span class="line"><span class="built_in">cd</span> asts-workshop</span><br><span class="line">yarn run setup --silent</span><br><span class="line">node scripts/autofill-feedback-email.js YOUR_EMAIL@DOMAIN.COM</span><br><span class="line">git commit -am <span class="string">"ready to go"</span></span><br></pre></td></tr></table></figure>
<h2 id="Abstract-Syntax-Trees"><a href="#Abstract-Syntax-Trees" class="headerlink" title="Abstract Syntax Trees"></a>Abstract Syntax Trees</h2><h3 id="Example-of-Abstract-Syntax-Trees"><a href="#Example-of-Abstract-Syntax-Trees" class="headerlink" title="Example of Abstract Syntax Trees"></a>Example of Abstract Syntax Trees</h3><p>BABEL使用了AST来转化代码。</p>
<p>例如可以使用<code>babel-plugin-lodash</code>来转化文件</p>
<p><a href="https://github.com/lodash/babel-plugin-lodash" target="_blank" rel="noopener">babel-plugin-lodash  A simple transform to cherry-pick Lodash modules so you don’t have to.</a></p>
<ul>
<li>Example<ul>
<li>Transforms</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'lodash/fp'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addOne = add(<span class="number">1</span>)</span><br><span class="line">_.map([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], addOne)</span><br></pre></td></tr></table></figure>
<ul>
<li>roughly to</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _add <span class="keyword">from</span> <span class="string">'lodash/fp/add'</span></span><br><span class="line"><span class="keyword">import</span> _map <span class="keyword">from</span> <span class="string">'lodash/map'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addOne = _add(<span class="number">1</span>)</span><br><span class="line">_map([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], addOne)</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/yannickcr/eslint-plugin-react" target="_blank" rel="noopener">eslint-plugin-react</a><br><a href="https://github.com/nodesecurity/eslint-plugin-security" target="_blank" rel="noopener">eslint-plugin-security</a><br><a href="https://www.npmjs.com/package/eslint-plugin-jsx-a11y" target="_blank" rel="noopener">eslint-plugin-jsx-a11y</a></p>
<h3 id="Introducing-Abstract-Syntax-Trees"><a href="#Introducing-Abstract-Syntax-Trees" class="headerlink" title="Introducing Abstract Syntax Trees"></a>Introducing Abstract Syntax Trees</h3><h4 id="What-Is-an-AST"><a href="#What-Is-an-AST" class="headerlink" title="What Is an AST"></a>What Is an AST</h4><p>Code for humans</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uniqueRandomArray = <span class="built_in">require</span>(<span class="string">'unique-random-array'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transformersNames = <span class="built_in">require</span>(<span class="string">'./transformers-names.json'</span>)</span><br><span class="line"><span class="keyword">const</span> getRandomItem = uniqueRandomArray(transformersNames)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  all: transformersNames,</span><br><span class="line">  random: random,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (number === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> getRandomItem()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> randomItems = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; number; i++) &#123;</span><br><span class="line">      randomItems.push(getRandomItem())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> randomItems</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Code for computers</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"type"</span>: <span class="string">"File"</span>,</span><br><span class="line">  <span class="string">"start"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"end"</span>: <span class="number">482</span>,</span><br><span class="line">  <span class="string">"loc"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: &#123;</span><br><span class="line">      <span class="string">"line"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"column"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"end"</span>: &#123;</span><br><span class="line">      <span class="string">"line"</span>: <span class="number">22</span>,</span><br><span class="line">      <span class="string">"column"</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"program"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Program"</span>,</span><br><span class="line">    <span class="string">"start"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"end"</span>: <span class="number">482</span>,</span><br><span class="line">    <span class="string">"loc"</span>: &#123;</span><br><span class="line">      <span class="string">"start"</span>: &#123;</span><br><span class="line">        <span class="string">"line"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"column"</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"end"</span>: &#123;</span><br><span class="line">        <span class="string">"line"</span>: <span class="number">22</span>,</span><br><span class="line">        <span class="string">"column"</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 等余下3000行</span></span><br></pre></td></tr></table></figure>
<h4 id="Exploring-ASTs"><a href="#Exploring-ASTs" class="headerlink" title="Exploring ASTs"></a>Exploring ASTs</h4><p><a href="http://resources.jointjs.com/demos/rappid/apps/Ast/index.html" target="_blank" rel="noopener">jointjs demo</a></p>
<p><a href="http://astexplorer.net/#/gist/da1ffc9ca82e239419fee2af19222394/latest" target="_blank" rel="noopener">astexplorer.net demo</a></p>
<h2 id="ESLint-Plugin-and-AST"><a href="#ESLint-Plugin-and-AST" class="headerlink" title="ESLint Plugin and AST"></a>ESLint Plugin and AST</h2><h3 id="Challenge-1-Making-a-Plugin"><a href="#Challenge-1-Making-a-Plugin" class="headerlink" title="Challenge 1: Making a Plugin"></a>Challenge 1: Making a Plugin</h3><p><code>npm start exercise.eslint.0</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eslint exercise 0 (no-console)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.eslint.1"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  meta: &#123;</span><br><span class="line">    docs: &#123;</span><br><span class="line">      description: <span class="string">'Disallow use of console'</span>,</span><br><span class="line">      category: <span class="string">'Best practice'</span>,</span><br><span class="line">      recommended: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// you're going to need context :)</span></span><br><span class="line">  <span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line">  create(context) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      Identifier(node) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.name !== <span class="string">'console'</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        context.report(&#123;</span><br><span class="line">          node,</span><br><span class="line">          message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-2-Adding-New-Methods"><a href="#Challenge-2-Adding-New-Methods" class="headerlink" title="Challenge 2: Adding New Methods"></a>Challenge 2: Adding New Methods</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eslint exercise 1 (no-console)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.eslint.2"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"><span class="keyword">const</span> disAllowedMethods = [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  create(context) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      Identifier(node) &#123;</span><br><span class="line">        <span class="keyword">const</span> isConsoleCall = looksLike(node, &#123;</span><br><span class="line">          name: <span class="string">'console'</span>,</span><br><span class="line">          parent: &#123;</span><br><span class="line">            type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">            parent: &#123;<span class="attr">type</span>: <span class="string">'CallExpression'</span>&#125;,</span><br><span class="line">            property: &#123;</span><br><span class="line">              name: <span class="function"><span class="params">val</span> =&gt;</span> disAllowedMethods.includes(val),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (isConsoleCall) &#123;</span><br><span class="line">          context.report(&#123;</span><br><span class="line">            node,</span><br><span class="line">            message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-3-Schema-Property"><a href="#Challenge-3-Schema-Property" class="headerlink" title="Challenge 3: Schema Property"></a>Challenge 3: Schema Property</h3><p><code>npm start exercise.eslint.2</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> disallowedMethods = [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  meta: &#123;</span><br><span class="line">    schema: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          allowedMethods: &#123;</span><br><span class="line">            type: <span class="string">'array'</span>,</span><br><span class="line">            items: &#123;</span><br><span class="line">              enum: [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            minItems: <span class="number">1</span>,</span><br><span class="line">            uniqueItems: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  create(context) &#123;</span><br><span class="line">    <span class="keyword">const</span> config = context.options[<span class="number">0</span>] || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> allowedMethods = config.allowedMethods || []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      Identifier(node) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !looksLike(node, &#123;</span><br><span class="line">            name: <span class="string">'console'</span>,</span><br><span class="line">            parent: &#123;</span><br><span class="line">              type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">              parent: &#123;<span class="attr">type</span>: <span class="string">'CallExpression'</span>&#125;,</span><br><span class="line">              property: &#123;</span><br><span class="line">                name: <span class="function"><span class="params">val</span> =&gt;</span></span><br><span class="line">                  !allowedMethods.includes(val) &amp;&amp;</span><br><span class="line">                  disallowedMethods.includes(val),</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        context.report(&#123;</span><br><span class="line">          node: node.parent.property,</span><br><span class="line">          message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-4-Edge-Cases"><a href="#Challenge-4-Edge-Cases" class="headerlink" title="Challenge 4: Edge Cases"></a>Challenge 4: Edge Cases</h3><p><code>npm start ex.es.3</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> disallowedMethods = [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  meta: &#123;</span><br><span class="line">    docs: &#123;</span><br><span class="line">      description: <span class="string">'Disallow use of console'</span>,</span><br><span class="line">      category: <span class="string">'Best Practices'</span>,</span><br><span class="line">      recommended: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    schema: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          allowedMethods: &#123;</span><br><span class="line">            type: <span class="string">'array'</span>,</span><br><span class="line">            items: &#123;</span><br><span class="line">              enum: [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            minItems: <span class="number">1</span>,</span><br><span class="line">            uniqueItems: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  create(context) &#123;</span><br><span class="line">    <span class="keyword">const</span> config = context.options[<span class="number">0</span>] || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> allowedMethods = config.allowedMethods || []</span><br><span class="line">    <span class="keyword">const</span> consoleUsage = []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      Identifier(node) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.name !== <span class="string">'console'</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        consoleUsage.push(node)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'Program:exit'</span>() &#123;</span><br><span class="line">        consoleUsage.forEach(<span class="function"><span class="params">identifier</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (isDisallowedFunctionCall(identifier)) &#123;</span><br><span class="line">            context.report(&#123;</span><br><span class="line">              node: identifier.parent.property,</span><br><span class="line">              message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> variableDeclaratorParent = findParent(</span><br><span class="line">              identifier,</span><br><span class="line">              parent =&gt; parent.type === <span class="string">'VariableDeclarator'</span>,</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> (variableDeclaratorParent) &#123;</span><br><span class="line">              <span class="keyword">const</span> references = context</span><br><span class="line">                .getDeclaredVariables(variableDeclaratorParent)[<span class="number">0</span>]</span><br><span class="line">                .references.slice(<span class="number">1</span>)</span><br><span class="line">              references.forEach(<span class="function"><span class="params">reference</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (</span><br><span class="line">                  !looksLike(reference, &#123;</span><br><span class="line">                    identifier: &#123;</span><br><span class="line">                      parent: &#123;</span><br><span class="line">                        property: isDisallowedFunctionCall,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  &#125;)</span><br><span class="line">                ) &#123;</span><br><span class="line">                  <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                context.report(&#123;</span><br><span class="line">                  node: reference.identifier.parent.property,</span><br><span class="line">                  message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isDisallowedFunctionCall</span>(<span class="params">identifier</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> looksLike(identifier, &#123;</span><br><span class="line">        parent: &#123;</span><br><span class="line">          type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">          parent: &#123;<span class="attr">type</span>: <span class="string">'CallExpression'</span>&#125;,</span><br><span class="line">          property: &#123;</span><br><span class="line">            name: <span class="function"><span class="params">val</span> =&gt;</span></span><br><span class="line">              !allowedMethods.includes(val) &amp;&amp; disallowedMethods.includes(val),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findParent</span>(<span class="params">node, test</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (test(node)) &#123;</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.parent) &#123;</span><br><span class="line">    <span class="keyword">return</span> findParent(node.parent, test)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-5-Applying-Fixes"><a href="#Challenge-5-Applying-Fixes" class="headerlink" title="Challenge 5: Applying Fixes"></a>Challenge 5: Applying Fixes</h3><p><code>npm start ex.es.4</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> disallowedMethods = [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  meta: &#123;</span><br><span class="line">    docs: &#123;</span><br><span class="line">      description: <span class="string">'Disallow use of console'</span>,</span><br><span class="line">      category: <span class="string">'Best Practices'</span>,</span><br><span class="line">      recommended: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    fixable: <span class="string">'code'</span>,</span><br><span class="line">    schema: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          allowedMethods: &#123;</span><br><span class="line">            type: <span class="string">'array'</span>,</span><br><span class="line">            items: &#123;</span><br><span class="line">              enum: [<span class="string">'log'</span>, <span class="string">'info'</span>, <span class="string">'warn'</span>, <span class="string">'error'</span>, <span class="string">'dir'</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            minItems: <span class="number">1</span>,</span><br><span class="line">            uniqueItems: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  create(context) &#123;</span><br><span class="line">    <span class="keyword">const</span> config = context.options[<span class="number">0</span>] || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> allowedMethods = config.allowedMethods || []</span><br><span class="line">    <span class="keyword">const</span> consoleUsage = []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      Identifier(node) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.name !== <span class="string">'console'</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        consoleUsage.push(node)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'Program:exit'</span>() &#123;</span><br><span class="line">        consoleUsage.forEach(checkDeniedMethodUsage)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">report</span>(<span class="params">property, consoleReference</span>) </span>&#123;</span><br><span class="line">      context.report(&#123;</span><br><span class="line">        node: property,</span><br><span class="line">        message: <span class="string">'Using console is not allowed'</span>,</span><br><span class="line">        fix(fixer) &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            consoleReference.name === <span class="string">'console'</span> &amp;&amp;</span><br><span class="line">            fixer.replaceText(consoleReference, <span class="string">'logger'</span>)</span><br><span class="line">          )</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isDisallowedFunctionCall</span>(<span class="params">identifier</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> looksLike(identifier, &#123;</span><br><span class="line">        parent: &#123;</span><br><span class="line">          type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">          parent: &#123;<span class="attr">type</span>: <span class="string">'CallExpression'</span>&#125;,</span><br><span class="line">          property: &#123;</span><br><span class="line">            name: <span class="function"><span class="params">val</span> =&gt;</span></span><br><span class="line">              !allowedMethods.includes(val) &amp;&amp; disallowedMethods.includes(val),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkDeniedMethodUsage</span>(<span class="params">identifier</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (isDisallowedFunctionCall(identifier)) &#123;</span><br><span class="line">        report(identifier.parent.property, identifier)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> variableDeclaratorParent = findParent(</span><br><span class="line">          identifier,</span><br><span class="line">          parent =&gt; parent.type === <span class="string">'VariableDeclarator'</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> (variableDeclaratorParent) &#123;</span><br><span class="line">          <span class="keyword">const</span> references = context</span><br><span class="line">            .getDeclaredVariables(variableDeclaratorParent)[<span class="number">0</span>]</span><br><span class="line">            .references.slice(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">          references.forEach(<span class="function"><span class="params">reference</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">              findParent(</span><br><span class="line">                reference.identifier,</span><br><span class="line">                parent =&gt; parent.type === <span class="string">'VariableDeclarator'</span>,</span><br><span class="line">              )</span><br><span class="line">            ) &#123;</span><br><span class="line">              checkDeniedMethodUsage(reference.identifier)</span><br><span class="line"></span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">              !looksLike(reference, &#123;</span><br><span class="line">                identifier: &#123;</span><br><span class="line">                  parent: &#123;</span><br><span class="line">                    property: isDisallowedFunctionCall,</span><br><span class="line">                  &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;)</span><br><span class="line">            ) &#123;</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            report(reference.identifier.parent.property, identifier)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findParent</span>(<span class="params">node, test</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (test(node)) &#123;</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.parent) &#123;</span><br><span class="line">    <span class="keyword">return</span> findParent(node.parent, test)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Babel-Plugin-amp-AST"><a href="#Babel-Plugin-amp-AST" class="headerlink" title="Babel Plugin &amp; AST"></a>Babel Plugin &amp; AST</h2><h3 id="Introducing-Babel-amp-AST"><a href="#Introducing-Babel-amp-AST" class="headerlink" title="Introducing Babel &amp; AST"></a>Introducing Babel &amp; AST</h3><p><a href="https://astexplorer.net/#/gist/9fbfbf53b7d03a616321f4b53b5d52b0/latest" target="_blank" rel="noopener">Babel Plugin</a></p>
<h3 id="Challenge-6-Captains-Log"><a href="#Challenge-6-Captains-Log" class="headerlink" title="Challenge 6: Captains Log"></a>Challenge 6: Captains Log</h3><p><code>npm start ex.ba.0</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel exercise 0 (captains-log)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.babel.1"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint no-unused-vars:0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// I'm leavning this here for you because it's handy :)</span></span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">types</span>: t&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'captains-log'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path) &#123;</span><br><span class="line">        <span class="keyword">const</span> isConsoleCall = looksLike(path, &#123;</span><br><span class="line">          node: &#123;</span><br><span class="line">            callee: &#123;</span><br><span class="line">              type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">              object: &#123;</span><br><span class="line">                name: <span class="string">'console'</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!isConsoleCall) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> start = path.node.loc.start</span><br><span class="line">        path.node.arguments.unshift(</span><br><span class="line">          t.stringLiteral(<span class="string">`<span class="subst">$&#123;start.line&#125;</span>:<span class="subst">$&#123;start.column&#125;</span>`</span>),</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-7-Prefixing"><a href="#Challenge-7-Prefixing" class="headerlink" title="Challenge 7: Prefixing"></a>Challenge 7: Prefixing</h3><p><code>npm start ex.ba.1</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel exercise 1 (captains-log)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.babel.2"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">types</span>: t&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'captains-log'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !looksLike(path, &#123;</span><br><span class="line">            node: &#123;</span><br><span class="line">              callee: &#123;</span><br><span class="line">                type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">                object: &#123;</span><br><span class="line">                  name: <span class="string">'console'</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> parentFunction = path.findParent(t.isFunctionDeclaration)</span><br><span class="line">        <span class="keyword">const</span> start = path.node.loc.start</span><br><span class="line">        <span class="keyword">let</span> prefix = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> (parentFunction) &#123;</span><br><span class="line">          prefix += <span class="string">`<span class="subst">$&#123;parentFunction.node.id.name&#125;</span> `</span></span><br><span class="line">        &#125;</span><br><span class="line">        prefix += <span class="string">`<span class="subst">$&#123;start.line&#125;</span>:<span class="subst">$&#123;start.column&#125;</span>`</span></span><br><span class="line">        path.node.arguments.unshift(t.stringLiteral(prefix))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-8-Arrow-Function"><a href="#Challenge-8-Arrow-Function" class="headerlink" title="Challenge 8: Arrow Function"></a>Challenge 8: Arrow Function</h3><p><code>npm start ex.ba.2</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel exercise 2 (captains-log)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.babel.3"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">types</span>: t&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'captains-log'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !looksLike(path, &#123;</span><br><span class="line">            node: &#123;</span><br><span class="line">              callee: &#123;</span><br><span class="line">                type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">                object: &#123;</span><br><span class="line">                  name: <span class="string">'console'</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> prefix = <span class="string">''</span></span><br><span class="line">        <span class="keyword">const</span> parentFunctionName = getFunctionName(path)</span><br><span class="line">        <span class="keyword">if</span> (parentFunctionName) &#123;</span><br><span class="line">          prefix += parentFunctionName</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> start = path.node.loc.start</span><br><span class="line">        prefix += <span class="string">` <span class="subst">$&#123;start.line&#125;</span>:<span class="subst">$&#123;start.column&#125;</span>`</span></span><br><span class="line">        path.node.arguments.unshift(t.stringLiteral(prefix.trim()))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFunctionName</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> parentFunction = path.findParent(</span><br><span class="line">    parent =&gt;</span><br><span class="line">      parent.isFunctionDeclaration() || parent.isArrowFunctionExpression(),</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (parentFunction) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      parentFunction.isArrowFunctionExpression() &amp;&amp;</span><br><span class="line">      parentFunction.parentPath.isVariableDeclarator()</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> parentFunction.parent.id.name</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> parentFunction.node.id.name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-9-Divide-Function"><a href="#Challenge-9-Divide-Function" class="headerlink" title="Challenge 9: Divide Function"></a>Challenge 9: Divide Function</h3><p><code>npm start ex.ba.3</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel exercise 3 (captains-log)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.babel.4"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">types</span>: t&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'captains-log'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !looksLike(path, &#123;</span><br><span class="line">            node: &#123;</span><br><span class="line">              callee: &#123;</span><br><span class="line">                type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">                object: &#123;</span><br><span class="line">                  name: <span class="string">'console'</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> prefix = <span class="string">''</span></span><br><span class="line">        <span class="keyword">const</span> functionName = getFunctionName(path)</span><br><span class="line">        <span class="keyword">if</span> (functionName) &#123;</span><br><span class="line">          prefix += functionName</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> start = path.node.loc.start</span><br><span class="line">        prefix += <span class="string">` <span class="subst">$&#123;start.line&#125;</span>:<span class="subst">$&#123;start.column&#125;</span>`</span></span><br><span class="line">        path.node.arguments.unshift(t.stringLiteral(prefix.trim()))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getFunctionName</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> parentFunction = path.findParent(<span class="function"><span class="params">parent</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        t.isFunctionDeclaration(parent) ||</span><br><span class="line">        t.isArrowFunctionExpression(parent) ||</span><br><span class="line">        t.isFunctionExpression(parent)</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (!parentFunction) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (looksLike(parentFunction, &#123;<span class="attr">node</span>: &#123;<span class="attr">id</span>: t.isIdentifier&#125;&#125;)) &#123;</span><br><span class="line">      <span class="keyword">return</span> parentFunction.node.id.name</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t.isVariableDeclarator(parentFunction.parent)) &#123;</span><br><span class="line">      <span class="keyword">return</span> parentFunction.parent.id.name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Codemods-amp-AST"><a href="#Codemods-amp-AST" class="headerlink" title="Codemods &amp; AST"></a>Codemods &amp; AST</h2><h3 id="Introducing-Codemods-and-AST"><a href="#Introducing-Codemods-and-AST" class="headerlink" title="Introducing Codemods and AST"></a>Introducing Codemods and AST</h3><p><a href="https://astexplorer.net/#/gist/e8ff56e9255ea78988194a79659a3b56/latest" target="_blank" rel="noopener">demo</a></p>
<h3 id="Challenge-10-Upgrade-Patterns"><a href="#Challenge-10-Upgrade-Patterns" class="headerlink" title="Challenge 10: Upgrade Patterns"></a>Challenge 10: Upgrade Patterns</h3><p><code>npm start exercise.codemod.0</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// codemod exercise 0 (ymnn-jquery)</span></span><br><span class="line"><span class="comment">// When you're finished with this exercise, run</span></span><br><span class="line"><span class="comment">//   "npm start exercise.codemod.1"</span></span><br><span class="line"><span class="comment">//   to move on to the next exercise</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint no-unused-vars:0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// I'm leavning this here for you because it's handy :)</span></span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">types</span>: t, template&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'ymnn-jquery'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path) &#123;</span><br><span class="line">        <span class="keyword">const</span> isJqueryCallExpression = looksLike(path, &#123;</span><br><span class="line">          node: &#123;</span><br><span class="line">            callee: &#123;</span><br><span class="line">              name: <span class="string">'$'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          parent: &#123;</span><br><span class="line">            type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">            property: &#123;</span><br><span class="line">              name: <span class="string">'hide'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!isJqueryCallExpression) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> overallPath = path.parentPath.parentPath</span><br><span class="line">        <span class="keyword">const</span> templateString = <span class="string">`EL.style.display = 'none'`</span></span><br><span class="line">        <span class="keyword">const</span> assignmentBuilder = template(templateString)</span><br><span class="line">        <span class="keyword">const</span> assignment = assignmentBuilder(&#123;</span><br><span class="line">          EL: t.identifier(path.node.arguments[<span class="number">0</span>].name),</span><br><span class="line">        &#125;)</span><br><span class="line">        overallPath.replaceWith(assignment)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-11-Swap-Out-Utillties"><a href="#Challenge-11-Swap-Out-Utillties" class="headerlink" title="Challenge 11: Swap Out Utillties"></a>Challenge 11: Swap Out Utillties</h3><p><code>npm start exercise.codemod.3</code></p>
<p><code>npm start</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">babel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;template, <span class="attr">types</span>: t&#125; = babel</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'ymnn-jquery'</span>,</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      Program: &#123;</span><br><span class="line">        enter(path, &#123;file&#125;) &#123;</span><br><span class="line">          file.set(<span class="string">'assignedJQueryEls'</span>, <span class="keyword">new</span> <span class="built_in">Set</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        exit(path, &#123;file&#125;) &#123;</span><br><span class="line">          <span class="keyword">const</span> jQueryElVariableDeclarators = file.get(<span class="string">'assignedJQueryEls'</span>)</span><br><span class="line">          <span class="built_in">Array</span>.from(jQueryElVariableDeclarators).forEach(</span><br><span class="line">            assignedCallExpression =&gt; &#123;</span><br><span class="line">              <span class="keyword">const</span> declaratorPath = assignedCallExpression.parentPath</span><br><span class="line">              <span class="keyword">const</span> binding = declaratorPath.scope.getBinding(</span><br><span class="line">                declaratorPath.node.id.name,</span><br><span class="line">              )</span><br><span class="line">              binding.referencePaths.forEach(<span class="function"><span class="params">referencePath</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (</span><br><span class="line">                  looksLike(referencePath, &#123;</span><br><span class="line">                    parentPath: &#123;</span><br><span class="line">                      type: <span class="string">'MemberExpression'</span>,</span><br><span class="line">                      parentPath: &#123;</span><br><span class="line">                        type: <span class="string">'CallExpression'</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  &#125;)</span><br><span class="line">                ) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (</span><br><span class="line">                    !isSupportedJQueryFunctionCall(referencePath.parentPath)</span><br><span class="line">                  ) &#123;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">const</span> [el] = assignedCallExpression.node.arguments</span><br><span class="line">                  handleSupportedJQueryFunctionCall(</span><br><span class="line">                    el,</span><br><span class="line">                    referencePath.parent.property.name,</span><br><span class="line">                    referencePath.parentPath.parentPath,</span><br><span class="line">                  )</span><br><span class="line">                  declaratorPath.remove()</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">          )</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      CallExpression(path, &#123;file&#125;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !looksLike(path, &#123;</span><br><span class="line">            node: &#123;</span><br><span class="line">              callee: &#123;<span class="attr">name</span>: <span class="string">'$'</span>&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!isSupportedJQueryFunctionCall(path.parentPath)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (t.isVariableDeclarator(path.parentPath)) &#123;</span><br><span class="line">            file.get(<span class="string">'assignedJQueryEls'</span>).add(path)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> jqueryFunction = path.parentPath.node.property.name</span><br><span class="line">        <span class="keyword">const</span> pathToReplace = path.parentPath.parentPath</span><br><span class="line">        <span class="keyword">const</span> [el] = path.node.arguments</span><br><span class="line">        handleSupportedJQueryFunctionCall(el, jqueryFunction, pathToReplace)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSupportedJQueryFunctionCall</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    el,</span></span></span><br><span class="line"><span class="function"><span class="params">    jqueryFunction,</span></span></span><br><span class="line"><span class="function"><span class="params">    pathToReplace,</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (jqueryFunction === <span class="string">'addClass'</span>) &#123;</span><br><span class="line">      updateAddClass(el, pathToReplace)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      updateDisplay(el, pathToReplace, jqueryFunction)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateDisplay</span>(<span class="params">el, pathToReplace, jqueryFunction</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> templateString = <span class="string">`ELEMENT.style.display = DISPLAY;`</span></span><br><span class="line">    <span class="keyword">const</span> assignment = template(templateString)(&#123;</span><br><span class="line">      ELEMENT: el,</span><br><span class="line">      DISPLAY: t.stringLiteral(jqueryFunction === <span class="string">'show'</span> ? <span class="string">''</span> : <span class="string">'none'</span>),</span><br><span class="line">    &#125;)</span><br><span class="line">    pathToReplace.replaceWith(assignment)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateAddClass</span>(<span class="params">el, pathToReplace</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> templateString = <span class="string">`ELEMENT.classList.add(CLASS_NAME);`</span></span><br><span class="line">    <span class="keyword">const</span> assignment = template(templateString)(&#123;</span><br><span class="line">      ELEMENT: el,</span><br><span class="line">      CLASS_NAME: pathToReplace.node.arguments,</span><br><span class="line">    &#125;)</span><br><span class="line">    pathToReplace.replaceWith(assignment)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSupportedJQueryFunctionCall</span>(<span class="params">memberExpression</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> looksLike(memberExpression, &#123;</span><br><span class="line">    key: <span class="string">'callee'</span>,</span><br><span class="line">    node: &#123;</span><br><span class="line">      property: &#123;</span><br><span class="line">        name: <span class="function"><span class="params">val</span> =&gt;</span> [<span class="string">'hide'</span>, <span class="string">'show'</span>, <span class="string">'addClass'</span>].includes(val),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looksLike</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a &amp;&amp;</span><br><span class="line">    b &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.keys(b).every(<span class="function"><span class="params">bKey</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> bVal = b[bKey]</span><br><span class="line">      <span class="keyword">const</span> aVal = a[bKey]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> bVal === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bVal(aVal)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrimitive</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span> || <span class="regexp">/^[sbn]/</span>.test(<span class="keyword">typeof</span> val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/FrontEndMasters/" rel="tag"># FrontEndMasters</a>
          
            <a href="/tags/AST/" rel="tag"># AST</a>
          
            <a href="/tags/Babel/" rel="tag"># Babel</a>
          
            <a href="/tags/ESLint/" rel="tag"># ESLint</a>
          
            <a href="/tags/Codemods/" rel="tag"># Codemods</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/25/JavaScript-Performance/" rel="next" title="JavaScript Performance">
                <i class="fa fa-chevron-left"></i> JavaScript Performance
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/05/TypeScript-3-Fundamentals-v2/" rel="prev" title="TypeScript 3 Fundamentals v2">
                TypeScript 3 Fundamentals v2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://img.zcool.cn/community/04c6fd55fa1a4a000001b19c79e625.jpg@160w_160h_1c_1e_1o_100sh.jpg" alt="刘勇">
            
              <p class="site-author-name" itemprop="name">刘勇</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">63</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">111</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/blingblingredstar" title="GitHub &rarr; https://github.com/blingblingredstar" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:564447023@qq.com" title="E-Mail &rarr; mailto:564447023@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-this-talk-is"><span class="nav-number">1.1.</span> <span class="nav-text">What this talk is</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-this-talk-is-not"><span class="nav-number">1.2.</span> <span class="nav-text">What this talk is not</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Setup"><span class="nav-number">1.3.</span> <span class="nav-text">Setup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Abstract-Syntax-Trees"><span class="nav-number">2.</span> <span class="nav-text">Abstract Syntax Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-of-Abstract-Syntax-Trees"><span class="nav-number">2.1.</span> <span class="nav-text">Example of Abstract Syntax Trees</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Introducing-Abstract-Syntax-Trees"><span class="nav-number">2.2.</span> <span class="nav-text">Introducing Abstract Syntax Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#What-Is-an-AST"><span class="nav-number">2.2.1.</span> <span class="nav-text">What Is an AST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exploring-ASTs"><span class="nav-number">2.2.2.</span> <span class="nav-text">Exploring ASTs</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ESLint-Plugin-and-AST"><span class="nav-number">3.</span> <span class="nav-text">ESLint Plugin and AST</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-1-Making-a-Plugin"><span class="nav-number">3.1.</span> <span class="nav-text">Challenge 1: Making a Plugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-2-Adding-New-Methods"><span class="nav-number">3.2.</span> <span class="nav-text">Challenge 2: Adding New Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-3-Schema-Property"><span class="nav-number">3.3.</span> <span class="nav-text">Challenge 3: Schema Property</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-4-Edge-Cases"><span class="nav-number">3.4.</span> <span class="nav-text">Challenge 4: Edge Cases</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-5-Applying-Fixes"><span class="nav-number">3.5.</span> <span class="nav-text">Challenge 5: Applying Fixes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Babel-Plugin-amp-AST"><span class="nav-number">4.</span> <span class="nav-text">Babel Plugin &amp; AST</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introducing-Babel-amp-AST"><span class="nav-number">4.1.</span> <span class="nav-text">Introducing Babel &amp; AST</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-6-Captains-Log"><span class="nav-number">4.2.</span> <span class="nav-text">Challenge 6: Captains Log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-7-Prefixing"><span class="nav-number">4.3.</span> <span class="nav-text">Challenge 7: Prefixing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-8-Arrow-Function"><span class="nav-number">4.4.</span> <span class="nav-text">Challenge 8: Arrow Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-9-Divide-Function"><span class="nav-number">4.5.</span> <span class="nav-text">Challenge 9: Divide Function</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Codemods-amp-AST"><span class="nav-number">5.</span> <span class="nav-text">Codemods &amp; AST</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introducing-Codemods-and-AST"><span class="nav-number">5.1.</span> <span class="nav-text">Introducing Codemods and AST</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-10-Upgrade-Patterns"><span class="nav-number">5.2.</span> <span class="nav-text">Challenge 10: Upgrade Patterns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Challenge-11-Swap-Out-Utillties"><span class="nav-number">5.3.</span> <span class="nav-text">Challenge 11: Swap Out Utillties</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘勇</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
