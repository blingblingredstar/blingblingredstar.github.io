<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Introductionnote clone the repo Course Repository Tourcd .&#x2F;complete-intro-to-react-v5&#x2F; npm install npm run dev">
<meta property="og:type" content="article">
<meta property="og:title" content="Intermediate React v2">
<meta property="og:url" content="http://yoursite.com/2019/08/08/Intermediate-React-v2/index.html">
<meta property="og:site_name" content="刘勇的博客">
<meta property="og:description" content="Introductionnote clone the repo Course Repository Tourcd .&#x2F;complete-intro-to-react-v5&#x2F; npm install npm run dev">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-08-08T08:46:08.000Z">
<meta property="article:modified_time" content="2023-05-17T14:12:23.324Z">
<meta property="article:author" content="刘勇">
<meta property="article:tag" content="FrontEndMasters">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Jest">
<meta property="article:tag" content="TypeScript">
<meta property="article:tag" content="Hooks">
<meta property="article:tag" content="Redux">
<meta property="article:tag" content="SSR">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yoursite.com/2019/08/08/Intermediate-React-v2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yoursite.com/2019/08/08/Intermediate-React-v2/","path":"2019/08/08/Intermediate-React-v2/","title":"Intermediate React v2"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Intermediate React v2 | 刘勇的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">刘勇的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Course-Repository-Tour"><span class="nav-number">1.1.</span> <span class="nav-text">Course Repository Tour</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-Hooks"><span class="nav-number">2.</span> <span class="nav-text">Basic Hooks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#useState"><span class="nav-number">2.1.</span> <span class="nav-text">useState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useEffect"><span class="nav-number">2.2.</span> <span class="nav-text">useEffect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useContext"><span class="nav-number">2.3.</span> <span class="nav-text">useContext</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hooks-in-Depth"><span class="nav-number">3.</span> <span class="nav-text">Hooks in-Depth</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#useRef"><span class="nav-number">3.1.</span> <span class="nav-text">useRef</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useReducer"><span class="nav-number">3.2.</span> <span class="nav-text">useReducer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useMemo"><span class="nav-number">3.3.</span> <span class="nav-text">useMemo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useCallback"><span class="nav-number">3.4.</span> <span class="nav-text">useCallback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useLayoutEffect"><span class="nav-number">3.5.</span> <span class="nav-text">useLayoutEffect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useImperativeHandle"><span class="nav-number">3.6.</span> <span class="nav-text">useImperativeHandle</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSS-in-JS"><span class="nav-number">4.</span> <span class="nav-text">CSS in JS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Emotion-Setup-amp-Nav-Bar"><span class="nav-number">4.1.</span> <span class="nav-text">Emotion Setup &amp; Nav Bar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Template-Literals-amp-Hooks"><span class="nav-number">4.2.</span> <span class="nav-text">Template Literals &amp; Hooks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Design-Systems-amp-Compound-Selectors"><span class="nav-number">4.3.</span> <span class="nav-text">Design Systems &amp; Compound Selectors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Animations"><span class="nav-number">4.4.</span> <span class="nav-text">Animations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-Splitting"><span class="nav-number">5.</span> <span class="nav-text">Code Splitting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Code-Splitting-Libraries-amp-Child-Components"><span class="nav-number">5.1.</span> <span class="nav-text">Code Splitting Libraries &amp; Child Components</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sever-Side-Rendering"><span class="nav-number">6.</span> <span class="nav-text">Sever Side Rendering</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSR-Rationale-amp-Initial-Setup"><span class="nav-number">6.1.</span> <span class="nav-text">SSR Rationale &amp; Initial Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Side-Rendering-to-Strings"><span class="nav-number">6.2.</span> <span class="nav-text">Server Side Rendering to Strings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Side-Rendering-to-Node-Stream"><span class="nav-number">6.3.</span> <span class="nav-text">Server Side Rendering to Node Stream</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TypeScript-with-React"><span class="nav-number">7.</span> <span class="nav-text">TypeScript with React</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TypeScript-Introduction"><span class="nav-number">7.1.</span> <span class="nav-text">TypeScript Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TypeScript-Configuration-for-React"><span class="nav-number">7.2.</span> <span class="nav-text">TypeScript Configuration for React</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Typing-the-Modal-Component"><span class="nav-number">7.3.</span> <span class="nav-text">Typing the Modal Component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Migrating-to-TSLint"><span class="nav-number">7.4.</span> <span class="nav-text">Migrating to TSLint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Typing-Context"><span class="nav-number">7.5.</span> <span class="nav-text">Typing Context</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Typing-a-Class-Component"><span class="nav-number">7.6.</span> <span class="nav-text">Typing a Class Component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Typing-an-Error-Bundary"><span class="nav-number">7.7.</span> <span class="nav-text">Typing an Error Bundary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Props-amp-State-Interface"><span class="nav-number">7.8.</span> <span class="nav-text">Props &amp; State Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Heterogenous-Arrays-amp-Hooks"><span class="nav-number">7.9.</span> <span class="nav-text">Heterogenous Arrays &amp; Hooks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TypeScript-Review-and-Q-amp-A"><span class="nav-number">7.10.</span> <span class="nav-text">TypeScript Review and Q&amp;A</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux"><span class="nav-number">8.</span> <span class="nav-text">Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-Introduction"><span class="nav-number">8.1.</span> <span class="nav-text">Redux Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Store"><span class="nav-number">8.2.</span> <span class="nav-text">Creating a Store</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Reducer"><span class="nav-number">8.3.</span> <span class="nav-text">Creating a Reducer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Actions"><span class="nav-number">8.4.</span> <span class="nav-text">Creating Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Connecting-Redux-to-the-Application"><span class="nav-number">8.5.</span> <span class="nav-text">Connecting Redux to the Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-Devtools"><span class="nav-number">8.6.</span> <span class="nav-text">Redux Devtools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Completing-the-Redux-Writing"><span class="nav-number">8.7.</span> <span class="nav-text">Completing the Redux Writing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Testing-React"><span class="nav-number">9.</span> <span class="nav-text">Testing React</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Jest-amp-React-Testing-Library"><span class="nav-number">9.1.</span> <span class="nav-text">Jest &amp; React Testing Library</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-Mocks"><span class="nav-number">9.2.</span> <span class="nav-text">API Mocks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Component-Tests"><span class="nav-number">9.3.</span> <span class="nav-text">Component Tests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Snapshots-Watch-Mode-amp-Test-Coverage"><span class="nav-number">9.4.</span> <span class="nav-text">Snapshots, Watch Mode &amp; Test Coverage</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘勇"
      src="https://avatars.githubusercontent.com/u/43870278?s=400&u=7e0e1bf1f3550a08fa79cb6368718793280eb5eb&v=4">
  <p class="site-author-name" itemprop="name">刘勇</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">149</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blingblingredstar" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blingblingredstar" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:564447023@qq.com" title="E-Mail → mailto:564447023@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/08/Intermediate-React-v2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/43870278?s=400&u=7e0e1bf1f3550a08fa79cb6368718793280eb5eb&v=4">
      <meta itemprop="name" content="刘勇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘勇的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Intermediate React v2 | 刘勇的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Intermediate React v2
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-08 16:46:08" itemprop="dateCreated datePublished" datetime="2019-08-08T16:46:08+08:00">2019-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-17 22:12:23" itemprop="dateModified" datetime="2023-05-17T22:12:23+08:00">2023-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><a target="_blank" rel="noopener" href="https://btholt.github.io/complete-intro-to-react-v5/">note</a></p>
<p>clone the <a target="_blank" rel="noopener" href="https://github.com/btholt/complete-intro-to-react-v5">repo</a></p>
<h3 id="Course-Repository-Tour"><a href="#Course-Repository-Tour" class="headerlink" title="Course Repository Tour"></a>Course Repository Tour</h3><p><code>cd ./complete-intro-to-react-v5/</code></p>
<p><code>npm install</code></p>
<p><code>npm run dev</code></p>
<span id="more"></span>
<h2 id="Basic-Hooks"><a href="#Basic-Hooks" class="headerlink" title="Basic Hooks"></a>Basic Hooks</h2><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><p><a target="_blank" rel="noopener" href="https://btholt.github.io/complete-intro-to-react-v5/hooks-in-depth/">hooks in depth</a></p>
<p>Here’s a link to this <a target="_blank" rel="noopener" href="https://codesandbox.io/s/zr90v4jorp">Codesandbox</a></p>
<!-- markdownlint-disable md033 -->

<p><code>useState</code> allows us to make our components stateful. Whereas this previously required using a class component, hooks give us the ability to write it using just functions. It allows us to have more flexible components. In our example component, everytime you click on the h1 (bad a11y, by the way) it’ll change colors. It’s doing this by keeping that bit of state in a hook which is being fed in a new every render so it always has the latest state.</p>
<details>
<summary>State.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">StateComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [isGreen, setIsGreen] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setIsGreen(!isGreen)&#125;</span></span><br><span class="line"><span class="language-xml">      style=&#123;&#123; color: isGreen ? &quot;limegreen&quot; : &quot;crimson&quot; &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      useState Example</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">StateComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p>Effects are how you recreate <code>componentDidMount</code>, <code>componentDidUpdate</code>, and <code>componentDidUnmount</code> from React. Inside <code>useEffect</code>, you can do any sort of sidd-effect type action that you would have previously done in one of React’s lifecycle method. You can do things like fire AJAX requests, integrate with third party libraries (like a jQuery plugin), fire off some telemetry, or anything else that need to happen on the side for your component.</p>
<p>In our case, we want our component to continually update to show the time so we use <code>setTimeout</code> inside our effect. After the timeout calls the callback, it updates the state. After that render happens, it schedules another effect to happen, hence why it continues to update. You could provide a second parameter of [] to <code>useEffect</code> (after the function) which would make it only update once. This second array is a list of dependencies: only re-run this effect if one of these parameters changed. In our case, we want to run after every render so we don’t give it this second parameter.</p>
<details>
<summary>Effect.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">EffectComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [time, setTime] = <span class="title function_">useState</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="title function_">setTime</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>useEffect Example: &#123;time.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">EffectComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><p>An early problem with the React problem is called “data tunneling” or “prop drilling”. This is when you have a top level component (in our case the parent component) and a child component way down in the hierarchy that need the same data (like the user object.) We could pass that data down, parent-to-child, for each of the intermediary components but that sucks because now each of LevelTwo, LevelThree, and LevelFour all have to know about the user object even when they themselves don’t need it, just their children. This is prop drilling: passing down this data in unnecessary intermediaries.</p>
<p>Enter context. Context allows you to create a wormhole where stuff goes in and a wormhole in a child component where that same data comes out and the stuff in the middle doesn’t know it’s there. Now that data is available anywhere inside of the UserContext.Provider. useContext just pulls that data out when given a Context object as a parameter. You don’t have to use useState and useContext together (the data can be any shape, not just useState-shaped) but I find it convenient when child components need to be able to update the context as well.</p>
<p>In general, context adds a decent amount of complexity to an app. A bit of prop drilling is fine. Only put things in context that are truly application-wide state like user information or auth keys and then use local state for the rest.</p>
<p>Often you’ll use context instead of Redux or another state store. You could get fancy and use useReducer and useContext together to get a pretty great approximation of Redux-like features.</p>
<details>
<summary>Context.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useContext, createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserContext</span> = <span class="title function_">createContext</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&quot;Bob&quot;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&quot;Bobberson&quot;</span>,</span><br><span class="line">    <span class="attr">suffix</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&quot;bobbobberson@example.com&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">obj</span> =&gt;</span> obj</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LevelFive</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = <span class="title function_">useContext</span>(<span class="title class_">UserContext</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h5</span>&gt;</span>&#123;`$&#123;user.firstName&#125; $&#123;user.lastName&#125; the $&#123;user.suffix&#125; born`&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setUser(Object.assign(&#123;&#125;, user, &#123; suffix: user.suffix + 1 &#125;));</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Increment</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LevelFour</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>fourth level<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LevelFive</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LevelThree</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>third level<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LevelFour</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LevelTwo</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>second level<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LevelThree</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ContextComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> userState = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&quot;James&quot;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&quot;Jameson&quot;</span>,</span><br><span class="line">    <span class="attr">suffix</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&quot;jamesjameson@example.com&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">UserContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;userState&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>first level<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LevelTwo</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">UserContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ContextComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h2 id="Hooks-in-Depth"><a href="#Hooks-in-Depth" class="headerlink" title="Hooks in-Depth"></a>Hooks in-Depth</h2><h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>Refs are useful for several things, we’ll explore two of the main reasons in these examples. I want to show you the first use case: how to emulate instance variables from React.</p>
<p>In order to understand why refs are useful, you need to understand how closures work. In our component, when a user clicks, it sets a timeout to log both the state and the ref’s number after a second. One thing to keep in mind that the state and the ref’s number are always the same. They are never out of lockstep since they’re updated at the same time. However, since we delay the logging for a second, when it alerts the new values, it will capture what the state was when we first called the timeout (since it’s held on to by the closure) but it will always log the current value since that ref is on an object that React consistently gives the same object back to you. Because it’s the same object and the number is a property on the object, it will always be up to date and not subject to the closure’s scope.</p>
<p>Why is this useful? It can be useful for things like holding on to setInterval and setTimeout IDs so they can be cleared later. Or any bit of statefulness that could change but you don’t want it to cause a re-render when it does.</p>
<p>It’s also useful for referencing DOM nodes directly and we’ll see that a bit later in this section.</p>
<details>
<summary>Ref.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">RefComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [stateNumber, setStateNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> numRef = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">incrementAndDelayLogging</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setStateNumber</span>(stateNumber + <span class="number">1</span>);</span><br><span class="line">    numRef.<span class="property">current</span>++;</span><br><span class="line">    <span class="built_in">setTimeout</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">`state: <span class="subst">$&#123;stateNumber&#125;</span> | ref: <span class="subst">$&#123;numRef.current&#125;</span>`</span>),</span><br><span class="line">      <span class="number">1000</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>useRef Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;incrementAndDelayLogging&#125;</span>&gt;</span>delay logging<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>state: &#123;stateNumber&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ref: &#123;numRef.current&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RefComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><p>I’m going to assume you’re familiar with Redux. If not, there’s a brief section on it <a target="_blank" rel="noopener" href="https://btholt.github.io/complete-intro-to-react-v5/redux">here</a>. useReducer allows us to do Redux-style reducers but inside a hook. Here, instead of having a bunch of functions to update our various properties, we have one reducer that handles all the updates based on an action type. This is a preferable approach if you have complex state updates or if you have a situation like this: all of the state updates are very similar so it makes sense to contain all of them in one function.</p>
<details>
<summary>Reducer.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fancy logic to make sure the number is between 0 and 255</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">limitRGB</span> = num =&gt; (num &lt; <span class="number">0</span> ? <span class="number">0</span> : num &gt; <span class="number">255</span> ? <span class="number">255</span> : num);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> step = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;INCREMENT_R&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">r</span>: <span class="title function_">limitRGB</span>(state.<span class="property">r</span> + step) &#125;);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREMENT_R&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">r</span>: <span class="title function_">limitRGB</span>(state.<span class="property">r</span> - step) &#125;);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;INCREMENT_G&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">g</span>: <span class="title function_">limitRGB</span>(state.<span class="property">g</span> + step) &#125;);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREMENT_G&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">g</span>: <span class="title function_">limitRGB</span>(state.<span class="property">g</span> - step) &#125;);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;INCREMENT_B&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">b</span>: <span class="title function_">limitRGB</span>(state.<span class="property">b</span> + step) &#125;);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREMENT_B&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123; <span class="attr">b</span>: <span class="title function_">limitRGB</span>(state.<span class="property">b</span> - step) &#125;);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ReducerComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [&#123; r, g, b &#125;, dispatch] = <span class="title function_">useReducer</span>(reducer, &#123; <span class="attr">r</span>: <span class="number">0</span>, <span class="attr">g</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> `<span class="attr">rgb</span>($&#123;<span class="attr">r</span>&#125;, $&#123;<span class="attr">g</span>&#125;, $&#123;<span class="attr">b</span>&#125;)` &#125;&#125;&gt;</span>useReducer Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>r<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;INCREMENT_R&quot; &#125;)&#125;&gt;➕<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;DECREMENT_R&quot; &#125;)&#125;&gt;➖<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>g<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;INCREMENT_G&quot; &#125;)&#125;&gt;➕<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;DECREMENT_G&quot; &#125;)&#125;&gt;➖<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>b<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;INCREMENT_B&quot; &#125;)&#125;&gt;➕<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;DECREMENT_B&quot; &#125;)&#125;&gt;➖<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReducerComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><p><code>useMemo</code> and <code>useCallback</code> are performance optimizations. Use them only when you already have a performance problem instead of pre-emptively. It adds unnecessary complexity otherwise.</p>
<p><code>useMemo</code> memoizes expensive function calls so they only are re-evaluated when needed. I put in the fibonacci sequence in its recursive style to simulate this. All you need to know is that once you’re calling <code>fibonacci</code> with 30+ it gets quite computationally expensive and not something you want to do unnecessarily as it will cause pauses and jank. It will now only call <code>fibonacci</code> if count changes and will just the previous, memoized answer if it hasn’t changed.</p>
<p>If we didn’t have the <code>useMemo</code> call, everytime I clicked on the title to cause the color to change from red to green or vice versa it’d unnecessarily recalculate the answer of <code>fibonacci</code> but because we did use <code>useMemo</code> it will only calculate it when num has changed.</p>
<p>Feel try to remove <code>useMemo</code>, get num to 40 or so, and then click the h1. It’ll be slow.</p>
<details>
<summary>Memo.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fibonacci</span> = n =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MemoComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [num, setNum] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> [isGreen, setIsGreen] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> fib = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">fibonacci</span>(num), [num]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setIsGreen(!isGreen)&#125;</span></span><br><span class="line"><span class="language-xml">        style=&#123;&#123; color: isGreen ? &quot;limegreen&quot; : &quot;crimson&quot; &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        useMemo Example</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Fibonacci of &#123;num&#125; is &#123;fib&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setNum(num + 1)&#125;&gt;➕<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MemoComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><p><code>useCallback</code> is quite similar and indeed it’s implemented with the same mechanisms as <code>useMemo</code>. Our goal is that <code>ExpensiveComputationComponent</code> only re-renders whenever it absolutely must. Typically whenever React detects a change higher-up in an app, it re-renders everything underneath it. This normally isn’t a big deal because React is quite fast at normal things. However you can run into performance issues sometimes where some components are bad to re-render without reason.</p>
<p>In this case, we’re using a new feature of React called <code>React.memo</code>. This is similar to <code>PureComponent</code> where a component will do a simple check on its props to see if they’ve changed and if not it will not re-render this component (or its children, which can bite you.) <code>React.memo</code> provides this functionality for function components. Given that, we need to make sure that the function itself given to <code>ExpensiveComputationComponent</code> is the same function every time. We can use <code>useCallback</code> to make sure that React is handing the same fibonacci to <code>ExpensiveComputationComponent</code> every time so it passes its <code>React.memo</code> check every single time. Now it’s only if count changes will it actually re-render (as evidenced by the time.)</p>
<p>Try removing the <code>useCallback</code> call and see if you get the the count to 40+ that the page crawls as it updates every second.</p>
<details>
<summary>Callback.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useCallback, memo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ExpensiveComputationComponent</span> = <span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; compute, count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>computed: &#123;compute(count)&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>last re-render &#123;new Date().toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">CallbackComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [time, setTime] = <span class="title function_">useState</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="title function_">setTime</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fibonacci</span> = n =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>useCallback Example &#123;time.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        current count: &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ExpensiveComputationComponent</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">compute</span>=<span class="string">&#123;useCallback(fibonacci,</span> [])&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">count</span>=<span class="string">&#123;count&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CallbackComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h3><p><code>useLayoutEffect</code> is almost the same as <code>useEffect</code> except that it’s synchronous to render as opposed to scheduled like <code>useEffect</code> is. If you’re migrating from a class component to a hooks-using function component, this can be helpful too because <code>useLayout</code> runs at the same time as componentDidMount and componentDidUpdate whereas <code>useEffect</code> is scheduled after. This should be a temporary fix.</p>
<p>The only time you should be using <code>useLayoutEffect</code> is to measure DOM nodes for things like animations. In the example, I measure the textarea after every time you click on it (the onClick is to force a re-render.) This means you’re running render twice but it’s also necessary to be able to capture the correct measurments.</p>
<details>
<summary>LayoutEffects.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useLayoutEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">LayoutEffectComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [height, setHeight] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setWidth</span>(el.<span class="property">current</span>.<span class="property">clientWidth</span>);</span><br><span class="line">    <span class="title function_">setHeight</span>(el.<span class="property">current</span>.<span class="property">clientHeight</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>useLayoutEffect Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>textarea width: &#123;width&#125;px<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>textarea height: &#123;height&#125;px<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">textarea</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setWidth(0);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        ref=&#123;el&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LayoutEffectComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><p>Here’s one you will likely never directly use but you may use libraries that use it for you. We’re going to use it in conjunction with another feature called <code>forwardRef</code> that again, you probably won’t use but libraries will use on your behalf. Let’s explain first what it does using the example and then we’ll explain the moving parts.</p>
<p>In the example above, whenever you have an invalid form, it will immediately focus the the first field that’s invalid. If you look at the code, <code>ElaborateInput</code> is a child element so the parent component shouldn’t have any access to the input contained inside the component. Those components are black boxes to their parents. All they can do is pass in props. So how do we accomplish it then?</p>
<p>The first thing we use is <code>useImperativeHandle</code>. This allows us to customize methods on an object that is made available to the parents via the <code>useRef</code> API. Inside <code>ElaborateInput</code> we have two refs: one thate is the one that will be provided by the parent, forwarded through by wrapping the <code>ElaborateInput</code> component in a forwardRef call which will ten provide that second ref parameter in the function call, and then the inputRef which is being used to directly access the DOM so we can call focus on the DOM node directly.</p>
<p>From the parent, we assign via <code>useRef</code> a ref to each of the ElaborateInputs which is then forwarded on each on via the forwardRef. Now, on these refs inside the parent component we have those methods that we made inside the child so we can call them when we need to. In this case, we’ll calling the focus when the parent knows that the child has an error.</p>
<p>Again, you probably use this directly but it’s good to know it exists. Normally it’s better to not use this hook and try to accomplish the same thing via props but sometimes it may be useful to break this one out.</p>
<details>
<summary>ImperativeHandle.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;</span><br><span class="line">  useState,</span><br><span class="line">  useRef,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">  forwardRef</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ElaborateInput</span> = <span class="title function_">forwardRef</span>(</span><br><span class="line">  <span class="function">(<span class="params">&#123; hasError, placeholder, value, update &#125;, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">          inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> update(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        placeholder=&#123;placeholder&#125;</span></span><br><span class="line"><span class="language-xml">        style=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">          padding: &quot;5px 15px&quot;,</span></span><br><span class="line"><span class="language-xml">          borderWidth: &quot;3px&quot;,</span></span><br><span class="line"><span class="language-xml">          borderStyle: &quot;solid&quot;,</span></span><br><span class="line"><span class="language-xml">          borderColor: hasError ? &quot;crimson&quot; : &quot;#999&quot;,</span></span><br><span class="line"><span class="language-xml">          borderRadius: &quot;5px&quot;,</span></span><br><span class="line"><span class="language-xml">          margin: &quot;0 10px&quot;,</span></span><br><span class="line"><span class="language-xml">          textAlign: &quot;center&quot;</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ImperativeHandleComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [city, setCity] = <span class="title function_">useState</span>(<span class="string">&quot;Seattle&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="string">&quot;WA&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> cityEl = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">const</span> stateEl = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">validate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// lol I found it on StackOverflow : https://stackoverflow.com/a/25677072</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !<span class="regexp">/^([a-zA-Z\u0080-\u024F]+(?:. |-| |&#x27;))*[a-zA-Z\u0080-\u024F]+$/</span>.<span class="title function_">test</span>(</span><br><span class="line">        city</span><br><span class="line">      )</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="title function_">setError</span>(<span class="string">&quot;city&quot;</span>);</span><br><span class="line">      cityEl.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^[A-Z]&#123;2&#125;$/</span>.<span class="title function_">test</span>(state)) &#123;</span><br><span class="line">      <span class="title function_">setError</span>(<span class="string">&quot;state&quot;</span>);</span><br><span class="line">      stateEl.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setError</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;valid form!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>useImperativeHandle Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ElaborateInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hasError</span>=<span class="string">&#123;error</span> === <span class="string">&quot;city&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">placeholder</span>=<span class="string">&#123;</span>&quot;<span class="attr">City</span>&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;city&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">update</span>=<span class="string">&#123;setCity&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;cityEl&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ElaborateInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hasError</span>=<span class="string">&#123;error</span> === <span class="string">&quot;state&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">placeholder</span>=<span class="string">&#123;</span>&quot;<span class="attr">State</span>&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;state&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">update</span>=<span class="string">&#123;setState&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;stateEl&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;validate&#125;</span>&gt;</span>Validate Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ImperativeHandleComponent</span>;</span><br></pre></td></tr></table></figure>

</details>

<h2 id="CSS-in-JS"><a href="#CSS-in-JS" class="headerlink" title="CSS in JS"></a>CSS in JS</h2><h3 id="Emotion-Setup-amp-Nav-Bar"><a href="#Emotion-Setup-amp-Nav-Bar" class="headerlink" title="Emotion Setup &amp; Nav Bar"></a>Emotion Setup &amp; Nav Bar</h3><p><a target="_blank" rel="noopener" href="https://emotion.sh/docs/introduction">emotion</a></p>
<p><code>npm install @emotion/core @emotion/babel-preset-css-prop</code></p>
<p><code>touch ./src/NavBar.js</code></p>
<details>
<summary>NavBar.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; css &#125; <span class="keyword">from</span> <span class="string">&quot;@emotion/core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">NavBar</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">header</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">css</span>=<span class="string">&#123;css</span>`</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">background-color:</span> #<span class="attr">333</span>;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">padding:</span> <span class="attr">15px</span>;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    `&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Adopt Me!<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-label</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">role</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      🐈</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NavBar</span>;</span><br></pre></td></tr></table></figure>

</details>

<p>这里为了语法高亮与自动提示，需要安装<code>vscode-styled-component</code>插件</p>
<details>
<summary>修改`.babelrc`</summary>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;@babel/preset-react&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@emotion/babel-preset-css-prop&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</details>

<h3 id="Template-Literals-amp-Hooks"><a href="#Template-Literals-amp-Hooks" class="headerlink" title="Template Literals &amp; Hooks"></a>Template Literals &amp; Hooks</h3><p>因为是在js中书写的css，并且使用了模板字符串，所以我们可以设置变量来修改css属性值。</p>
<p>也可以结合Hooks，设置状态来修改css值。</p>
<p>除了上述做法带来的便利之外，直接在js中引入css可以使代码更加耦合，这样在删除组件时也就删除了对应的css代码，使得组件更加模块化。</p>
<h3 id="Design-Systems-amp-Compound-Selectors"><a href="#Design-Systems-amp-Compound-Selectors" class="headerlink" title="Design Systems &amp; Compound Selectors"></a>Design Systems &amp; Compound Selectors</h3><p>我们还可以把样式设置文件单独打包为一个模块，在各个子模块中进行引用，这样更改样式模块就可以更改全部css属性。</p>
<h3 id="Animations"><a href="#Animations" class="headerlink" title="Animations"></a>Animations</h3><p>同样可以设置变量来保存动画设置，在css中使用模板字符串引入设置好的动画变量</p>
<h2 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a>Code Splitting</h2><p><a target="_blank" rel="noopener" href="https://btholt.github.io/complete-intro-to-react-v5/code-splitting">note</a></p>
<p><code>git reset HEAD --hard</code>将项目文件恢复至初始状态</p>
<p><code>git clean -f</code>删除所有未被git跟踪的文件（<code>NavBar.js</code>)</p>
<p><code>npm i</code></p>
<p><code>npm run dev</code></p>
<p>当我们构建一个复杂的单页应用时，我们希望先加载首屏所需组件，在需要时再加载其他组件，这就是code splitting。</p>
<details>
<summary>修改App.js如下</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import from React</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// delete Details &amp; Search params imports</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// above const App =</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Details</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./Details&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SearchParams</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./SearchParams&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace Router</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">h1</span>&gt;</span>loading route …<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">SearchParams</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Details</span> <span class="attr">path</span>=<span class="string">&quot;/details/:id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Code-Splitting-Libraries-amp-Child-Components"><a href="#Code-Splitting-Libraries-amp-Child-Components" class="headerlink" title="Code Splitting Libraries &amp; Child Components"></a>Code Splitting Libraries &amp; Child Components</h3><p>如果在懒加载的组件中引入了第三方库，可以看到第三方库随同懒加载的组件一同打包在了一起，如果库文件体积较大，无疑可以提升首屏加载速度。</p>
<h2 id="Sever-Side-Rendering"><a href="#Sever-Side-Rendering" class="headerlink" title="Sever Side Rendering"></a>Sever Side Rendering</h2><h3 id="SSR-Rationale-amp-Initial-Setup"><a href="#SSR-Rationale-amp-Initial-Setup" class="headerlink" title="SSR Rationale &amp; Initial Setup"></a>SSR Rationale &amp; Initial Setup</h3><p><code>git reset HEAD --hard</code>将项目文件恢复至初始状态</p>
<p><code>git clean -f</code>删除所有未被git跟踪的文件</p>
<p><code>npm i</code></p>
<p><code>npm run dev</code></p>
<p>当我们此时查看源代码是可以看到html文件仅有几个节点，我们希望在用户加载时能够拥有一些渲染好的DOM节点，这就需要服务端渲染。</p>
<p><code>touch ./src/ClientApp.js</code></p>
<details>
<summary>ClientApp.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">hydrate</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>App.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remove react-dom import</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// replace render at bottom</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>Modal.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// replace modalRoot assignment</span></span><br><span class="line"><span class="keyword">let</span> modalRoot;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in function</span></span><br><span class="line">modalRoot = modalRoot ? modalRoot : <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;modal&quot;</span>);</span><br></pre></td></tr></table></figure>

</details>

<p><code>npm install babel-cli express</code></p>
<details>
<summary>Now in your package.json, add the following to your "scripts"</summary>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;parcel build --public-url ./dist/ src/index.html&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm -s run build &amp;&amp; babel-node server/index.js&quot;</span></span><br></pre></td></tr></table></figure>

</details>

<h3 id="Server-Side-Rendering-to-Strings"><a href="#Server-Side-Rendering-to-Strings" class="headerlink" title="Server Side Rendering to Strings"></a>Server Side Rendering to Strings</h3><p><code>mkdir ./server</code></p>
<p><code>touch ./server/index.js</code></p>
<details>
<summary>index.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&quot;express&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderToString &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom/server&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ServerLocation</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;../src/App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">const</span> html = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;dist/index.html&quot;</span>).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parts = html.<span class="title function_">split</span>(<span class="string">&quot;not rendered&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/dist&quot;</span>, express.<span class="title function_">static</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reactMarkup = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ServerLocation</span> <span class="attr">url</span>=<span class="string">&#123;req.url&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ServerLocation</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(parts[<span class="number">0</span>] + <span class="title function_">renderToString</span>(reactMarkup) + parts[<span class="number">1</span>]);</span><br><span class="line">  res.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;listening on &quot;</span> + <span class="variable constant_">PORT</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>);</span><br></pre></td></tr></table></figure>

</details>

<p><code>npm run start</code></p>
<p>此时查看<code>localhost:3000</code>可以看到已经生成了HTML结构代码。</p>
<h3 id="Server-Side-Rendering-to-Node-Stream"><a href="#Server-Side-Rendering-to-Node-Stream" class="headerlink" title="Server Side Rendering to Node Stream"></a>Server Side Rendering to Node Stream</h3><p>之前我们使用了<code>react-dom/server</code>的<code>renderToString</code>方法将全部文件转换为字符串后一起发送给客户端，我们可以已使用stream边转换边发送以提高发送的速度。</p>
<details>
<summary>index.js</summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// change react-dom import</span></span><br><span class="line"><span class="keyword">import</span> &#123; renderToNodeStream &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom/server&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace app.use call</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">write</span>(parts[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">const</span> reactMarkup = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ServerLocation</span> <span class="attr">url</span>=<span class="string">&#123;req.url&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ServerLocation</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stream = <span class="title function_">renderToNodeStream</span>(reactMarkup);</span><br><span class="line">  stream.<span class="title function_">pipe</span>(</span><br><span class="line">    res,</span><br><span class="line">    &#123; <span class="attr">end</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  );</span><br><span class="line">  stream.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">write</span>(parts[<span class="number">1</span>]);</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</details>

<h2 id="TypeScript-with-React"><a href="#TypeScript-with-React" class="headerlink" title="TypeScript with React"></a>TypeScript with React</h2><h3 id="TypeScript-Introduction"><a href="#TypeScript-Introduction" class="headerlink" title="TypeScript Introduction"></a>TypeScript Introduction</h3><p><code>git reset HEAD --hard</code>将项目文件恢复至初始状态</p>
<p><code>git clean -f</code>删除所有未被git跟踪的文件</p>
<p><code>npm i</code></p>
<p><code>npm run dev</code></p>
<p>这里主要介绍了使用ts可以在vscode中获得自动的类型检查与代码提示，极大地提升了编码体验。</p>
<h3 id="TypeScript-Configuration-for-React"><a href="#TypeScript-Configuration-for-React" class="headerlink" title="TypeScript Configuration for React"></a>TypeScript Configuration for React</h3><p><code>npm i -D typescript</code></p>
<p><code>npx tsc --init</code></p>
<p>Open your new tsconfig.json file and uncomment the jsx field. Replace preserve with react. This lets TypeScript that you’re writing React. Then update the target to be ES2018 so that you can use async &#x2F; await and promises.</p>
<p><code>npm install -D @types/react @types/react-dom @types/reach__router</code></p>
<h3 id="Typing-the-Modal-Component"><a href="#Typing-the-Modal-Component" class="headerlink" title="Typing the Modal Component"></a>Typing the Modal Component</h3><details>
<summary>将Modal.js修改为Modal.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useRef, <span class="title class_">FunctionComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPortal &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modalRoot = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;modal&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Modal</span>: <span class="title class_">FunctionComponent</span> = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> elRef = <span class="title function_">useRef</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!modalRoot) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    modalRoot.<span class="title function_">appendChild</span>(elRef.<span class="property">current</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      modalRoot.<span class="title function_">removeChild</span>(elRef.<span class="property">current</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createPortal</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, elRef.<span class="property">current</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Modal</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Migrating-to-TSLint"><a href="#Migrating-to-TSLint" class="headerlink" title="Migrating to TSLint"></a>Migrating to TSLint</h3><p><code>npm uninstall eslint babel-eslint eslint-config-prettier eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks</code></p>
<p><code>npm install -D tslint tslint-react tslint-config-prettier</code></p>
<p>修改package.json中的scripts</p>
<p><code>&quot;lint&quot;: &quot;tslint --project&quot;,</code></p>
<p><code>touch tslint.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;tslint: recommended&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tslint-react&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tslint-config-prettier&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ordered-imports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;object-literal-sort-keys&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;no-console&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jsx-no-lambda&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;member-ordering&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后可以安装tslint插件以便在vscode中提升体验</p>
<h3 id="Typing-Context"><a href="#Typing-Context" class="headerlink" title="Typing Context"></a>Typing Context</h3><details>
<summary>修改ThemeContext.js为ThemeContext.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = createContext&lt;[<span class="built_in">string</span>, <span class="function">(<span class="params">theme: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span>]&gt;([</span><br><span class="line">  <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ThemeContext</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Typing-a-Class-Component"><a href="#Typing-a-Class-Component" class="headerlink" title="Typing a Class Component"></a>Typing a Class Component</h3><details>
<summary>修改Details.js为Details.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pet, &#123; <span class="title class_">Photo</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; navigate, <span class="title class_">RouteComponentProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Carousel</span> <span class="keyword">from</span> <span class="string">&quot;./Carousel&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Modal</span> <span class="keyword">from</span> <span class="string">&quot;./Modal&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">from</span> <span class="string">&quot;./ErrorBoundary&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;./ThemeContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Details</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">RouteComponentProps</span>&lt;&#123; <span class="attr">id</span>: <span class="built_in">string</span> &#125;&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> state = &#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">showModal</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">animal</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">breed</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">location</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">description</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">media</span>: [] <span class="keyword">as</span> <span class="title class_">Photo</span>[],</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>) &#123;</span><br><span class="line">      <span class="title function_">navigate</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pet</span><br><span class="line">      .<span class="title function_">animal</span>(+<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; animal &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">name</span>: animal.<span class="property">name</span>,</span><br><span class="line">          <span class="attr">animal</span>: animal.<span class="property">type</span>,</span><br><span class="line">          <span class="attr">location</span>: <span class="string">`<span class="subst">$&#123;animal.contact.address.city&#125;</span>, <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            animal.contact.address.state</span></span></span><br><span class="line"><span class="subst"><span class="string">          &#125;</span>`</span>,</span><br><span class="line">          <span class="attr">description</span>: animal.<span class="property">description</span>,</span><br><span class="line">          <span class="attr">media</span>: animal.<span class="property">photos</span>,</span><br><span class="line">          <span class="attr">breed</span>: animal.<span class="property">breeds</span>.<span class="property">primary</span>,</span><br><span class="line">          <span class="attr">url</span>: animal.<span class="property">url</span>,</span><br><span class="line">          <span class="attr">loading</span>: <span class="literal">false</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">err: <span class="built_in">Error</span></span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">error</span>: err &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> toggleModal = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">showModal</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">showModal</span> &#125;);</span><br><span class="line">  <span class="keyword">public</span> adopt = <span class="function">() =&gt;</span> <span class="title function_">navigate</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">url</span>);</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">loading</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>loading … <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      animal,</span><br><span class="line">      breed,</span><br><span class="line">      location,</span><br><span class="line">      description,</span><br><span class="line">      media,</span><br><span class="line">      name,</span><br><span class="line">      showModal</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;details&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Carousel</span> <span class="attr">media</span>=<span class="string">&#123;media&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;`$&#123;animal&#125; — $&#123;breed&#125; — $&#123;location&#125;`&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;([theme]) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">theme</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onClick</span>=<span class="string">&#123;this.toggleModal&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &gt;</span></span></span><br><span class="line"><span class="language-xml">                Adopt &#123;name&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            )&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;showModal ? (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Would you like to adopt &#123;name&#125;?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;buttons&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.adopt&#125;</span>&gt;</span>Yes<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.toggleModal&#125;</span>&gt;</span>No<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ) : null&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">DetailsErrorBoundary</span>(<span class="params"></span></span><br><span class="line"><span class="params">  props: RouteComponentProps&lt;&#123; id: <span class="built_in">string</span> &#125;&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Details</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Typing-an-Error-Bundary"><a href="#Typing-an-Error-Bundary" class="headerlink" title="Typing an Error Bundary"></a>Typing an Error Bundary</h3><details>
<summary>ErrorBundary.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mostly code from reactjs.org/docs/error-boundaries.html</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span>, <span class="title class_">ErrorInfo</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span>, <span class="title class_">Redirect</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span>, <span class="attr">redirect</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">componentDidCatch</span>(<span class="params">error: <span class="built_in">Error</span>, info: ErrorInfo</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;ErrorBoundary caught an error&quot;</span>, error, info);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">redirect</span>: <span class="literal">true</span> &#125;), <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">redirect</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          There was an error with this listing. <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Click here<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          to back to the home page or wait five seconds</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErrorBoundary</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Props-amp-State-Interface"><a href="#Props-amp-State-Interface" class="headerlink" title="Props &amp; State Interface"></a>Props &amp; State Interface</h3><details>
<summary>Carousel.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Photo</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">media</span>: <span class="title class_">Photo</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IState</span> &#123;</span><br><span class="line">  <span class="attr">active</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">photos</span>: <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Carousel</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">IProps</span>, <span class="title class_">IState</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> state = &#123;</span><br><span class="line">    <span class="attr">photos</span>: [],</span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getDerivedStateFromProps</span>(<span class="params">&#123; media &#125;: IProps</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> photos = [<span class="string">&quot;http://placecorgi.com/600/600&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (media.<span class="property">length</span>) &#123;</span><br><span class="line">      photos = media.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; large &#125;</span>) =&gt;</span> large);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; photos &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> handleIndexClick = <span class="function">(<span class="params">event: React.MouseEvent&lt;HTMLElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(event.<span class="property">target</span> <span class="keyword">instanceof</span> <span class="title class_">HTMLElement</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">index</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">active</span>: +event.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">index</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; photos, active &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;carousel&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;photos[active]&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;animal&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;carousel-smaller&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;photos.map((photo, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;photo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;this.handleIndexClick&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">data-index</span>=<span class="string">&#123;index&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">src</span>=<span class="string">&#123;photo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&#123;index</span> === <span class="string">active</span> ? &quot;<span class="attr">active</span>&quot; <span class="attr">:</span> &quot;&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">alt</span>=<span class="string">&quot;animal thumbnail&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Carousel</span>;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>Pet.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">FunctionComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Photo</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">animal</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">breed</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">media</span>: <span class="title class_">Photo</span>[];</span><br><span class="line">  <span class="attr">location</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Pet</span>: <span class="title class_">FunctionComponent</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, animal, breed, media, location, id &#125; = props;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> hero = <span class="string">&quot;http://placecorgi.com/300/300&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (media.<span class="property">length</span>) &#123;</span><br><span class="line">    hero = media[<span class="number">0</span>].<span class="property">small</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;</span>`/<span class="attr">details</span>/$&#123;<span class="attr">id</span>&#125;`&#125; <span class="attr">className</span>=<span class="string">&quot;pet&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;image-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;hero&#125;</span> <span class="attr">alt</span>=<span class="string">&#123;name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;`$&#123;animal&#125; — $&#123;breed&#125; — $&#123;location&#125;`&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Pet</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Heterogenous-Arrays-amp-Hooks"><a href="#Heterogenous-Arrays-amp-Hooks" class="headerlink" title="Heterogenous Arrays &amp; Hooks"></a>Heterogenous Arrays &amp; Hooks</h3><details>
<summary>useDropdown.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, <span class="title class_">FunctionComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useDropdown</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  label: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  defaultState: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  options: <span class="built_in">string</span>[]</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, updateState] = <span class="title function_">useState</span>(defaultState);</span><br><span class="line">  <span class="keyword">const</span> id = <span class="string">`use-dropdown-<span class="subst">$&#123;label.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).toLowerCase()&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Dropdown</span>: <span class="title class_">FunctionComponent</span> = <span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&#123;id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;label&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">id</span>=<span class="string">&#123;id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;state&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> updateState(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        onBlur=&#123;e =&gt; updateState(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">        disabled=&#123;!options.length&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">option</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;options.map(item =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span> <span class="attr">value</span>=<span class="string">&#123;item&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;item&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> [state, <span class="title class_">Dropdown</span>, updateState] <span class="keyword">as</span> [</span><br><span class="line">    <span class="built_in">string</span>,</span><br><span class="line">    <span class="title class_">FunctionComponent</span>,</span><br><span class="line">    <span class="title class_">Dispatch</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  ];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDropdown;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>SearchParams.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;</span><br><span class="line">  useState,</span><br><span class="line">  useEffect,</span><br><span class="line">  useContext,</span><br><span class="line">  <span class="title class_">FunctionComponent</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pet, &#123; <span class="variable constant_">ANIMALS</span>, <span class="title class_">Animal</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useDropdown <span class="keyword">from</span> <span class="string">&quot;./useDropdown&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Results</span> <span class="keyword">from</span> <span class="string">&quot;./Results&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ThemeContext</span> <span class="keyword">from</span> <span class="string">&quot;./ThemeContext&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouteComponentProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reach/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SearchParams</span>: <span class="title class_">FunctionComponent</span>&lt;<span class="title class_">RouteComponentProps</span>&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">const</span> [location, updateLocation] = <span class="title function_">useState</span>(<span class="string">&quot;Seattle, WA&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [breeds, updateBreeds] = <span class="title function_">useState</span>([] <span class="keyword">as</span> <span class="built_in">string</span>[]);</span><br><span class="line">  <span class="keyword">const</span> [pets, setPets] = <span class="title function_">useState</span>([] <span class="keyword">as</span> <span class="title class_">Animal</span>[]);</span><br><span class="line">  <span class="keyword">const</span> [animal, <span class="title class_">AnimalDropdown</span>] = <span class="title function_">useDropdown</span>(<span class="string">&quot;Animal&quot;</span>, <span class="string">&quot;dog&quot;</span>, <span class="variable constant_">ANIMALS</span>);</span><br><span class="line">  <span class="keyword">const</span> [breed, <span class="title class_">BreedDropdown</span>, updateBreed] = <span class="title function_">useDropdown</span>(<span class="string">&quot;Breed&quot;</span>, <span class="string">&quot;&quot;</span>, breeds);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">requestPets</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; animals &#125; = <span class="keyword">await</span> pet.<span class="title function_">animals</span>(&#123;</span><br><span class="line">      location,</span><br><span class="line">      breed,</span><br><span class="line">      <span class="attr">type</span>: animal</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;animals&quot;</span>, animals);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setPets</span>(animals || []);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">updateBreeds</span>([]);</span><br><span class="line">    <span class="title function_">updateBreed</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    pet.<span class="title function_">breeds</span>(animal).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; breeds &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> breedStrings = breeds.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> name);</span><br><span class="line">      <span class="title function_">updateBreeds</span>(breedStrings);</span><br><span class="line">    &#125;, <span class="variable language_">console</span>.<span class="property">error</span>);</span><br><span class="line">  &#125;, [animal]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;search-params&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onSubmit</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          e.preventDefault();</span></span><br><span class="line"><span class="language-xml">          requestPets();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;location&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Location</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">id</span>=<span class="string">&quot;location&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;location&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">placeholder</span>=<span class="string">&quot;Location&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> updateLocation(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">AnimalDropdown</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">BreedDropdown</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&quot;location&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Theme</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;theme&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setTheme(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">            onBlur=&#123;e =&gt; setTheme(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;peru&quot;</span>&gt;</span>Peru<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;darkblue&quot;</span>&gt;</span>Dark Blue<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;chartreuse&quot;</span>&gt;</span>Chartreuse<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;mediumorchid&quot;</span>&gt;</span>Medium Orchid<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">theme</span> &#125;&#125;&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Results</span> <span class="attr">pets</span>=<span class="string">&#123;pets&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">SearchParams</span>;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>Results.tsx</summary>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">FunctionComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Pet</span> <span class="keyword">from</span> <span class="string">&quot;./Pet&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Animal</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">pets</span>: <span class="title class_">Animal</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Results</span>: <span class="title class_">FunctionComponent</span>&lt;<span class="title class_">IProps</span>&gt; = <span class="function">(<span class="params">&#123; pets &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;search&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;!pets.length ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>No Pets Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        pets.map(pet =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Pet</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">animal</span>=<span class="string">&#123;pet.type&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;pet.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">name</span>=<span class="string">&#123;pet.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">breed</span>=<span class="string">&#123;pet.breeds.primary&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">media</span>=<span class="string">&#123;pet.photos&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">location</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">pet.contact.address.city</span>&#125;, $&#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">pet.contact.address.state</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &#125;`&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">id</span>=<span class="string">&#123;pet.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          );</span></span><br><span class="line"><span class="language-xml">        &#125;)</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Results</span>;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="TypeScript-Review-and-Q-amp-A"><a href="#TypeScript-Review-and-Q-amp-A" class="headerlink" title="TypeScript Review and Q&amp;A"></a>TypeScript Review and Q&amp;A</h3><p>直接将App.js修改为App.tsx，可以看到无需进行修改。修改index.html的script的src为App.tsx。</p>
<p><code>npm run dev</code>可以看到网站正常运行</p>
<p>在package.json中添加script命令<code>&quot;typecheck&quot;: &quot;tsc --noEmit&quot;</code></p>
<p><code>npm run typecheck</code></p>
<p>可以看到没有任何提示，说明通过了类型检查</p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><h3 id="Redux-Introduction"><a href="#Redux-Introduction" class="headerlink" title="Redux Introduction"></a>Redux Introduction</h3><p><a target="_blank" rel="noopener" href="https://btholt.github.io/complete-intro-to-react-v5/redux">note</a></p>
<p>现在通过Hooks的useContext和useReducer可以模拟出redux的功能</p>
<p><code>git reset HEAD --hard</code>将项目文件恢复至初始状态</p>
<p><code>git clean -f</code>删除所有未被git跟踪的文件</p>
<p><code>npm i</code></p>
<p><code>npm i redux react-redux</code></p>
<h3 id="Creating-a-Store"><a href="#Creating-a-Store" class="headerlink" title="Creating a Store"></a>Creating a Store</h3><p><code>touch ./src/store.js</code></p>
<details>
<summary>store.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="keyword">typeof</span> <span class="variable language_">window</span> === <span class="string">&quot;object&quot;</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> <span class="variable language_">window</span>.<span class="property">__REDUX_DEVTOOLS_EXTENSION__</span> !== <span class="string">&quot;undefined&quot;</span></span><br><span class="line">    ? <span class="variable language_">window</span>.<span class="title function_">__REDUX_DEVTOOLS_EXTENSION__</span>()</span><br><span class="line">    : <span class="function"><span class="params">f</span> =&gt;</span> f</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Creating-a-Reducer"><a href="#Creating-a-Reducer" class="headerlink" title="Creating a Reducer"></a>Creating a Reducer</h3><p><code>mkdir ./src/reducers</code></p>
<p><code>touch ./src/reducers/index.js</code></p>
<details>
<summary>index.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> location <span class="keyword">from</span> <span class="string">&quot;./location&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> theme <span class="keyword">from</span> <span class="string">&quot;./theme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  location,</span><br><span class="line">  theme</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</details>

<p><code>touch ./src/reducers/location.js</code></p>
<details>
<summary>location.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">theme</span>(<span class="params">state = <span class="string">&quot;darkblue&quot;</span>, action</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;CHANGE_THEME&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action.<span class="property">payload</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<p><code>./src/reducers/theme.js</code></p>
<details>
<summary>theme.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">theme</span>(<span class="params">state = <span class="string">&quot;darkblue&quot;</span>, action</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;CHANGE_THEME&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action.<span class="property">payload</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Creating-Actions"><a href="#Creating-Actions" class="headerlink" title="Creating Actions"></a>Creating Actions</h3><p><code>mkdir ./src/actionCreators</code></p>
<p><code>touch ./src/actionCreators/changeLocation.js</code></p>
<details>
<summary>changeLocation.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">changeLocation</span>(<span class="params">location</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;CHANGE_LOCATION&quot;</span>,</span><br><span class="line">    <span class="attr">payload</span>: location</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<p><code>touch ./src/actionCreators/changeTheme.js</code></p>
<details>
<summary>changeTheme.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">changeTheme</span>(<span class="params">theme</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;CHANGE_THEME&quot;</span>,</span><br><span class="line">    <span class="attr">payload</span>: theme</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Connecting-Redux-to-the-Application"><a href="#Connecting-Redux-to-the-Application" class="headerlink" title="Connecting Redux to the Application"></a>Connecting Redux to the Application</h3><details>
<summary>App.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// delete ThemeContext, useState import</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// import</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// delete useState call</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// wrap app with</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span>[…]<span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>SearchParams.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// replace ThemeContext import</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace context references</span></span><br><span class="line"><span class="attr">location</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>,</span><br><span class="line"><span class="attr">animal</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">animal</span>,</span><br><span class="line"><span class="attr">breed</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">breed</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace export</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = (<span class="params">&#123; theme, location &#125;</span>) =&gt; (&#123;</span><br><span class="line">  theme,</span><br><span class="line">  location</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps)(<span class="title class_">SearchParams</span>);</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Redux-Devtools"><a href="#Redux-Devtools" class="headerlink" title="Redux Devtools"></a>Redux Devtools</h3><p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en">redux dev tools - chrome</a></p>
<h3 id="Completing-the-Redux-Writing"><a href="#Completing-the-Redux-Writing" class="headerlink" title="Completing the Redux Writing"></a>Completing the Redux Writing</h3><details>
<summary>Details.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// replace ThemeContext import</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// remove all the ThemeContext stuff and the interior function</span></span><br><span class="line"><span class="comment">// replace `context.theme` with just `this.props.theme` for the backgroundColor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bottom</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = (<span class="params">&#123; theme &#125;</span>) =&gt; (&#123; theme &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WrappedDetails</span> = <span class="title function_">connect</span>(mapStateToProps)(<span class="title class_">Details</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// replace &lt;Details /&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">WrappedDetails</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

</details>

<h2 id="Testing-React"><a href="#Testing-React" class="headerlink" title="Testing React"></a>Testing React</h2><h3 id="Jest-amp-React-Testing-Library"><a href="#Jest-amp-React-Testing-Library" class="headerlink" title="Jest &amp; React Testing Library"></a>Jest &amp; React Testing Library</h3><p><code>git reset HEAD --hard</code></p>
<p><code>git clean -f</code></p>
<p><code>npm i</code></p>
<p><code>npm i -D jest react-testing-library</code></p>
<p><code>mkdir ./src/__test__</code></p>
<p><code>touch ./src/__test__/SearchParams.test.js</code></p>
<h3 id="API-Mocks"><a href="#API-Mocks" class="headerlink" title="API Mocks"></a>API Mocks</h3><p><code>mkdir ./__mocks__</code></p>
<p><code>mkdir ./__mocks__/frontendmasters</code></p>
<p><code>touch ./__mocks__/frontendmasters/pet.js</code></p>
<details>
<summary>pet.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; readFileSync &#125; <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; act &#125; <span class="keyword">from</span> <span class="string">&quot;react-testing-library&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> breeds = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Bichon Frise&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Bolognese&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Bolonka&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Coton de Tulear&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Havanese&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Lowchen&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Maltese&quot;</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doggos = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">  <span class="title function_">readFileSync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;res.json&quot;</span>)).<span class="title function_">toString</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ANIMALS</span> = [<span class="string">&quot;dog&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;bird&quot;</span>];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> _breeds = breeds;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> _dogs = doggos.<span class="property">animals</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mock = &#123;</span><br><span class="line">  <span class="attr">breeds</span>: jest.<span class="title function_">fn</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">then</span>: <span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">act</span>(<span class="function">() =&gt;</span> <span class="title function_">callback</span>(&#123; breeds &#125;))</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">animals</span>: jest.<span class="title function_">fn</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">then</span>: <span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">act</span>(<span class="function">() =&gt;</span> <span class="title function_">callback</span>(doggos))</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mock;</span><br></pre></td></tr></table></figure>

</details>

<p><code>touch ./__mocks__/frontendmasters/res.json</code></p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/btholt/complete-intro-to-react-v5/testing/__mocks__/@frontendmasters/res.json">go copy and paste this fixture</a></p>
<h3 id="Component-Tests"><a href="#Component-Tests" class="headerlink" title="Component Tests"></a>Component Tests</h3><details>
<summary>SearchParams.test.js</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, cleanup &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> pet, &#123; _breeds, _dogs, <span class="variable constant_">ANIMALS</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@frontendmasters/pet&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SearchParams</span> <span class="keyword">from</span> <span class="string">&quot;../SearchParams&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">afterEach</span>(cleanup);</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;SearchParams&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; getByTestId &#125; = <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">SearchParams</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> animalDropdown = <span class="title function_">getByTestId</span>(<span class="string">&quot;use-dropdown-animal&quot;</span>);</span><br><span class="line">  <span class="title function_">expect</span>(animalDropdown.<span class="property">children</span>.<span class="property">length</span>).<span class="title function_">toEqual</span>(<span class="variable constant_">ANIMALS</span>.<span class="property">length</span> + <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>useDropdown.js </summary>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;select</span><br><span class="line">  data-testid=&#123;id&#125;</span><br><span class="line">  […]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Snapshots-Watch-Mode-amp-Test-Coverage"><a href="#Snapshots-Watch-Mode-amp-Test-Coverage" class="headerlink" title="Snapshots, Watch Mode &amp; Test Coverage"></a>Snapshots, Watch Mode &amp; Test Coverage</h3><p>Here we’re doing a Jest test in which we’re doing a snapshot test. As soon as you run this test the first time, it’ll run and capture the output in a snapshot template string (you’ll see it after you run it successfully the first time.) Every time afterwards when you run it it will compare the output with this snapshot. If it changes, it’ll fail the test. If you mean to change it, you just run jest -u and it will update the snapshots. Cool, right? You can also have it write to an external file instead of inline in the code with toMatchSnapshot. I like that everything is in one file. It’s up to you.</p>
<p>Add that your package.json: <code>&quot;test:update&quot;: &quot;jest -u&quot;,</code></p>
<p>Now your snapshot test should pass. Check out that it created a <code>__snapshots__</code> directory with your snapshot in it (if you did it toMatchSnapshot). You should commit this file as everyone should get the same output as you.</p>
<p>Let’s talk about code coverage. Luckily has it built into jest because it can be a bit of a pain to set up. It’s a tool called istanbul. Istanbul generates a report of how much of you code is covered by tests. It’s a useful metric to track you’re generally adding tests when you add new features but by no means does a 100% test-covered project means that those tests are good. It’s easy to write garbage tests, and garbage tests hurt more than help.</p>
<p>In any case, run <code>npx jest --coverage</code> to try it out. It’ll show you an outline of the results in the CLI and then generate a report in a new coverage directory (don’t check this in to git.) Open coverage&#x2F;lcov-report&#x2F;index.html to see a nice web page outlining your test coverage. Add this to your package.json: <code>&quot;test:coverage&quot;: &quot;jest --coverage&quot;,</code>.</p>
<p>One more useful thing about Jest: watch mode. You can run your tests interactively and on file-save. It’ll only re-run tests that could have possibly been changed and previously failed so it’s a fast feedback cycle to fix tests. Add this as well to your package.json: <code>&quot;test:watch&quot;: &quot;jest --watch&quot;,</code>.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/FrontEndMasters/" rel="tag"># FrontEndMasters</a>
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
              <a href="/tags/React/" rel="tag"># React</a>
              <a href="/tags/Jest/" rel="tag"># Jest</a>
              <a href="/tags/TypeScript/" rel="tag"># TypeScript</a>
              <a href="/tags/Hooks/" rel="tag"># Hooks</a>
              <a href="/tags/Redux/" rel="tag"># Redux</a>
              <a href="/tags/SSR/" rel="tag"># SSR</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/08/05/TypeScript-3-Fundamentals-v2/" rel="prev" title="TypeScript 3 Fundamentals v2">
                  <i class="fa fa-chevron-left"></i> TypeScript 3 Fundamentals v2
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/08/11/JavaScript-The-Hard-Part-of-Object-Oriented-JavaScript/" rel="next" title="JavaScript: The Hard Part of Object Oriented JavaScript">
                  JavaScript: The Hard Part of Object Oriented JavaScript <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘勇</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
